<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 9 章 ggplot2 | Cookbook for R 中文版</title>
  <meta name="description" content="第 9 章 ggplot2 | Cookbook for R 中文版本" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="第 9 章 ggplot2 | Cookbook for R 中文版" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="第 9 章 ggplot2 | Cookbook for R 中文版本" />
  <meta name="github-repo" content="openbiox/Cookbook-for-R-Chinese" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 9 章 ggplot2 | Cookbook for R 中文版" />
  
  <meta name="twitter:description" content="第 9 章 ggplot2 | Cookbook for R 中文版本" />
  

<meta name="author" content="Winston Chang（著）" />
<meta name="author" content="王诗翔 等（译）" />


<meta name="date" content="2019-06-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="section-8.html">
<link rel="next" href="section-10.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Cookbook for R 中文版</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#section-0.1"><i class="fa fa-check"></i><b>0.1</b> 问题与反馈</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#section-0.2"><i class="fa fa-check"></i><b>0.2</b> 致谢</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html"><i class="fa fa-check"></i>作者简介</a></li>
<li class="chapter" data-level="1" data-path="chapter1.html"><a href="chapter1.html"><i class="fa fa-check"></i><b>1</b> 基础</a><ul>
<li class="chapter" data-level="1.1" data-path="chapter1.html"><a href="chapter1.html#r-pkg-installation"><i class="fa fa-check"></i><b>1.1</b> 安装和使用 R 包</a></li>
<li class="chapter" data-level="1.2" data-path="chapter1.html"><a href="chapter1.html#section-1.2"><i class="fa fa-check"></i><b>1.2</b> 数据结构的索引</a></li>
<li class="chapter" data-level="1.3" data-path="chapter1.html"><a href="chapter1.html#section-1.3"><i class="fa fa-check"></i><b>1.3</b> 获取数据结构的子集</a></li>
<li class="chapter" data-level="1.4" data-path="chapter1.html"><a href="chapter1.html#section-1.4"><i class="fa fa-check"></i><b>1.4</b> 创建填满值的向量</a></li>
<li class="chapter" data-level="1.5" data-path="chapter1.html"><a href="chapter1.html#section-1.5"><i class="fa fa-check"></i><b>1.5</b> 变量信息</a></li>
<li class="chapter" data-level="1.6" data-path="chapter1.html"><a href="chapter1.html#nullnanan-"><i class="fa fa-check"></i><b>1.6</b> NULL、NA、NaN 的处理</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="section-2.html"><a href="section-2.html"><i class="fa fa-check"></i><b>2</b> 数字</a><ul>
<li class="chapter" data-level="2.1" data-path="section-2.html"><a href="section-2.html#section-2.1"><i class="fa fa-check"></i><b>2.1</b> 生成随机数</a></li>
<li class="chapter" data-level="2.2" data-path="section-2.html"><a href="section-2.html#section-2.2"><i class="fa fa-check"></i><b>2.2</b> 生成可重复的随机序列</a></li>
<li class="chapter" data-level="2.3" data-path="section-2.html"><a href="section-2.html#section-2.3"><i class="fa fa-check"></i><b>2.3</b> 保持随机数生成器的状态</a></li>
<li class="chapter" data-level="2.4" data-path="section-2.html"><a href="section-2.html#section-2.4"><i class="fa fa-check"></i><b>2.4</b> 对数值取整</a></li>
<li class="chapter" data-level="2.5" data-path="section-2.html"><a href="section-2.html#section-2.5"><i class="fa fa-check"></i><b>2.5</b> 比较浮点数</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="section-3.html"><a href="section-3.html"><i class="fa fa-check"></i><b>3</b> 字符串</a><ul>
<li class="chapter" data-level="3.1" data-path="section-3.html"><a href="section-3.html#-grepsubgsub-"><i class="fa fa-check"></i><b>3.1</b> 使用 grep、sub、gsub 进行搜索和替换</a></li>
<li class="chapter" data-level="3.2" data-path="section-3.html"><a href="section-3.html#section-3.2"><i class="fa fa-check"></i><b>3.2</b> 通过变量创建字符串</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-4.html"><a href="section-4.html"><i class="fa fa-check"></i><b>4</b> 公式</a><ul>
<li class="chapter" data-level="4.1" data-path="section-4.html"><a href="section-4.html#section-4.1"><i class="fa fa-check"></i><b>4.1</b> 通过字符串创建公式</a></li>
<li class="chapter" data-level="4.2" data-path="section-4.html"><a href="section-4.html#section-4.2"><i class="fa fa-check"></i><b>4.2</b> 从公式中提取组分</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-5.html"><a href="section-5.html"><i class="fa fa-check"></i><b>5</b> 数据的导入与导出</a><ul>
<li class="chapter" data-level="5.1" data-path="section-5.html"><a href="section-5.html#r-import-data-from-file"><i class="fa fa-check"></i><b>5.1</b> R载入文件中的数据</a></li>
<li class="chapter" data-level="5.2" data-path="section-5.html"><a href="section-5.html#read-data-from-keyboard"><i class="fa fa-check"></i><b>5.2</b> 通过键盘和剪贴板把数据载入并保存到 R</a></li>
<li class="chapter" data-level="5.3" data-path="section-5.html"><a href="section-5.html#run-r-script"><i class="fa fa-check"></i><b>5.3</b> 运行 R 脚本</a></li>
<li class="chapter" data-level="5.4" data-path="section-5.html"><a href="section-5.html#r-write-data-into-file"><i class="fa fa-check"></i><b>5.4</b> 用 R 把数据写入文件</a></li>
<li class="chapter" data-level="5.5" data-path="section-5.html"><a href="section-5.html#r-output-analysis"><i class="fa fa-check"></i><b>5.5</b> 用 R 写入文本，分析输出到文件</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="section-6.html"><a href="section-6.html"><i class="fa fa-check"></i><b>6</b> 数据操作</a><ul>
<li class="chapter" data-level="6.1" data-path="section-6.html"><a href="section-6.html#section-6.1"><i class="fa fa-check"></i><b>6.1</b> 排序</a></li>
<li class="chapter" data-level="6.2" data-path="section-6.html"><a href="section-6.html#section-6.2"><i class="fa fa-check"></i><b>6.2</b> 随机排序</a></li>
<li class="chapter" data-level="6.3" data-path="section-6.html"><a href="section-6.html#section-6.3"><i class="fa fa-check"></i><b>6.3</b> 转换向量类型</a></li>
<li class="chapter" data-level="6.4" data-path="section-6.html"><a href="section-6.html#section-6.4"><i class="fa fa-check"></i><b>6.4</b> 查找并移除重复记录</a></li>
<li class="chapter" data-level="6.5" data-path="section-6.html"><a href="section-6.html#compare-with-nas"><i class="fa fa-check"></i><b>6.5</b> NA 存在时进行向量或因子比较</a></li>
<li class="chapter" data-level="6.6" data-path="section-6.html"><a href="section-6.html#section-6.6"><i class="fa fa-check"></i><b>6.6</b> 数据重新编码</a></li>
<li class="chapter" data-level="6.7" data-path="section-6.html"><a href="section-6.html#section-6.7"><i class="fa fa-check"></i><b>6.7</b> 映射向量值</a></li>
<li class="chapter" data-level="6.8" data-path="section-6.html"><a href="section-6.html#section-6.8"><i class="fa fa-check"></i><b>6.8</b> 重命名因子水平</a></li>
<li class="chapter" data-level="6.9" data-path="section-6.html"><a href="section-6.html#section-6.9"><i class="fa fa-check"></i><b>6.9</b> 重计算因子水平</a></li>
<li class="chapter" data-level="6.10" data-path="section-6.html"><a href="section-6.html#section-6.10"><i class="fa fa-check"></i><b>6.10</b> 改变因子水平次序</a></li>
<li class="chapter" data-level="6.11" data-path="section-6.html"><a href="section-6.html#section-6.11"><i class="fa fa-check"></i><b>6.11</b> 重命名数据框的列</a></li>
<li class="chapter" data-level="6.12" data-path="section-6.html"><a href="section-6.html#section-6.12"><i class="fa fa-check"></i><b>6.12</b> 添加和移除数据框的列</a></li>
<li class="chapter" data-level="6.13" data-path="section-6.html"><a href="section-6.html#section-6.13"><i class="fa fa-check"></i><b>6.13</b> 对数据框的列重新排序</a></li>
<li class="chapter" data-level="6.14" data-path="section-6.html"><a href="section-6.html#section-6.14"><i class="fa fa-check"></i><b>6.14</b> 合并数据框</a></li>
<li class="chapter" data-level="6.15" data-path="section-6.html"><a href="section-6.html#section-6.15"><i class="fa fa-check"></i><b>6.15</b> 比较数据框</a></li>
<li class="chapter" data-level="6.16" data-path="section-6.html"><a href="section-6.html#section-6.16"><i class="fa fa-check"></i><b>6.16</b> 重计算数据框所有因子列的水平</a></li>
<li class="chapter" data-level="6.17" data-path="section-6.html"><a href="section-6.html#section-6.17"><i class="fa fa-check"></i><b>6.17</b> 长宽格式数据互换</a></li>
<li class="chapter" data-level="6.18" data-path="section-6.html"><a href="section-6.html#section-6.18"><i class="fa fa-check"></i><b>6.18</b> 汇总数据</a></li>
<li class="chapter" data-level="6.19" data-path="section-6.html"><a href="section-6.html#section-6.19"><i class="fa fa-check"></i><b>6.19</b> 数据框与列联表互换</a></li>
<li class="chapter" data-level="6.20" data-path="section-6.html"><a href="section-6.html#section-6.20"><i class="fa fa-check"></i><b>6.20</b> 计算移动平均数</a></li>
<li class="chapter" data-level="6.21" data-path="section-6.html"><a href="section-6.html#section-6.21"><i class="fa fa-check"></i><b>6.21</b> 窗口平滑</a></li>
<li class="chapter" data-level="6.22" data-path="section-6.html"><a href="section-6.html#section-6.22"><i class="fa fa-check"></i><b>6.22</b> 寻找唯一值序列</a></li>
<li class="chapter" data-level="6.23" data-path="section-6.html"><a href="section-6.html#fill-na-with-last-value"><i class="fa fa-check"></i><b>6.23</b> 用最后一个非 NA 值填充 NA</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-7.html"><a href="section-7.html"><i class="fa fa-check"></i><b>7</b> 统计分析</a><ul>
<li class="chapter" data-level="7.1" data-path="section-7.html"><a href="section-7.html#section-7.1"><i class="fa fa-check"></i><b>7.1</b> 回归和相关分析</a></li>
<li class="chapter" data-level="7.2" data-path="section-7.html"><a href="section-7.html#t-"><i class="fa fa-check"></i><b>7.2</b> t 检验</a></li>
<li class="chapter" data-level="7.3" data-path="section-7.html"><a href="section-7.html#section-7.3"><i class="fa fa-check"></i><b>7.3</b> 频率检验</a></li>
<li class="chapter" data-level="7.4" data-path="section-7.html"><a href="section-7.html#anova"><i class="fa fa-check"></i><b>7.4</b> ANOVA</a></li>
<li class="chapter" data-level="7.5" data-path="section-7.html"><a href="section-7.html#section-7.5"><i class="fa fa-check"></i><b>7.5</b> 逻辑回归</a></li>
<li class="chapter" data-level="7.6" data-path="section-7.html"><a href="section-7.html#section-7.6"><i class="fa fa-check"></i><b>7.6</b> 变量同质性</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="section-8.html"><a href="section-8.html"><i class="fa fa-check"></i><b>8</b> 标准绘图</a><ul>
<li class="chapter" data-level="8.1" data-path="section-8.html"><a href="section-8.html#section-8.1"><i class="fa fa-check"></i><b>8.1</b> 直方图和密度图</a></li>
<li class="chapter" data-level="8.2" data-path="section-8.html"><a href="section-8.html#section-8.2"><i class="fa fa-check"></i><b>8.2</b> 散点图</a></li>
<li class="chapter" data-level="8.3" data-path="section-8.html"><a href="section-8.html#section-8.3"><i class="fa fa-check"></i><b>8.3</b> 箱线图</a></li>
<li class="chapter" data-level="8.4" data-path="section-8.html"><a href="section-8.html#qq-plot"><i class="fa fa-check"></i><b>8.4</b> QQ 图</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>9</b> ggplot2</a><ul>
<li class="chapter" data-level="9.1" data-path="ggplot2.html"><a href="ggplot2.html#section-9.1"><i class="fa fa-check"></i><b>9.1</b> 条形图与线图</a></li>
<li class="chapter" data-level="9.2" data-path="ggplot2.html"><a href="ggplot2.html#section-9.2"><i class="fa fa-check"></i><b>9.2</b> 绘制均值和误差线</a></li>
<li class="chapter" data-level="9.3" data-path="ggplot2.html"><a href="ggplot2.html#section-9.3"><i class="fa fa-check"></i><b>9.3</b> 分布图</a></li>
<li class="chapter" data-level="9.4" data-path="chapter1.html"><a href="chapter1.html#-1"><i class="fa fa-check"></i><b>9.4</b> 散点图</a></li>
<li class="chapter" data-level="9.5" data-path="ggplot2.html"><a href="ggplot2.html#section-9.5"><i class="fa fa-check"></i><b>9.5</b> 标题</a></li>
<li class="chapter" data-level="9.6" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-axes"><i class="fa fa-check"></i><b>9.6</b> 坐标轴</a></li>
<li class="chapter" data-level="9.7" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-legends"><i class="fa fa-check"></i><b>9.7</b> 图例</a></li>
<li class="chapter" data-level="9.8" data-path="ggplot2.html"><a href="ggplot2.html#section-9.8"><i class="fa fa-check"></i><b>9.8</b> 线条</a></li>
<li class="chapter" data-level="9.9" data-path="ggplot2.html"><a href="ggplot2.html#ggplot-facet"><i class="fa fa-check"></i><b>9.9</b> 分面</a></li>
<li class="chapter" data-level="9.10" data-path="ggplot2.html"><a href="ggplot2.html#section-9.10"><i class="fa fa-check"></i><b>9.10</b> 多图</a></li>
<li class="chapter" data-level="9.11" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-colors"><i class="fa fa-check"></i><b>9.11</b> 颜色</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="section-10.html"><a href="section-10.html"><i class="fa fa-check"></i><b>10</b> 图形混杂</a><ul>
<li class="chapter" data-level="10.1" data-path="section-10.html"><a href="section-10.html#-pdf-png-tiff-svg"><i class="fa fa-check"></i><b>10.1</b> 输出到文件 PDF-PNG-TIFF-SVG</a></li>
<li class="chapter" data-level="10.2" data-path="section-10.html"><a href="section-10.html#shape-and-linetype"><i class="fa fa-check"></i><b>10.2</b> 形状和线形</a></li>
<li class="chapter" data-level="10.3" data-path="section-10.html"><a href="section-10.html#section-10.3"><i class="fa fa-check"></i><b>10.3</b> 字体</a></li>
<li class="chapter" data-level="10.4" data-path="section-10.html"><a href="section-10.html#section-10.4"><i class="fa fa-check"></i><b>10.4</b> 抗混淆位图输出</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="section-11.html"><a href="section-11.html"><i class="fa fa-check"></i><b>11</b> 其他有趣图形</a><ul>
<li class="chapter" data-level="11.1" data-path="section-11.html"><a href="section-11.html#corr-mat"><i class="fa fa-check"></i><b>11.1</b> 相关矩阵</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="section-12.html"><a href="section-12.html"><i class="fa fa-check"></i><b>12</b> 脚本与函数</a><ul>
<li class="chapter" data-level="12.1" data-path="section-12.html"><a href="section-12.html#section-12.1"><i class="fa fa-check"></i><b>12.1</b> 创建和运行一个脚本</a></li>
<li class="chapter" data-level="12.2" data-path="section-12.html"><a href="section-12.html#section-12.2"><i class="fa fa-check"></i><b>12.2</b> 调试脚本或函数</a></li>
<li class="chapter" data-level="12.3" data-path="section-12.html"><a href="section-12.html#section-12.3"><i class="fa fa-check"></i><b>12.3</b> 测量运行的时间</a></li>
<li class="chapter" data-level="12.4" data-path="section-12.html"><a href="section-12.html#section-12.4"><i class="fa fa-check"></i><b>12.4</b> 获取包中的函数和对象列表</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="section-13.html"><a href="section-13.html"><i class="fa fa-check"></i><b>13</b> 工具</a><ul>
<li class="chapter" data-level="13.1" data-path="section-13.html"><a href="section-13.html#section-13.1"><i class="fa fa-check"></i><b>13.1</b> 生成拉丁方</a></li>
</ul></li>
<li class="appendix"><span><b>附录</b></span></li>
<li class="chapter" data-level="A" data-path="materials.html"><a href="materials.html"><i class="fa fa-check"></i><b>A</b> 资料推荐</a><ul>
<li class="chapter" data-level="A.1" data-path="09-graphs-ggplot2.html"><a href="#section-A.1"><i class="fa fa-check"></i><b>A.1</b> 书籍</a></li>
<li class="chapter" data-level="A.2" data-path="materials.html"><a href="materials.html#r-"><i class="fa fa-check"></i><b>A.2</b> R 包</a></li>
<li class="chapter" data-level="A.3" data-path="09-graphs-ggplot2.html"><a href="#section-A.3"><i class="fa fa-check"></i><b>A.3</b> 网站</a></li>
<li class="chapter" data-level="A.4" data-path="chapter1.html"><a href="chapter1.html#-2"><i class="fa fa-check"></i><b>A.4</b> 列表</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>参考文献</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">本书由 bookdown 强力驱动</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cookbook for R 中文版</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ggplot2" class="section level1">
<h1><span class="header-section-number">第 9 章</span> ggplot2</h1>
<div id="section-9.1" class="section level2">
<h2><span class="header-section-number">9.1</span> 条形图与线图</h2>
<div id="-53" class="section level3">
<h3><span class="header-section-number">9.1.1</span> 问题</h3>
<p>你想要创建基本的条形图与线图</p>
</div>
<div id="-52" class="section level3">
<h3><span class="header-section-number">9.1.2</span> 方案</h3>
<p>想要使用 <strong>ggplot2</strong> 绘制图形，数据必须是一个数据框，而且必须是长格式。</p>
<div id="-x-axis" class="section level4">
<h4><span class="header-section-number">9.1.2.1</span> 基本图形，离散 x-axis</h4>
<p>使用条形图，条形的高度通常代表这种不同的东西：</p>
<ul>
<li>每一组事件的<strong>计数</strong>，通过 <code>stat_bin()</code> 指定，<strong>ggplot2</strong> 默认使用该选项</li>
<li>数据集中某一列的<strong>值</strong>，通过 <code>stat_identity()</code> 指定</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="center">x 轴</th>
<th align="center">高度含义</th>
<th align="center">名称</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>连续</strong></td>
<td align="center"><strong>计数</strong></td>
<td align="center">直方图</td>
</tr>
<tr class="even">
<td align="center"><strong>离散</strong></td>
<td align="center"><strong>计数</strong></td>
<td align="center">条形图</td>
</tr>
<tr class="odd">
<td align="center"><strong>连续</strong></td>
<td align="center"><strong>数值</strong></td>
<td align="center">条形图</td>
</tr>
<tr class="even">
<td align="center"><strong>离散</strong></td>
<td align="center"><strong>数值</strong></td>
<td align="center">条形图</td>
</tr>
</tbody>
</table>
<div id="section-9.1.2.1.1" class="section level5">
<h5><span class="header-section-number">9.1.2.1.1</span> 有值的条形图</h5>
<p>这里有一些样例数据 (抽自 <strong>reshape2</strong> 包的 <code>tips</code> 数据集):</p>
<pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">time =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Lunch&quot;</span>, <span class="st">&quot;Dinner&quot;</span>), <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Lunch&quot;</span>, 
  <span class="st">&quot;Dinner&quot;</span>)), <span class="dt">total_bill =</span> <span class="kw">c</span>(<span class="fl">14.89</span>, <span class="fl">17.23</span>))
dat
<span class="co">#&gt;     time total_bill</span>
<span class="co">#&gt; 1  Lunch      14.89</span>
<span class="co">#&gt; 2 Dinner      17.23</span>

<span class="co"># 导入 ggplot2 分析包</span>
<span class="kw">library</span>(ggplot2)</code></pre>
<p>在这些例子中，条形的高度代表数据框某一列的<strong>值</strong>，所以使用 <code>stat=&quot;identity&quot;</code> 而不是默认的 <code>stat=&quot;bin&quot;</code>。</p>
<p>这里使用的映射变量为：</p>
<ul>
<li><code>time</code>: x-axis 和填充颜色</li>
<li><code>total_bill</code>: y-axis</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 非常基本的条形图</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-242-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 按时间填充颜色</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">fill =</span> time)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-242-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## 这和上面是一样的结果 ggplot(data=dat, aes(x=time,</span>
<span class="co">## y=total_bill)) + geom_bar(aes(fill=time),</span>
<span class="co">## stat=&#39;identity&#39;) 添加黑色的边框线</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">fill =</span> time)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-242-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 没有图例，因为这个信息是多余的</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">fill =</span> time)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-242-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>一个理想的条形图可能是下面这样的：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 添加题目，缩小箱宽，填充颜色，改变轴标签</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">fill =</span> time)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#DD8888&quot;</span>, <span class="dt">width =</span> <span class="fl">0.8</span>, 
    <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Time of day&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Total bill&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Average bill for 2 people&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-243-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>查看<a href="ggplot2.html#ggplot2-colors">颜色</a>获取更多关于颜色的信息。</p>
</div>
<div id="section-9.1.2.1.2" class="section level5">
<h5><span class="header-section-number">9.1.2.1.2</span> 计数的条形图</h5>
<p>在下面例子中，条形高度代表事件的计数。</p>
<p>我们直接使用 <strong>reshape2</strong> 的 <code>tips</code> 数据集。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(reshape2)
<span class="co"># 查看头几行</span>
<span class="kw">head</span>(tips)
<span class="co">#&gt;   total_bill  tip    sex smoker day   time size</span>
<span class="co">#&gt; 1      16.99 1.01 Female     No Sun Dinner    2</span>
<span class="co">#&gt; 2      10.34 1.66   Male     No Sun Dinner    3</span>
<span class="co">#&gt; 3      21.01 3.50   Male     No Sun Dinner    3</span>
<span class="co">#&gt; 4      23.68 3.31   Male     No Sun Dinner    2</span>
<span class="co">#&gt; 5      24.59 3.61 Female     No Sun Dinner    4</span>
<span class="co">#&gt; 6      25.29 4.71   Male     No Sun Dinner    4</span></code></pre>
<p>想要得到一个计数的条形图，不要映射变量到 <code>y</code>，使用 <code>stat=&quot;bin&quot;</code> (默认就是这个) 而不是 <code>stat=&quot;identity&quot;</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 计数的条形图</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> tips, <span class="kw">aes</span>(<span class="dt">x =</span> day)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;count&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-245-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## 和上面等同, 因为 stat=&#39;bin&#39; 是默认 ggplot(data=tips,</span>
<span class="co">## aes(x=day)) + geom_bar()</span></code></pre>
</div>
</div>
<div id="section-9.1.2.2" class="section level4">
<h4><span class="header-section-number">9.1.2.2</span> 线图</h4>
<p>对于线图，数据点必须分组从而 R 知道怎么连接这些点。如果只有一组的话，非常简单，设定 <code>group=1</code> 即可，如果是多组，需要设定分组变量。</p>
<p>下面是使用的映射变量：</p>
<ul>
<li><code>time</code>: x 轴</li>
<li><code>total_bill</code>: y 轴</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 基本的线图</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-246-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## 与上面结果一致 ggplot(data=dat, aes(x=time,</span>
<span class="co">## y=total_bill)) + geom_line(aes(group=1)) 添加点</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-246-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 改变线和点的颜色</span>
<span class="co"># 改变线的类型和点的类型，用更粗的线、更大的点</span>
<span class="co"># 用红色填充点</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-246-3.png" width="672" style="display: block; margin: auto;" /></p>
<p>理想的线图可能像下面这样：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 设定 y 轴的范围 改变轴标签</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">expand_limits</span>(<span class="dt">y =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Time of day&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Total bill&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Average bill for 2 people&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-247-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>查看<a href="ggplot2.html#ggplot2-colors">颜色</a>获取更多关于颜色的信息。查看<a href="section-10.html#shape-and-linetype">形状与线形</a> 获取更多相关内容。</p>
</div>
</div>
<div id="section-9.1.3" class="section level3">
<h3><span class="header-section-number">9.1.3</span> 有更多变量的图</h3>
<p>下面这个数据将用于接下来的例子</p>
<pre class="sourceCode r"><code class="sourceCode r">dat1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">sex =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>, 
  <span class="st">&quot;Male&quot;</span>)), <span class="dt">time =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Lunch&quot;</span>, <span class="st">&quot;Dinner&quot;</span>, <span class="st">&quot;Lunch&quot;</span>, 
  <span class="st">&quot;Dinner&quot;</span>), <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Lunch&quot;</span>, <span class="st">&quot;Dinner&quot;</span>)), <span class="dt">total_bill =</span> <span class="kw">c</span>(<span class="fl">13.53</span>, 
  <span class="fl">16.81</span>, <span class="fl">16.24</span>, <span class="fl">17.42</span>))
dat1
<span class="co">#&gt;      sex   time total_bill</span>
<span class="co">#&gt; 1 Female  Lunch      13.53</span>
<span class="co">#&gt; 2 Female Dinner      16.81</span>
<span class="co">#&gt; 3   Male  Lunch      16.24</span>
<span class="co">#&gt; 4   Male Dinner      17.42</span></code></pre>
<div id="section-9.1.3.1" class="section level4">
<h4><span class="header-section-number">9.1.3.1</span> 条形图</h4>
<p>变量映射：</p>
<ul>
<li><code>time</code>: x 轴</li>
<li><code>sex</code>: 颜色填充</li>
<li><code>total_bill</code>: y 轴</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 堆积条形图 -- 不常用</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat1, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">fill =</span> sex)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-249-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 条形图，x 轴是 time, 颜色填充是 sex</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat1, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">fill =</span> sex)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span> <span class="kw">position_dodge</span>())</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-249-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> dat1, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">fill =</span> sex)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span> <span class="kw">position_dodge</span>(), 
    <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-249-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 改变颜色</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat1, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">fill =</span> sex)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span> <span class="kw">position_dodge</span>(), 
    <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#999999&quot;</span>, 
  <span class="st">&quot;#E69F00&quot;</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-249-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>改变映射是非常容易的：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 条形图，x 轴是性别，颜色是时间</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat1, <span class="kw">aes</span>(<span class="dt">x =</span> sex, <span class="dt">y =</span> total_bill, <span class="dt">fill =</span> time)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span> <span class="kw">position_dodge</span>(), 
    <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-250-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>查看<a href="ggplot2.html#ggplot2-colors">颜色</a>获取更多关于颜色的信息。</p>
</div>
<div id="-1" class="section level4">
<h4><span class="header-section-number">9.1.3.2</span> 线图</h4>
<p>变量映射：</p>
<ul>
<li><code>time</code>: x 轴</li>
<li><code>sex</code>: 线的颜色</li>
<li><code>total_bill</code>: y 轴</li>
</ul>
<p>想要绘制多条线，必须指定分组变量，否则所有点都将通过一条线进行连接。在这个例子中，我们希望通过性别来进行分组。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 基本的带点线图</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat1, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">group =</span> sex)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-251-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 将性别映射到颜色</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat1, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">group =</span> sex, 
  <span class="dt">colour =</span> sex)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-251-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 映射性别到不同的点类型</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat1, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">group =</span> sex, 
  <span class="dt">shape =</span> sex)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-251-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 使用更粗的线、更大的点</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat1, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">group =</span> sex, 
  <span class="dt">shape =</span> sex)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>, 
  <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_shape_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="dv">22</span>, 
  <span class="dv">21</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-251-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>更改颜色和线型变量的映射非常容易：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> dat1, <span class="kw">aes</span>(<span class="dt">x =</span> sex, <span class="dt">y =</span> total_bill, <span class="dt">group =</span> time, 
  <span class="dt">shape =</span> time, <span class="dt">color =</span> time)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-252-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>查看<a href="ggplot2.html#ggplot2-colors">颜色</a>获取更多关于颜色的信息。查看<a href="section-10.html#shape-and-linetype">形状与线形</a>获取更多相关内容。</p>
</div>
<div id="section-9.1.3.3" class="section level4">
<h4><span class="header-section-number">9.1.3.3</span> 完成的例子</h4>
<p>完成的例子可能像下面这样：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 一个条形图</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat1, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">fill=</span>sex)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>,
             <span class="dt">position=</span><span class="kw">position_dodge</span>(),
             <span class="dt">size=</span>.<span class="dv">3</span>) <span class="op">+</span><span class="st">                        </span><span class="co"># 更粗的线</span>
<span class="st">    </span><span class="kw">scale_fill_hue</span>(<span class="dt">name=</span><span class="st">&quot;Sex of payer&quot;</span>) <span class="op">+</span><span class="st">      </span><span class="co"># 设定图例标题</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time of day&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Total bill&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># 设定轴标签</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Average bill for 2 people&quot;</span>) <span class="op">+</span><span class="st">     </span><span class="co"># 设定题目</span>
<span class="st">    </span><span class="kw">theme_bw</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-253-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 一个线图</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat1, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">group=</span>sex, <span class="dt">shape=</span>sex, <span class="dt">colour=</span>sex)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">linetype=</span>sex), <span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st">     </span><span class="co"># 按性别设定线型</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st">         </span><span class="co"># 使用更大的点，并用颜色填充</span>
<span class="st">    </span><span class="kw">expand_limits</span>(<span class="dt">y=</span><span class="dv">0</span>) <span class="op">+</span><span class="st">                       </span><span class="co"># 将 0 包含仅 y 轴</span>
<span class="st">    </span><span class="kw">scale_colour_hue</span>(<span class="dt">name=</span><span class="st">&quot;Sex of payer&quot;</span>,      <span class="co"># 设定图例标题</span>
                     <span class="dt">l=</span><span class="dv">30</span>)  <span class="op">+</span><span class="st">                  </span><span class="co"># 使用更深的颜色 (lightness=30)</span>
<span class="st">    </span><span class="kw">scale_shape_manual</span>(<span class="dt">name=</span><span class="st">&quot;Sex of payer&quot;</span>,
                       <span class="dt">values=</span><span class="kw">c</span>(<span class="dv">22</span>,<span class="dv">21</span>)) <span class="op">+</span><span class="st">      </span><span class="co"># </span>
<span class="st">    </span><span class="kw">scale_linetype_discrete</span>(<span class="dt">name=</span><span class="st">&quot;Sex of payer&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time of day&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Total bill&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># 设定轴标签</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Average bill for 2 people&quot;</span>) <span class="op">+</span><span class="st">     </span><span class="co"># 设定标题</span>
<span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="kw">c</span>(.<span class="dv">7</span>, <span class="fl">.4</span>))           <span class="co"># 图例的位置</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-253-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>为了保证上图的图例一致，必须指定 3 次。至于为何如此，查看<a href="ggplot2.html#ggplot2-legends">图例</a>。</p>
</div>
</div>
<div id="-x-axis" class="section level3">
<h3><span class="header-section-number">9.1.4</span> 使用数值 x-axis</h3>
<p>当 x 轴上的变量是数字时，有时需要将其视为连续变量，有时需要将其视为分类变量。在该数据集中，剂量应该是值为 <code>0.5</code>, <code>1.0</code> 和 <code>2.0</code> 的数值变量。作图时，将这些值视为相同类别可能很有用。</p>
<pre class="sourceCode r"><code class="sourceCode r">datn &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">text =</span> <span class="st">&quot;</span>
<span class="st">supp dose length</span>
<span class="st">  OJ  0.5  13.23</span>
<span class="st">  OJ  1.0  22.70</span>
<span class="st">  OJ  2.0  26.06</span>
<span class="st">  VC  0.5   7.98</span>
<span class="st">  VC  1.0  16.77</span>
<span class="st">  VC  2.0  26.14</span>
<span class="st">&quot;</span>)</code></pre>
<p>来自 <code>ToothGrowth</code> 数据集。</p>
<div id="x-axis-" class="section level4">
<h4><span class="header-section-number">9.1.4.1</span> x-axis 作为连续变量</h4>
<p>一个简单的图形可能会将剂量放在 x 轴，这种方式可以绘制一个线图。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> datn, <span class="kw">aes</span>(<span class="dt">x =</span> dose, <span class="dt">y =</span> length, <span class="dt">group =</span> supp, 
  <span class="dt">colour =</span> supp)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-255-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="x-axis-" class="section level4">
<h4><span class="header-section-number">9.1.4.2</span> x-axis 作为分类变量</h4>
<p>首先，我们要将该变量转换为因子。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 拷贝数据框并将它转换为因子</span>
datn2 &lt;-<span class="st"> </span>datn
datn2<span class="op">$</span>dose &lt;-<span class="st"> </span><span class="kw">factor</span>(datn2<span class="op">$</span>dose)
<span class="kw">ggplot</span>(<span class="dt">data =</span> datn2, <span class="kw">aes</span>(<span class="dt">x =</span> dose, <span class="dt">y =</span> length, <span class="dt">group =</span> supp, 
  <span class="dt">colour =</span> supp)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-256-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 使用原始的数据框，但使用 factor 函数在绘图时转换</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> datn, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(dose), <span class="dt">y =</span> length, <span class="dt">group =</span> supp, 
  <span class="dt">colour =</span> supp)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-256-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>当连续值作为分类变量使用时，也可以绘制条形图。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> datn2, <span class="kw">aes</span>(<span class="dt">x =</span> dose, <span class="dt">y =</span> length, <span class="dt">fill =</span> supp)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span> <span class="kw">position_dodge</span>())</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-257-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">ggplot</span>(<span class="dt">data =</span> datn, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(dose), <span class="dt">y =</span> length, <span class="dt">fill =</span> supp)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span> <span class="kw">position_dodge</span>())</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-257-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="section-9.2" class="section level2">
<h2><span class="header-section-number">9.2</span> 绘制均值和误差线</h2>
<div id="-54" class="section level3">
<h3><span class="header-section-number">9.2.1</span> 问题</h3>
<p>你想要为一个数据集绘制均值的误差线。</p>
</div>
<div id="-53" class="section level3">
<h3><span class="header-section-number">9.2.2</span> 方案</h3>
<p>想要用 <strong>ggplot2</strong> 绘制图形，数据必须是数据框形式，而且是长格式（相对于宽格式）。如果你的数据需要重构，请参考<a href="section-6.html#section-6.17">长宽格式转换</a>获取更多信息。</p>
<div id="section-9.2.2.1" class="section level4">
<h4><span class="header-section-number">9.2.2.1</span> 助手函数</h4>
<p>如果你处理的仅仅是组间变量，那么 <code>summarySE()</code> 是你代码中唯一需要使用的函数。如果你的数据里有组内变量，<strong>并且</strong>你想要矫正误差线使得组间的变异被移除，就像 Loftus and Masson (1994) 里的那样，那么 <code>normDataWithin()</code> 和 <code>summarySEwithin()</code> 这两个函数必须加入你的代码中，然后调用 <code>summarySEwithin()</code> 函数进行计算。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## Gives count, mean, standard deviation, standard error</span>
<span class="co">## of the mean, and confidence interval (default 95%).</span>
<span class="co">## data: a data frame.  measurevar: the name of a column</span>
<span class="co">## that contains the variable to be summariezed</span>
<span class="co">## groupvars: a vector containing names of columns that</span>
<span class="co">## contain grouping variables na.rm: a boolean that</span>
<span class="co">## indicates whether to ignore NA&#39;s conf.interval: the</span>
<span class="co">## percent range of the confidence interval (default is</span>
<span class="co">## 95%)</span>
summarySE &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">data =</span> <span class="ot">NULL</span>, measurevar, <span class="dt">groupvars =</span> <span class="ot">NULL</span>, 
  <span class="dt">na.rm =</span> <span class="ot">FALSE</span>, <span class="dt">conf.interval =</span> <span class="fl">0.95</span>, <span class="dt">.drop =</span> <span class="ot">TRUE</span>) {
  <span class="kw">library</span>(plyr)
  
  <span class="co"># New version of length which can handle NA&#39;s: if</span>
  <span class="co"># na.rm==T, don&#39;t count them</span>
  length2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>) {
    <span class="cf">if</span> (na.rm) 
      <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(x)) <span class="cf">else</span> <span class="kw">length</span>(x)
  }
  
  <span class="co"># This does the summary. For each group&#39;s data frame,</span>
  <span class="co"># return a vector with N, mean, and sd</span>
  datac &lt;-<span class="st"> </span><span class="kw">ddply</span>(data, groupvars, <span class="dt">.drop =</span> .drop, <span class="dt">.fun =</span> <span class="cf">function</span>(xx, 
    col) {
    <span class="kw">c</span>(<span class="dt">N =</span> <span class="kw">length2</span>(xx[[col]], <span class="dt">na.rm =</span> na.rm), <span class="dt">mean =</span> <span class="kw">mean</span>(xx[[col]], 
      <span class="dt">na.rm =</span> na.rm), <span class="dt">sd =</span> <span class="kw">sd</span>(xx[[col]], <span class="dt">na.rm =</span> na.rm))
  }, measurevar)
  
  <span class="co"># Rename the &#39;mean&#39; column</span>
  datac &lt;-<span class="st"> </span><span class="kw">rename</span>(datac, <span class="kw">c</span>(<span class="dt">mean =</span> measurevar))
  
  datac<span class="op">$</span>se &lt;-<span class="st"> </span>datac<span class="op">$</span>sd<span class="op">/</span><span class="kw">sqrt</span>(datac<span class="op">$</span>N)  <span class="co"># Calculate standard error of the mean</span>
  
  <span class="co"># Confidence interval multiplier for standard error</span>
  <span class="co"># Calculate t-statistic for confidence interval: e.g.,</span>
  <span class="co"># if conf.interval is .95, use .975 (above/below), and</span>
  <span class="co"># use df=N-1</span>
  ciMult &lt;-<span class="st"> </span><span class="kw">qt</span>(conf.interval<span class="op">/</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span>, datac<span class="op">$</span>N <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)
  datac<span class="op">$</span>ci &lt;-<span class="st"> </span>datac<span class="op">$</span>se <span class="op">*</span><span class="st"> </span>ciMult
  
  <span class="kw">return</span>(datac)
}

<span class="co">## Norms the data within specified groups in a data</span>
<span class="co">## frame; it normalizes each subject (identified by</span>
<span class="co">## idvar) so that they have the same mean, within each</span>
<span class="co">## group specified by betweenvars.  data: a data frame.</span>
<span class="co">## idvar: the name of a column that identifies each</span>
<span class="co">## subject (or matched subjects) measurevar: the name of</span>
<span class="co">## a column that contains the variable to be summariezed</span>
<span class="co">## betweenvars: a vector containing names of columns that</span>
<span class="co">## are between-subjects variables na.rm: a boolean that</span>
<span class="co">## indicates whether to ignore NA&#39;s</span>
normDataWithin &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">data =</span> <span class="ot">NULL</span>, idvar, measurevar, 
  <span class="dt">betweenvars =</span> <span class="ot">NULL</span>, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>, <span class="dt">.drop =</span> <span class="ot">TRUE</span>) {
  <span class="kw">library</span>(plyr)
  
  <span class="co"># Measure var on left, idvar + between vars on right of</span>
  <span class="co"># formula.</span>
  data.subjMean &lt;-<span class="st"> </span><span class="kw">ddply</span>(data, <span class="kw">c</span>(idvar, betweenvars), 
    <span class="dt">.drop =</span> .drop, <span class="dt">.fun =</span> <span class="cf">function</span>(xx, col, na.rm) {
      <span class="kw">c</span>(<span class="dt">subjMean =</span> <span class="kw">mean</span>(xx[, col], <span class="dt">na.rm =</span> na.rm))
    }, measurevar, na.rm)
  
  <span class="co"># Put the subject means with original data</span>
  data &lt;-<span class="st"> </span><span class="kw">merge</span>(data, data.subjMean)
  
  <span class="co"># Get the normalized data in a new column</span>
  measureNormedVar &lt;-<span class="st"> </span><span class="kw">paste</span>(measurevar, <span class="st">&quot;_norm&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
  data[, measureNormedVar] &lt;-<span class="st"> </span>data[, measurevar] <span class="op">-</span><span class="st"> </span>data[, 
    <span class="st">&quot;subjMean&quot;</span>] <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(data[, measurevar], <span class="dt">na.rm =</span> na.rm)
  
  <span class="co"># Remove this subject mean column</span>
  data<span class="op">$</span>subjMean &lt;-<span class="st"> </span><span class="ot">NULL</span>
  
  <span class="kw">return</span>(data)
}

<span class="co">## Summarizes data, handling within-subjects variables by</span>
<span class="co">## removing inter-subject variability.  It will still</span>
<span class="co">## work if there are no within-S variables.  Gives count,</span>
<span class="co">## un-normed mean, normed mean (with same between-group</span>
<span class="co">## mean), standard deviation, standard error of the mean,</span>
<span class="co">## and confidence interval.  If there are within-subject</span>
<span class="co">## variables, calculate adjusted values using method from</span>
<span class="co">## Morey (2008).  data: a data frame.  measurevar: the</span>
<span class="co">## name of a column that contains the variable to be</span>
<span class="co">## summariezed betweenvars: a vector containing names of</span>
<span class="co">## columns that are between-subjects variables</span>
<span class="co">## withinvars: a vector containing names of columns that</span>
<span class="co">## are within-subjects variables idvar: the name of a</span>
<span class="co">## column that identifies each subject (or matched</span>
<span class="co">## subjects) na.rm: a boolean that indicates whether to</span>
<span class="co">## ignore NA&#39;s conf.interval: the percent range of the</span>
<span class="co">## confidence interval (default is 95%)</span>
summarySEwithin &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">data =</span> <span class="ot">NULL</span>, measurevar, <span class="dt">betweenvars =</span> <span class="ot">NULL</span>, 
  <span class="dt">withinvars =</span> <span class="ot">NULL</span>, <span class="dt">idvar =</span> <span class="ot">NULL</span>, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>, <span class="dt">conf.interval =</span> <span class="fl">0.95</span>, 
  <span class="dt">.drop =</span> <span class="ot">TRUE</span>) {
  
  <span class="co"># Ensure that the betweenvars and withinvars are factors</span>
  factorvars &lt;-<span class="st"> </span><span class="kw">vapply</span>(data[, <span class="kw">c</span>(betweenvars, withinvars), 
    <span class="dt">drop =</span> <span class="ot">FALSE</span>], <span class="dt">FUN =</span> is.factor, <span class="dt">FUN.VALUE =</span> <span class="kw">logical</span>(<span class="dv">1</span>))
  
  <span class="cf">if</span> (<span class="op">!</span><span class="kw">all</span>(factorvars)) {
    nonfactorvars &lt;-<span class="st"> </span><span class="kw">names</span>(factorvars)[<span class="op">!</span>factorvars]
    <span class="kw">message</span>(<span class="st">&quot;Automatically converting the following non-factors to factors: &quot;</span>, 
      <span class="kw">paste</span>(nonfactorvars, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>))
    data[nonfactorvars] &lt;-<span class="st"> </span><span class="kw">lapply</span>(data[nonfactorvars], 
      factor)
  }
  
  <span class="co"># Get the means from the un-normed data</span>
  datac &lt;-<span class="st"> </span><span class="kw">summarySE</span>(data, measurevar, <span class="dt">groupvars =</span> <span class="kw">c</span>(betweenvars, 
    withinvars), <span class="dt">na.rm =</span> na.rm, <span class="dt">conf.interval =</span> conf.interval, 
    <span class="dt">.drop =</span> .drop)
  
  <span class="co"># Drop all the unused columns (these will be calculated</span>
  <span class="co"># with normed data)</span>
  datac<span class="op">$</span>sd &lt;-<span class="st"> </span><span class="ot">NULL</span>
  datac<span class="op">$</span>se &lt;-<span class="st"> </span><span class="ot">NULL</span>
  datac<span class="op">$</span>ci &lt;-<span class="st"> </span><span class="ot">NULL</span>
  
  <span class="co"># Norm each subject&#39;s data</span>
  ndata &lt;-<span class="st"> </span><span class="kw">normDataWithin</span>(data, idvar, measurevar, betweenvars, 
    na.rm, <span class="dt">.drop =</span> .drop)
  
  <span class="co"># This is the name of the new column</span>
  measurevar_n &lt;-<span class="st"> </span><span class="kw">paste</span>(measurevar, <span class="st">&quot;_norm&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
  
  <span class="co"># Collapse the normed data - now we can treat between</span>
  <span class="co"># and within vars the same</span>
  ndatac &lt;-<span class="st"> </span><span class="kw">summarySE</span>(ndata, measurevar_n, <span class="dt">groupvars =</span> <span class="kw">c</span>(betweenvars, 
    withinvars), <span class="dt">na.rm =</span> na.rm, <span class="dt">conf.interval =</span> conf.interval, 
    <span class="dt">.drop =</span> .drop)
  
  <span class="co"># Apply correction from Morey (2008) to the standard</span>
  <span class="co"># error and confidence interval Get the product of the</span>
  <span class="co"># number of conditions of within-S variables</span>
  nWithinGroups &lt;-<span class="st"> </span><span class="kw">prod</span>(<span class="kw">vapply</span>(ndatac[, withinvars, <span class="dt">drop =</span> <span class="ot">FALSE</span>], 
    <span class="dt">FUN =</span> nlevels, <span class="dt">FUN.VALUE =</span> <span class="kw">numeric</span>(<span class="dv">1</span>)))
  correctionFactor &lt;-<span class="st"> </span><span class="kw">sqrt</span>(nWithinGroups<span class="op">/</span>(nWithinGroups <span class="op">-</span><span class="st"> </span>
<span class="st">    </span><span class="dv">1</span>))
  
  <span class="co"># Apply the correction factor</span>
  ndatac<span class="op">$</span>sd &lt;-<span class="st"> </span>ndatac<span class="op">$</span>sd <span class="op">*</span><span class="st"> </span>correctionFactor
  ndatac<span class="op">$</span>se &lt;-<span class="st"> </span>ndatac<span class="op">$</span>se <span class="op">*</span><span class="st"> </span>correctionFactor
  ndatac<span class="op">$</span>ci &lt;-<span class="st"> </span>ndatac<span class="op">$</span>ci <span class="op">*</span><span class="st"> </span>correctionFactor
  
  <span class="co"># Combine the un-normed means with the normed results</span>
  <span class="kw">merge</span>(datac, ndatac)
}</code></pre>
</div>
<div id="section-9.2.2.2" class="section level4">
<h4><span class="header-section-number">9.2.2.2</span> 示例数据</h4>
<p>下面的示例将使用 <code>ToothGrowth</code> 数据集。注意 <code>dose</code> 在这里是一个数值列，一些情况下我们将它转换为因子变量将会更加有用。</p>
<pre class="sourceCode r"><code class="sourceCode r">tg &lt;-<span class="st"> </span>ToothGrowth
<span class="kw">head</span>(tg)
<span class="co">#&gt;    len supp dose</span>
<span class="co">#&gt; 1  4.2   VC  0.5</span>
<span class="co">#&gt; 2 11.5   VC  0.5</span>
<span class="co">#&gt; 3  7.3   VC  0.5</span>
<span class="co">#&gt; 4  5.8   VC  0.5</span>
<span class="co">#&gt; 5  6.4   VC  0.5</span>
<span class="co">#&gt; 6 10.0   VC  0.5</span>
<span class="kw">library</span>(ggplot2)</code></pre>
<p>首先，我们必须对数据进行统计汇总。 这可以通过多种方式实现，参阅<a href="section-6.html#section-6.18">汇总数据</a>。在这个案例中，我们将使用 <code>summarySE()</code> 函数( 确保<code>summarySE()</code> 函数的代码在使用前已经键入)。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(&#39;Rmisc&#39;)</span>
<span class="kw">library</span>(Rmisc)
<span class="co">#&gt; Loading required package: lattice</span>
<span class="co">#&gt; Loading required package: plyr</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: &#39;Rmisc&#39;</span>
<span class="co">#&gt; The following objects are masked _by_ &#39;.GlobalEnv&#39;:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     normDataWithin, summarySE, summarySEwithin</span>
<span class="co"># summarySE 函数提供了标准差、标准误以及 95% 的置信区间</span>
tgc &lt;-<span class="st"> </span><span class="kw">summarySE</span>(tg, <span class="dt">measurevar =</span> <span class="st">&quot;len&quot;</span>, <span class="dt">groupvars =</span> <span class="kw">c</span>(<span class="st">&quot;supp&quot;</span>, 
  <span class="st">&quot;dose&quot;</span>))
tgc
<span class="co">#&gt;   supp dose  N   len    sd     se    ci</span>
<span class="co">#&gt; 1   OJ  0.5 10 13.23 4.460 1.4103 3.190</span>
<span class="co">#&gt; 2   OJ  1.0 10 22.70 3.911 1.2368 2.798</span>
<span class="co">#&gt; 3   OJ  2.0 10 26.06 2.655 0.8396 1.899</span>
<span class="co">#&gt; 4   VC  0.5 10  7.98 2.747 0.8686 1.965</span>
<span class="co">#&gt; 5   VC  1.0 10 16.77 2.515 0.7954 1.799</span>
<span class="co">#&gt; 6   VC  2.0 10 26.14 4.798 1.5172 3.432</span></code></pre>
</div>
<div id="-2" class="section level4">
<h4><span class="header-section-number">9.2.2.3</span> 线图</h4>
<p>数据统计总结后，我们就可以开始绘制图形了。这里是一些带误差线的线图和点图，误差线代表标准差、标准误或者是 95% 的置信区间。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 均值的标准误</span>
<span class="kw">ggplot</span>(tgc, <span class="kw">aes</span>(<span class="dt">x =</span> dose, <span class="dt">y =</span> len, <span class="dt">colour =</span> supp)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> len <span class="op">-</span><span class="st"> </span>
<span class="st">  </span>se, <span class="dt">ymax =</span> len <span class="op">+</span><span class="st"> </span>se), <span class="dt">width =</span> <span class="fl">0.1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-261-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 发现误差线重叠（dose=2.0），我们使用 position_dodge</span>
<span class="co"># 将它们进行水平移动</span>
pd &lt;-<span class="st"> </span><span class="kw">position_dodge</span>(<span class="fl">0.1</span>)  <span class="co"># move them .05 to the left and right</span>

<span class="kw">ggplot</span>(tgc, <span class="kw">aes</span>(<span class="dt">x =</span> dose, <span class="dt">y =</span> len, <span class="dt">colour =</span> supp)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> len <span class="op">-</span><span class="st"> </span>
<span class="st">  </span>se, <span class="dt">ymax =</span> len <span class="op">+</span><span class="st"> </span>se), <span class="dt">width =</span> <span class="fl">0.1</span>, <span class="dt">position =</span> pd) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">position =</span> pd) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">position =</span> pd)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-261-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 使用 95% 置信区间替换标准误</span>
<span class="kw">ggplot</span>(tgc, <span class="kw">aes</span>(<span class="dt">x =</span> dose, <span class="dt">y =</span> len, <span class="dt">colour =</span> supp)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> len <span class="op">-</span><span class="st"> </span>
<span class="st">  </span>ci, <span class="dt">ymax =</span> len <span class="op">+</span><span class="st"> </span>ci), <span class="dt">width =</span> <span class="fl">0.1</span>, <span class="dt">position =</span> pd) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">position =</span> pd) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">position =</span> pd)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-261-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 黑色的误差线 - 注意 &#39;group=supp&#39; 的映射 --</span>
<span class="co"># 没有它，误差线将不会避开（就是会重叠）。</span>
<span class="kw">ggplot</span>(tgc, <span class="kw">aes</span>(<span class="dt">x =</span> dose, <span class="dt">y =</span> len, <span class="dt">colour =</span> supp, <span class="dt">group =</span> supp)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> len <span class="op">-</span><span class="st"> </span>ci, <span class="dt">ymax =</span> len <span class="op">+</span><span class="st"> </span>ci), 
    <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">width =</span> <span class="fl">0.1</span>, <span class="dt">position =</span> pd) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">position =</span> pd) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">position =</span> pd, 
  <span class="dt">size =</span> <span class="dv">3</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-261-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>一张完成的带误差线（代表均值的标准误）的图形可能像下面显示的那样。最后画点，这样白色将会在线和误差线的上面（这个需要理解图层概念，顺序不同展示的效果是不一样的）。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tgc, <span class="kw">aes</span>(<span class="dt">x=</span>dose, <span class="dt">y=</span>len, <span class="dt">colour=</span>supp, <span class="dt">group=</span>supp)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>len<span class="op">-</span>se, <span class="dt">ymax=</span>len<span class="op">+</span>se), <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">width=</span>.<span class="dv">1</span>, <span class="dt">position=</span>pd) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">position=</span>pd) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">position=</span>pd, <span class="dt">size=</span><span class="dv">3</span>, <span class="dt">shape=</span><span class="dv">21</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># 21的填充的圆</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Dose (mg)&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Tooth length&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_colour_hue</span>(<span class="dt">name=</span><span class="st">&quot;Supplement type&quot;</span>,    <span class="co"># 图例标签使用暗色</span>
                     <span class="dt">breaks=</span><span class="kw">c</span>(<span class="st">&quot;OJ&quot;</span>, <span class="st">&quot;VC&quot;</span>),
                     <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;Orange juice&quot;</span>, <span class="st">&quot;Ascorbic acid&quot;</span>),
                     <span class="dt">l=</span><span class="dv">40</span>) <span class="op">+</span><span class="st">                    </span><span class="co"># 使用暗色，亮度为40</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;The Effect of Vitamin C on</span><span class="ch">\n</span><span class="st">Tooth Growth in Guinea Pigs&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">expand_limits</span>(<span class="dt">y=</span><span class="dv">0</span>) <span class="op">+</span><span class="st">                        </span><span class="co"># 扩展范围</span>
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="dv">0</span><span class="op">:</span><span class="dv">20</span><span class="op">*</span><span class="dv">4</span>) <span class="op">+</span><span class="st">         </span><span class="co"># 每4个单位设置标记（y轴）</span>
<span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.justification=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>),
          <span class="dt">legend.position=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>))               <span class="co"># 右下方放置图例</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-262-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="-1" class="section level4">
<h4><span class="header-section-number">9.2.2.4</span> 条形图</h4>
<p>条形图绘制误差线也非常相似。 注意 <code>tgc$dose</code> 必须是一个因子。如果它是一个数值向量，将会不起作用。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 将dose转换为因子变量</span>
tgc2 &lt;-<span class="st"> </span>tgc
tgc2<span class="op">$</span>dose &lt;-<span class="st"> </span><span class="kw">factor</span>(tgc2<span class="op">$</span>dose)

<span class="co"># 误差线代表了均值的标准误</span>
<span class="kw">ggplot</span>(tgc2, <span class="kw">aes</span>(<span class="dt">x=</span>dose, <span class="dt">y=</span>len, <span class="dt">fill=</span>supp)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(), <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>len<span class="op">-</span>se, <span class="dt">ymax=</span>len<span class="op">+</span>se),
                  <span class="dt">width=</span>.<span class="dv">2</span>,                    <span class="co"># 误差线的宽度</span>
                  <span class="dt">position=</span><span class="kw">position_dodge</span>(.<span class="dv">9</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-263-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 使用95%的置信区间替换标准误</span>
<span class="kw">ggplot</span>(tgc2, <span class="kw">aes</span>(<span class="dt">x=</span>dose, <span class="dt">y=</span>len, <span class="dt">fill=</span>supp)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(), <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>len<span class="op">-</span>ci, <span class="dt">ymax=</span>len<span class="op">+</span>ci),
                  <span class="dt">width=</span>.<span class="dv">2</span>,                    <span class="co"># 误差线的宽度</span>
                  <span class="dt">position=</span><span class="kw">position_dodge</span>(.<span class="dv">9</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-263-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>一张绘制完成的图片像下面这样：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tgc2, <span class="kw">aes</span>(<span class="dt">x=</span>dose, <span class="dt">y=</span>len, <span class="dt">fill=</span>supp)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(), <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>,
             <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="co"># 使用黑色边框,</span>
             <span class="dt">size=</span>.<span class="dv">3</span>) <span class="op">+</span><span class="st">      </span><span class="co"># 将线变细</span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>len<span class="op">-</span>se, <span class="dt">ymax=</span>len<span class="op">+</span>se),
                  <span class="dt">size=</span>.<span class="dv">3</span>,    <span class="co"># 将线变细</span>
                  <span class="dt">width=</span>.<span class="dv">2</span>,
                  <span class="dt">position=</span><span class="kw">position_dodge</span>(.<span class="dv">9</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Dose (mg)&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Tooth length&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_hue</span>(<span class="dt">name=</span><span class="st">&quot;Supplement type&quot;</span>, <span class="co"># Legend label, use darker colors</span>
                   <span class="dt">breaks=</span><span class="kw">c</span>(<span class="st">&quot;OJ&quot;</span>, <span class="st">&quot;VC&quot;</span>),
                   <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;Orange juice&quot;</span>, <span class="st">&quot;Ascorbic acid&quot;</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;The Effect of Vitamin C on</span><span class="ch">\n</span><span class="st">Tooth Growth in Guinea Pigs&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="dv">0</span><span class="op">:</span><span class="dv">20</span><span class="op">*</span><span class="dv">4</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme_bw</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-264-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.2.2.5" class="section level4">
<h4><span class="header-section-number">9.2.2.5</span> 为组内变量添加误差线</h4>
<p>当所有的变量都属于不同组别时，我们画标准误或者置信区间会显得非常简单直观。然而，当我们描绘的是组内变量（重复测量），那么添加标准误或者通常的置信区间可能会对不同条件下差异的推断产生误导作用。</p>
<p>下面的方法来自 <a href="http://tqmp.org/Content/vol04-2/p061/p061.html">Morey (2008)</a>，它是对 <a href="http://tqmp.org/Content/vol01-1/p042/p042.html">Cousineau (2005)</a>的矫正，而它所做的就是 提供比 <a href="http://www.springerlink.com/content/n2r2t04244246k68/">Loftus and Masson (1994)</a>更简单的方法。 你可以查看这些文章，以获得更多对组内变量误差线问题的详细探讨和方案。</p>
<p>这里有一个组内变量的数据集 (来自 Morey 2008)，包含 <code>pre/post-test</code>。</p>
<pre class="sourceCode r"><code class="sourceCode r">dfw &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">text =</span> <span class="st">&quot;</span>
<span class="st"> subject pretest posttest</span>
<span class="st">     1    59.4     64.5</span>
<span class="st">     2    46.4     52.4</span>
<span class="st">     3    46.0     49.7</span>
<span class="st">     4    49.0     48.7</span>
<span class="st">     5    32.5     37.4</span>
<span class="st">     6    45.2     49.5</span>
<span class="st">     7    60.3     59.9</span>
<span class="st">     8    54.3     54.1</span>
<span class="st">     9    45.4     49.6</span>
<span class="st">    10    38.9     48.5</span>
<span class="st"> &quot;</span>)

<span class="co"># 将物体的 ID 作为因子变量对待</span>
dfw<span class="op">$</span>subject &lt;-<span class="st"> </span><span class="kw">factor</span>(dfw<span class="op">$</span>subject)</code></pre>
<p>第一步是将该数据集转换为长格式，参见<a href="section-6.html#section-6.17">长宽格式数据互换</a>获取更多信息。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 转换为长格式</span>
<span class="kw">library</span>(reshape2)
dfw_long &lt;-<span class="st"> </span><span class="kw">melt</span>(dfw, <span class="dt">id.vars =</span> <span class="st">&quot;subject&quot;</span>, <span class="dt">measure.vars =</span> <span class="kw">c</span>(<span class="st">&quot;pretest&quot;</span>, 
  <span class="st">&quot;posttest&quot;</span>), <span class="dt">variable.name =</span> <span class="st">&quot;condition&quot;</span>)

dfw_long
<span class="co">#&gt;    subject condition value</span>
<span class="co">#&gt; 1        1   pretest  59.4</span>
<span class="co">#&gt; 2        2   pretest  46.4</span>
<span class="co">#&gt; 3        3   pretest  46.0</span>
<span class="co">#&gt; 4        4   pretest  49.0</span>
<span class="co">#&gt; 5        5   pretest  32.5</span>
<span class="co">#&gt; 6        6   pretest  45.2</span>
<span class="co">#&gt; 7        7   pretest  60.3</span>
<span class="co">#&gt; 8        8   pretest  54.3</span>
<span class="co">#&gt; 9        9   pretest  45.4</span>
<span class="co">#&gt; 10      10   pretest  38.9</span>
<span class="co">#&gt; 11       1  posttest  64.5</span>
<span class="co">#&gt; 12       2  posttest  52.4</span>
<span class="co">#&gt; 13       3  posttest  49.7</span>
<span class="co">#&gt; 14       4  posttest  48.7</span>
<span class="co">#&gt; 15       5  posttest  37.4</span>
<span class="co">#&gt; 16       6  posttest  49.5</span>
<span class="co">#&gt; 17       7  posttest  59.9</span>
<span class="co">#&gt; 18       8  posttest  54.1</span>
<span class="co">#&gt; 19       9  posttest  49.6</span>
<span class="co">#&gt; 20      10  posttest  48.5</span></code></pre>
<p>使用 <code>summarySEwithin()</code> 函数拆解数据。</p>
<pre class="sourceCode r"><code class="sourceCode r">dfwc &lt;-<span class="st"> </span><span class="kw">summarySEwithin</span>(dfw_long, <span class="dt">measurevar =</span> <span class="st">&quot;value&quot;</span>, 
  <span class="dt">withinvars =</span> <span class="st">&quot;condition&quot;</span>, <span class="dt">idvar =</span> <span class="st">&quot;subject&quot;</span>, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>, 
  <span class="dt">conf.interval =</span> <span class="fl">0.95</span>)

dfwc
<span class="co">#&gt;   condition  N value value_norm    sd     se    ci</span>
<span class="co">#&gt; 1  posttest 10 51.43      51.43 2.262 0.7154 1.618</span>
<span class="co">#&gt; 2   pretest 10 47.74      47.74 2.262 0.7154 1.618</span>

<span class="kw">library</span>(ggplot2)
<span class="co"># 创建带 95% 置信区间的图形</span>
<span class="kw">ggplot</span>(dfwc, <span class="kw">aes</span>(<span class="dt">x =</span> condition, <span class="dt">y =</span> value, <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="dt">width =</span> <span class="fl">0.1</span>, <span class="kw">aes</span>(<span class="dt">ymin =</span> value <span class="op">-</span><span class="st"> </span>
<span class="st">  </span>ci, <span class="dt">ymax =</span> value <span class="op">+</span><span class="st"> </span>ci)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">size =</span> <span class="dv">3</span>, 
  <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">40</span>, <span class="dv">60</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-267-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><code>value</code> 和 <code>value_norm</code> 列代表了未标准化和标准化后的值。</p>
</div>
<div id="section-9.2.2.6" class="section level4">
<h4><span class="header-section-number">9.2.2.6</span> 理解组内变量的误差线</h4>
<p>这部分解释组内的误差线值是如何计算出来的。这些步骤仅作解释目的；它们对于绘制误差线是<strong>非必需</strong>的。</p>
<p>下面独立数据的图形结果展示了组内变量 <code>condition</code> 存在连续一致的趋势，但使用常规的标准误（或者置信区间）则不能充分地展示这一点。Morey (2008) 和Cousineau (2005) 的方法本质是标准化数据去移除组间的变化，计算出这个标准化数据的变异程度。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 使用一致的 y 轴范围</span>
ymax &lt;-<span class="st"> </span><span class="kw">max</span>(dfw_long<span class="op">$</span>value)
ymin &lt;-<span class="st"> </span><span class="kw">min</span>(dfw_long<span class="op">$</span>value)

<span class="co"># 绘制个体数据</span>
<span class="kw">ggplot</span>(dfw_long, <span class="kw">aes</span>(<span class="dt">x =</span> condition, <span class="dt">y =</span> value, <span class="dt">colour =</span> subject, 
  <span class="dt">group =</span> subject)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, 
  <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(ymin, ymax)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-268-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 创造标准化的版本</span>
dfwNorm.long &lt;-<span class="st"> </span><span class="kw">normDataWithin</span>(<span class="dt">data =</span> dfw_long, <span class="dt">idvar =</span> <span class="st">&quot;subject&quot;</span>, 
  <span class="dt">measurevar =</span> <span class="st">&quot;value&quot;</span>)

<span class="co"># 绘制标准化的个体数据</span>
<span class="kw">ggplot</span>(dfwNorm.long, <span class="kw">aes</span>(<span class="dt">x =</span> condition, <span class="dt">y =</span> value_norm, 
  <span class="dt">colour =</span> subject, <span class="dt">group =</span> subject)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(ymin, 
  ymax)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-268-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>针对正常（组间）方法和组内方法的误差线差异在下面呈现。正常的方法计算出的误差线用红色表示，组内方法的误差线用黑色表示。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Instead of summarySEwithin, use summarySE, which</span>
<span class="co"># treats condition as though it were a between-subjects</span>
<span class="co"># variable</span>
dfwc_between &lt;-<span class="st"> </span><span class="kw">summarySE</span>(<span class="dt">data =</span> dfw_long, <span class="dt">measurevar =</span> <span class="st">&quot;value&quot;</span>, 
  <span class="dt">groupvars =</span> <span class="st">&quot;condition&quot;</span>, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>, <span class="dt">conf.interval =</span> <span class="fl">0.95</span>)
dfwc_between
<span class="co">#&gt;   condition  N value    sd    se    ci</span>
<span class="co">#&gt; 1   pretest 10 47.74 8.599 2.719 6.151</span>
<span class="co">#&gt; 2  posttest 10 51.43 7.254 2.294 5.189</span>

<span class="co"># 用红色显示组间的置信区间，用黑色展示组内的置信区间</span>
<span class="kw">ggplot</span>(dfwc_between, <span class="kw">aes</span>(<span class="dt">x =</span> condition, <span class="dt">y =</span> value, <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="dt">width =</span> <span class="fl">0.1</span>, <span class="kw">aes</span>(<span class="dt">ymin =</span> value <span class="op">-</span><span class="st"> </span>
<span class="st">  </span>ci, <span class="dt">ymax =</span> value <span class="op">+</span><span class="st"> </span>ci), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="dt">width =</span> <span class="fl">0.1</span>, 
  <span class="kw">aes</span>(<span class="dt">ymin =</span> value <span class="op">-</span><span class="st"> </span>ci, <span class="dt">ymax =</span> value <span class="op">+</span><span class="st"> </span>ci), <span class="dt">data =</span> dfwc) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(ymin, 
  ymax)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-269-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.2.2.7" class="section level4">
<h4><span class="header-section-number">9.2.2.7</span> 两个组内变量</h4>
<p>如果存在超过一个的组内变量，我们可以使用相同的函数 <code>summarySEwithin</code>。下面的数据集来自 <a href="http://books.google.com/books?id=zSi2AAAAIAAJ">Hays (1994)</a>，在 <a href="http://www.jstor.org/pss/40064075">Rouder and Morey (2005)</a> 中用来绘制这类的组内误差线。</p>
<pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">text =</span> <span class="st">&quot;</span>
<span class="st"> Subject RoundMono SquareMono RoundColor SquareColor</span>
<span class="st">     1        41         40         41          37</span>
<span class="st">     2        57         56         56          53</span>
<span class="st">     3        52         53         53          50</span>
<span class="st">     4        49         47         47          47</span>
<span class="st">     5        47         48         48          47</span>
<span class="st">     6        37         34         35          36</span>
<span class="st">     7        47         50         47          46</span>
<span class="st">     8        41         40         38          40</span>
<span class="st">     9        48         47         49          45</span>
<span class="st">    10        37         35         36          35</span>
<span class="st">    11        32         31         31          33</span>
<span class="st">    12        47         42         42          42</span>
<span class="st">&quot;</span>)</code></pre>
<p>数据集首先必须转换为长格式，列名显示了两个变量： 形状 (圆形/方形) 和配色方案 (黑白/有色)。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 转换为长格式</span>
<span class="kw">library</span>(reshape2)
data_long &lt;-<span class="st"> </span><span class="kw">melt</span>(<span class="dt">data =</span> data, <span class="dt">id.var =</span> <span class="st">&quot;Subject&quot;</span>, <span class="dt">measure.vars =</span> <span class="kw">c</span>(<span class="st">&quot;RoundMono&quot;</span>, 
  <span class="st">&quot;SquareMono&quot;</span>, <span class="st">&quot;RoundColor&quot;</span>, <span class="st">&quot;SquareColor&quot;</span>), <span class="dt">variable.name =</span> <span class="st">&quot;Condition&quot;</span>)
<span class="kw">names</span>(data_long)[<span class="kw">names</span>(data_long) <span class="op">==</span><span class="st"> &quot;value&quot;</span>] &lt;-<span class="st"> &quot;Time&quot;</span>

<span class="co"># 拆分 Condition 列为 Shape 和 ColorScheme</span>
data_long<span class="op">$</span>Shape &lt;-<span class="st"> </span><span class="ot">NA</span>
data_long<span class="op">$</span>Shape[<span class="kw">grepl</span>(<span class="st">&quot;^Round&quot;</span>, data_long<span class="op">$</span>Condition)] &lt;-<span class="st"> &quot;Round&quot;</span>
data_long<span class="op">$</span>Shape[<span class="kw">grepl</span>(<span class="st">&quot;^Square&quot;</span>, data_long<span class="op">$</span>Condition)] &lt;-<span class="st"> &quot;Square&quot;</span>
data_long<span class="op">$</span>Shape &lt;-<span class="st"> </span><span class="kw">factor</span>(data_long<span class="op">$</span>Shape)

data_long<span class="op">$</span>ColorScheme &lt;-<span class="st"> </span><span class="ot">NA</span>
data_long<span class="op">$</span>ColorScheme[<span class="kw">grepl</span>(<span class="st">&quot;Mono$&quot;</span>, data_long<span class="op">$</span>Condition)] &lt;-<span class="st"> &quot;Monochromatic&quot;</span>
data_long<span class="op">$</span>ColorScheme[<span class="kw">grepl</span>(<span class="st">&quot;Color$&quot;</span>, data_long<span class="op">$</span>Condition)] &lt;-<span class="st"> &quot;Colored&quot;</span>
data_long<span class="op">$</span>ColorScheme &lt;-<span class="st"> </span><span class="kw">factor</span>(data_long<span class="op">$</span>ColorScheme, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Monochromatic&quot;</span>, 
  <span class="st">&quot;Colored&quot;</span>))

<span class="co"># 删除 Condition 列</span>
data_long<span class="op">$</span>Condition &lt;-<span class="st"> </span><span class="ot">NULL</span>

<span class="co"># 检查数据</span>
<span class="kw">head</span>(data_long)
<span class="co">#&gt;   Subject Time Shape   ColorScheme</span>
<span class="co">#&gt; 1       1   41 Round Monochromatic</span>
<span class="co">#&gt; 2       2   57 Round Monochromatic</span>
<span class="co">#&gt; 3       3   52 Round Monochromatic</span>
<span class="co">#&gt; 4       4   49 Round Monochromatic</span>
<span class="co">#&gt; 5       5   47 Round Monochromatic</span>
<span class="co">#&gt; 6       6   37 Round Monochromatic</span></code></pre>
<p>现在可以进行统计汇总和绘图了。</p>
<pre class="sourceCode r"><code class="sourceCode r">datac &lt;-<span class="st"> </span><span class="kw">summarySEwithin</span>(data_long, <span class="dt">measurevar =</span> <span class="st">&quot;Time&quot;</span>, 
  <span class="dt">withinvars =</span> <span class="kw">c</span>(<span class="st">&quot;Shape&quot;</span>, <span class="st">&quot;ColorScheme&quot;</span>), <span class="dt">idvar =</span> <span class="st">&quot;Subject&quot;</span>)
datac
<span class="co">#&gt;    Shape   ColorScheme  N  Time Time_norm    sd     se</span>
<span class="co">#&gt; 1  Round       Colored 12 43.58     43.58 1.212 0.3500</span>
<span class="co">#&gt; 2  Round Monochromatic 12 44.58     44.58 1.331 0.3844</span>
<span class="co">#&gt; 3 Square       Colored 12 42.58     42.58 1.462 0.4219</span>
<span class="co">#&gt; 4 Square Monochromatic 12 43.58     43.58 1.261 0.3641</span>
<span class="co">#&gt;       ci</span>
<span class="co">#&gt; 1 0.7703</span>
<span class="co">#&gt; 2 0.8460</span>
<span class="co">#&gt; 3 0.9287</span>
<span class="co">#&gt; 4 0.8014</span>

<span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>(datac, <span class="kw">aes</span>(<span class="dt">x =</span> Shape, <span class="dt">y =</span> Time, <span class="dt">fill =</span> ColorScheme)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="fl">0.9</span>), <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, 
    <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="fl">0.9</span>), 
  <span class="dt">width =</span> <span class="fl">0.25</span>, <span class="kw">aes</span>(<span class="dt">ymin =</span> Time <span class="op">-</span><span class="st"> </span>ci, <span class="dt">ymax =</span> Time <span class="op">+</span><span class="st"> </span>ci)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">40</span>, <span class="dv">46</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#CCCCCC&quot;</span>, 
  <span class="st">&quot;#FFFFFF&quot;</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">38</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-272-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.2.2.8" class="section level4">
<h4><span class="header-section-number">9.2.2.8</span> 注意标准化的均值</h4>
<p>函数 <code>summarySEWithin()</code> 返回标准化和未标准化的均值。未标准化的均值只是简单地表示每组的均值。标准化的均值计算出来保证组间的均值是一样的。</p>
<p>比如：</p>
<pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">text =</span> <span class="st">&quot;</span>
<span class="st">id trial gender dv</span>
<span class="st"> A     0   male  2</span>
<span class="st"> A     1   male  4</span>
<span class="st"> B     0   male  6</span>
<span class="st"> B     1   male  8</span>
<span class="st"> C     0 female 22</span>
<span class="st"> C     1 female 24</span>
<span class="st"> D     0 female 26</span>
<span class="st"> D     1 female 28</span>
<span class="st">&quot;</span>)

<span class="co"># 标准化和未标准化的均值是不同的</span>
<span class="kw">summarySEwithin</span>(dat, <span class="dt">measurevar =</span> <span class="st">&quot;dv&quot;</span>, <span class="dt">withinvars =</span> <span class="st">&quot;trial&quot;</span>, 
  <span class="dt">betweenvars =</span> <span class="st">&quot;gender&quot;</span>, <span class="dt">idvar =</span> <span class="st">&quot;id&quot;</span>)
<span class="co">#&gt; Automatically converting the following non-factors to factors: trial</span>
<span class="co">#&gt;   gender trial N dv dv_norm sd se ci</span>
<span class="co">#&gt; 1 female     0 2 24      14  0  0  0</span>
<span class="co">#&gt; 2 female     1 2 26      16  0  0  0</span>
<span class="co">#&gt; 3   male     0 2  4      14  0  0  0</span>
<span class="co">#&gt; 4   male     1 2  6      16  0  0  0</span></code></pre>
</div>
</div>
<div id="-1" class="section level3">
<h3><span class="header-section-number">9.2.3</span> 其他</h3>
<p>解决问题的方法不止作者提供的这一种，为了理解 <strong>ggplot2</strong> 是如何进行误差线的计算和添加，我在 stackoverflow 上提交了一个关于 <a href="https://stackoverflow.com/questions/46192556/errorbar-in-ggplot-is-using-sd-or-se-as-default">ggplot2 使用 SE 还是 SD 作为默认误差线的问题</a>。有人就给出了快速简易的解答。回答者的共同观点是必须先进行数据的统计计算。我之前在其他博客上看到使用 <code>stat_boxplot(geom=&quot;errorbar&quot;, width=.3)</code> 直接计算误差线可能就有问题（难以解释它算的是 SD 还是 SE）。</p>
</div>
</div>
<div id="section-9.3" class="section level2">
<h2><span class="header-section-number">9.3</span> 分布图</h2>
<div id="-55" class="section level3">
<h3><span class="header-section-number">9.3.1</span> 问题</h3>
<p>你想要绘制一组数据的分布图。</p>
</div>
<div id="-54" class="section level3">
<h3><span class="header-section-number">9.3.2</span> 方案</h3>
<p>后面的例子中会使用以下这组简单的数据：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)
dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cond =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="dt">each =</span> <span class="dv">200</span>)), 
  <span class="dt">rating =</span> <span class="kw">c</span>(<span class="kw">rnorm</span>(<span class="dv">200</span>), <span class="kw">rnorm</span>(<span class="dv">200</span>, <span class="dt">mean =</span> <span class="fl">0.8</span>)))
<span class="co"># 查看数据</span>
<span class="kw">head</span>(dat)
<span class="co">#&gt;   cond  rating</span>
<span class="co">#&gt; 1    A -1.2071</span>
<span class="co">#&gt; 2    A  0.2774</span>
<span class="co">#&gt; 3    A  1.0844</span>
<span class="co">#&gt; 4    A -2.3457</span>
<span class="co">#&gt; 5    A  0.4291</span>
<span class="co">#&gt; 6    A  0.5061</span>

<span class="kw">library</span>(ggplot2)</code></pre>
<div id="section-9.3.2.1" class="section level4">
<h4><span class="header-section-number">9.3.2.1</span> 直方图和概率密度图</h4>
<p><code>qplot()</code> 函数能够用更简单的语法绘制出与 <code>ggplot()</code> 相同的图像。然而，在实践过程中你会发现 <code>ggplot()</code> 是更好的选择，因为 <code>qplot()</code> 中很多参数的选项都会让人感到困惑。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 以 rating 为横轴绘制直方图，组距设为 0.5</span>
<span class="co"># 两种函数都可以绘制出相同的图:</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span>.<span class="dv">5</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-275-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># qplot(dat$rating, binwidth=.5)</span>
<span class="co"># 绘制黑色边线，白色填充的图</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span>.<span class="dv">5</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-275-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 密度曲线</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-275-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 直方图与核密度曲线重叠</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y=</span>..density..),      <span class="co"># 这里直方图以 density (密度)为y轴</span>
                   <span class="dt">binwidth=</span>.<span class="dv">5</span>,
                   <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_density</span>(<span class="dt">alpha=</span>.<span class="dv">2</span>, <span class="dt">fill=</span><span class="st">&quot;#FF6666&quot;</span>)  <span class="co"># 重合部分透明填充</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-275-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>添加一条均值线：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span>.<span class="dv">5</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept=</span><span class="kw">mean</span>(rating, <span class="dt">na.rm=</span>T)),   <span class="co"># 忽略缺失值</span>
               <span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-276-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.3.2.2" class="section level4">
<h4><span class="header-section-number">9.3.2.2</span> 多组数据的直方图和概率密度图</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 重叠直方图</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> rating, <span class="dt">fill =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>, 
  <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>)  <span class="co"># identity 表示将每个对象直接显示在图中，条形会彼此重叠。</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-277-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 间隔直方图</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> rating, <span class="dt">fill =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>, 
  <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)  <span class="co"># dodge 表示将每组的条形依次并列放置。</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-277-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 密度图</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> rating, <span class="dt">colour =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-277-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 半透明填充的密度图</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> rating, <span class="dt">fill =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-277-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>在给每组数据添加均值线前，需要将每组数据的平均值赋值到一个新的数据框。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 求均值</span>
<span class="kw">library</span>(plyr)
cdat &lt;-<span class="st"> </span><span class="kw">ddply</span>(dat, <span class="st">&quot;cond&quot;</span>, summarise, <span class="dt">rating.mean =</span> <span class="kw">mean</span>(rating))
cdat
<span class="co">#&gt;   cond rating.mean</span>
<span class="co">#&gt; 1    A    -0.05776</span>
<span class="co">#&gt; 2    B     0.87325</span>

<span class="co"># 给重叠直方图添加均值线</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> rating, <span class="dt">fill =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>, 
  <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_vline</span>(<span class="dt">data =</span> cdat, 
  <span class="kw">aes</span>(<span class="dt">xintercept =</span> rating.mean, <span class="dt">colour =</span> cond), <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>, 
  <span class="dt">size =</span> <span class="dv">1</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-278-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 给密度图添加均值线</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> rating, <span class="dt">colour =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">data =</span> cdat, <span class="kw">aes</span>(<span class="dt">xintercept =</span> rating.mean, 
    <span class="dt">colour =</span> cond), <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-278-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>使用分面：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> rating)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>, 
  <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(cond <span class="op">~</span><span class="st"> </span>
<span class="st">  </span>.)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-279-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 使用之前的 cdat 添加均值线</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> rating)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>, 
  <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(cond <span class="op">~</span><span class="st"> </span>
<span class="st">  </span>.) <span class="op">+</span><span class="st"> </span><span class="kw">geom_vline</span>(<span class="dt">data =</span> cdat, <span class="kw">aes</span>(<span class="dt">xintercept =</span> rating.mean), 
  <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-279-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>更多关于分面的细节可查看<a href="ggplot2.html#ggplot-facet">分面</a></p>
</div>
<div id="section-9.3.2.3" class="section level4">
<h4><span class="header-section-number">9.3.2.3</span> 箱型图</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 绘制箱型图</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> rating)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-280-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 对分组填充颜色</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> rating, <span class="dt">fill =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-280-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 将上图中冗余的图例删除掉：</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> rating, <span class="dt">fill =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-280-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 坐标轴翻转</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> rating, <span class="dt">fill =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-280-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>同时可以通过 <code>stat_summary()</code> 来添加平均值。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 用菱形图标指征平均值，并调整参数使该图标变更大。</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> rating)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">stat_summary</span>(<span class="dt">fun.y =</span> mean, <span class="dt">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="dt">shape =</span> <span class="dv">5</span>, 
    <span class="dt">size =</span> <span class="dv">4</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-281-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="-1" class="section level2">
<h2><span class="header-section-number">9.4</span> 散点图</h2>
<div id="-56" class="section level3">
<h3><span class="header-section-number">9.4.1</span> 问题</h3>
<p>你想要绘制一幅散点图。</p>
</div>
<div id="-55" class="section level3">
<h3><span class="header-section-number">9.4.2</span> 方案</h3>
<p>假设这是你的数据：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">955</span>)
<span class="co"># 创建一些噪声数据</span>
dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cond =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="dt">each =</span> <span class="dv">10</span>), <span class="dt">xvar =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span> <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rnorm</span>(<span class="dv">20</span>, <span class="dt">sd =</span> <span class="dv">3</span>), <span class="dt">yvar =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>, <span class="dt">sd =</span> <span class="dv">3</span>))
<span class="kw">head</span>(dat)
<span class="co">#&gt;   cond   xvar     yvar</span>
<span class="co">#&gt; 1    A -4.252  3.47316</span>
<span class="co">#&gt; 2    A  1.702  0.00594</span>
<span class="co">#&gt; 3    A  4.323 -0.09425</span>
<span class="co">#&gt; 4    A  1.781  2.07281</span>
<span class="co">#&gt; 5    A 11.537  1.21544</span>
<span class="co">#&gt; 6    A  6.672  3.60811</span>

<span class="kw">library</span>(ggplot2)</code></pre>
<div id="section-9.4.2.1" class="section level4">
<h4><span class="header-section-number">9.4.2.1</span> 带回归线的基本散点图</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>)      <span class="co"># 使用空心圆</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-283-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>) <span class="op">+</span><span class="st">    </span><span class="co"># 使用空心圆</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span>lm)   <span class="co"># 添加回归线</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-283-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">                             <span class="co"># (默认包含 95% 置信区间)</span>

<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>) <span class="op">+</span><span class="st">    </span><span class="co"># 使用空心圆</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span>lm,   <span class="co"># 添加回归线</span>
                <span class="dt">se=</span><span class="ot">FALSE</span>)    <span class="co"># 不加置信区域</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-283-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">

<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>) <span class="op">+</span><span class="st">    </span><span class="co"># 使用空心圆</span>
<span class="st">    </span><span class="kw">geom_smooth</span>()            <span class="co"># 添加带置信区间的平滑拟合曲线</span>
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-283-4.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.4.2.2" class="section level4">
<h4><span class="header-section-number">9.4.2.2</span> 通过其他变量设置颜色和形状</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 根据 cond 设置颜色</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar, <span class="dt">color=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-284-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 同上，但这里带了回归线</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar, <span class="dt">color=</span>cond)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_colour_hue</span>(<span class="dt">l=</span><span class="dv">50</span>) <span class="op">+</span><span class="st"> </span><span class="co"># 使用稍暗的调色板</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span>lm,   
                <span class="dt">se=</span><span class="ot">FALSE</span>)    </code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-284-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 拓展回归线到数据区域之外（带预测效果）</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar, <span class="dt">color=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_colour_hue</span>(<span class="dt">l=</span><span class="dv">50</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span>lm,   
                <span class="dt">se=</span><span class="ot">FALSE</span>,    
                <span class="dt">fullrange=</span><span class="ot">TRUE</span>) </code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-284-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 根据 cond 设置形状</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar, <span class="dt">shape=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-284-4.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 同上，但形状不同</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar, <span class="dt">shape=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_shape_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))  <span class="co"># 使用圆和三角形</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-284-5.png" width="672" style="display: block; margin: auto;" /></p>
<p>查看<a href="ggplot2.html#ggplot2-colors">颜色</a>获取更多关于颜色的信息。查看<a href="section-10.html#shape-and-linetype">形状与线形</a>获取更多相关内容。</p>
</div>
<div id="section-9.4.2.3" class="section level4">
<h4><span class="header-section-number">9.4.2.3</span> 处理图像元素叠加</h4>
<p>如果你有很多数据点，或者你的数据是离散的，那么数据可能会覆盖到一起，这样就看不清楚同一个位置有多少数据了。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 取近似值</span>
dat<span class="op">$</span>xrnd &lt;-<span class="st"> </span><span class="kw">round</span>(dat<span class="op">$</span>xvar<span class="op">/</span><span class="dv">5</span>) <span class="op">*</span><span class="st"> </span><span class="dv">5</span>
dat<span class="op">$</span>yrnd &lt;-<span class="st"> </span><span class="kw">round</span>(dat<span class="op">$</span>yvar<span class="op">/</span><span class="dv">5</span>) <span class="op">*</span><span class="st"> </span><span class="dv">5</span>

<span class="co"># 让每个点都部分透明 如果情况严重，可以使用更小的值</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> xrnd, <span class="dt">y =</span> yrnd)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">19</span>, 
  <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-285-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 抖动点 抖动范围在 x 轴上是 1，y 轴上是 0.5</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> xrnd, <span class="dt">y =</span> yrnd)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">1</span>, 
  <span class="dt">position =</span> <span class="kw">position_jitter</span>(<span class="dt">width =</span> <span class="dv">1</span>, <span class="dt">height =</span> <span class="fl">0.5</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-285-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="section-9.5" class="section level2">
<h2><span class="header-section-number">9.5</span> 标题</h2>
<div id="-57" class="section level3">
<h3><span class="header-section-number">9.5.1</span> 问题</h3>
<p>你想给图形设定一个标题。</p>
</div>
<div id="-56" class="section level3">
<h3><span class="header-section-number">9.5.2</span> 方案</h3>
<p>一个不带标题的图形例子：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
bp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(PlantGrowth, <span class="kw">aes</span>(<span class="dt">x =</span> group, <span class="dt">y =</span> weight)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>()
bp</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-286-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>添加标题：</p>
<pre class="sourceCode r"><code class="sourceCode r">bp <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Plant growth&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-287-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## 等同于 bp + labs(title=&#39;Plant growth&#39;)</span>
<span class="co">## 如果标题比较长，可以用 \n 将它分成多行来显示</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Plant growth with</span><span class="ch">\n</span><span class="st">different treatments&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-287-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 缩少行距并使用粗体</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Plant growth with</span><span class="ch">\n</span><span class="st">different treatments&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">lineheight =</span> <span class="fl">0.8</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-287-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="ggplot2-axes" class="section level2">
<h2><span class="header-section-number">9.6</span> 坐标轴</h2>
<div id="-58" class="section level3">
<h3><span class="header-section-number">9.6.1</span> 问题</h3>
<p>你想要改变轴的顺序或方向。</p>
</div>
<div id="-57" class="section level3">
<h3><span class="header-section-number">9.6.2</span> 方案</h3>
<blockquote>
<p>注意：下面的例子中提到的 <code>scale_y_continuous()</code>、<code>ylim()</code> 等函数名中，<code>y</code> 都可以替换为 <code>x</code>。</p>
</blockquote>
<p>下面使用内置的 <code>PlantGrowth</code> 数据集绘制一个基本的箱线图。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)

bp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(PlantGrowth, <span class="kw">aes</span>(<span class="dt">x =</span> group, <span class="dt">y =</span> weight)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>()
bp</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-288-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="-x--y-" class="section level4">
<h4><span class="header-section-number">9.6.2.1</span> 交换 x 和 y 轴</h4>
<p>交换 x 和 y 轴（让 x 垂直、y 水平）。</p>
<pre class="sourceCode r"><code class="sourceCode r">bp <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-289-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.6.2.2" class="section level4">
<h4><span class="header-section-number">9.6.2.2</span> 离散轴</h4>
<div id="section-9.6.2.2.1" class="section level5">
<h5><span class="header-section-number">9.6.2.2.1</span> 改变条目的顺序</h5>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 手动设定离散轴条目的顺序</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="st">&quot;trt1&quot;</span>, <span class="st">&quot;trt2&quot;</span>, <span class="st">&quot;ctrl&quot;</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-290-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co">## 逆转轴条目顺序 获取因子水平</span>
flevels &lt;-<span class="st"> </span><span class="kw">levels</span>(PlantGrowth<span class="op">$</span>group)
flevels
<span class="co">#&gt; [1] &quot;ctrl&quot; &quot;trt1&quot; &quot;trt2&quot;</span>

<span class="co"># 逆转顺序</span>
flevels &lt;-<span class="st"> </span><span class="kw">rev</span>(flevels)
flevels
<span class="co">#&gt; [1] &quot;trt2&quot; &quot;trt1&quot; &quot;ctrl&quot;</span>

bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">limits =</span> flevels)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-290-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 或者一行搞定</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">limits =</span> <span class="kw">rev</span>(<span class="kw">levels</span>(PlantGrowth<span class="op">$</span>group)))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-290-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.6.2.2.2" class="section level5">
<h5><span class="header-section-number">9.6.2.2.2</span> 设定标签</h5>
<p>对于离散变量，标签来自于因子水平。然而，有时候短的因子水平名字并不适合展示。</p>
<pre class="sourceCode r"><code class="sourceCode r">bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;ctrl&quot;</span>, <span class="st">&quot;trt1&quot;</span>, <span class="st">&quot;trt2&quot;</span>), 
  <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Treat 1&quot;</span>, <span class="st">&quot;Treat 2&quot;</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-291-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 隐藏 x 刻度、标签和网格线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">breaks =</span> <span class="ot">NULL</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-292-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 隐藏所有的刻度和标签（X 轴），保留网格线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>())</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-292-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="section-9.6.2.3" class="section level4">
<h4><span class="header-section-number">9.6.2.3</span> 连续轴</h4>
<div id="section-9.6.2.3.1" class="section level5">
<h5><span class="header-section-number">9.6.2.3.1</span> 设定范围和反转轴方向</h5>
<p>如果你仅想简单地让轴包含某个值，可以使用 <code>expand_limits()</code>，它会进行拓展而不是拉伸。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 确保 y 轴包含 0</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">expand_limits</span>(<span class="dt">y =</span> <span class="dv">0</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-293-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 确保 y 轴包含 0 和 8</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">expand_limits</span>(<span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">8</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-293-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>当然你也可以通过 y 刻度显式地指定。注意如果使用<strong>任何</strong> <code>scale_y_continuous</code> 命令，它会覆盖任何 <code>ylim</code> 命令，而且 <code>ylim</code> 会被忽略。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 设定连续值轴的范围 下面是相同的操作</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">8</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-294-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># bp + scale_y_continuous(limits=c(0, 8))</span></code></pre>
<p>如果使用上述方法让 y 轴的范围变小，任何超出范围的数据都会被忽略。有时候这会产生一些问题，读者需要注意。</p>
<p>为了避免产生问题，你可以使用 <code>coord_cartesian()</code>，相比于设定轴的范围，它设定数据可视化的区域。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 这两个操作一致，超出范围的数据被删除了，导致产生一个误导的箱线图</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">5</span>, <span class="fl">7.5</span>)
<span class="co">#&gt; Warning: Removed 13 rows containing non-finite values</span>
<span class="co">#&gt; (stat_boxplot).</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-295-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># bp + scale_y_continuous(limits=c(5, 7.5))</span>

<span class="co"># 使用 coord_cartesian &#39;zooms&#39; 区域</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="fl">7.5</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-295-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 直接指定刻度</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="fl">7.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, 
  <span class="dv">10</span>, <span class="fl">0.25</span>))  <span class="co"># Ticks from 0-10, every .25</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-295-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.6.2.3.2" class="section level5">
<h5><span class="header-section-number">9.6.2.3.2</span> 反转轴方向</h5>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 反转一个连续值轴的方向</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_reverse</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-296-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.6.2.3.3" class="section level5">
<h5><span class="header-section-number">9.6.2.3.3</span> 设置和隐藏刻度标记</h5>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Setting the tick marks on an axis This will show tick</span>
<span class="co"># marks on every 0.25 from 1 to 10 The scale will show</span>
<span class="co"># only the ones that are within range (3.50-6.25 in this</span>
<span class="co"># case)</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-297-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 刻度不平等变化</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="fl">4.25</span>, <span class="fl">4.5</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">8</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-297-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 抑制标签和网格线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="ot">NULL</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-297-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># Hide tick marks and labels (on Y axis), but keep the</span>
<span class="co"># gridlines</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>())</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-297-4.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="-logsqrt-" class="section level5">
<h5><span class="header-section-number">9.6.2.3.4</span> 轴刻度 log、sqrt 等转换</h5>
<p>默认轴是线性坐标，我们也可以将它转换为 log、幂、根等等。</p>
<p>有两种办法可以转换一个轴，一是使用 <em>scale</em> 进行转换，另外是使用 <em>coordinate</em> 进行转换。使用前者需要在先弄好刻度和轴的范围之前转换，而使用后者则相反，需要在弄好刻度和轴范围之后转换。这将产生不太一样的显示效果，如下所示。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 创建指数分布数据</span>
<span class="kw">set.seed</span>(<span class="dv">201</span>)
n &lt;-<span class="st"> </span><span class="dv">100</span>
dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">xval =</span> (<span class="dv">1</span><span class="op">:</span>n <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">sd =</span> <span class="dv">5</span>))<span class="op">/</span><span class="dv">20</span>, <span class="dt">yval =</span> <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>
<span class="st">  </span><span class="dv">2</span><span class="op">^</span>((<span class="dv">1</span><span class="op">:</span>n <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">sd =</span> <span class="dv">5</span>))<span class="op">/</span><span class="dv">20</span>))

<span class="co"># 创建常规的散点图</span>
sp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(xval, yval)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()
sp</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-298-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># log2 比例化（间隔相等）</span>
<span class="kw">library</span>(scales)  <span class="co"># 需要 scales 包</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">trans =</span> <span class="kw">log2_trans</span>())</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-298-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># log2 坐标转换，空间间隔不同</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">coord_trans</span>(<span class="dt">y =</span> <span class="st">&quot;log2&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-298-3.png" width="672" style="display: block; margin: auto;" /></p>
<p>在标度转换中，我们还可以指定刻度值，让它们显示指数。</p>
<pre class="sourceCode r"><code class="sourceCode r">sp <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">trans =</span> <span class="kw">log2_trans</span>(), <span class="dt">breaks =</span> <span class="kw">trans_breaks</span>(<span class="st">&quot;log2&quot;</span>, 
  <span class="cf">function</span>(x) <span class="dv">2</span><span class="op">^</span>x), <span class="dt">labels =</span> <span class="kw">trans_format</span>(<span class="st">&quot;log2&quot;</span>, <span class="kw">math_format</span>(<span class="dv">2</span><span class="op">^</span>.x)))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-299-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>可以使用非常多的转换，参见 <code>?trans_new</code> 查看所有可用转换的列表。如果你所需要的转换不在该列表上，可以自己写一个转换函数。</p>
<p>有一些非常便捷的函数：<code>scale_y_log10()</code> 和 <code>scale_y_sqrt()</code> （有对应的 x 版本）。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">205</span>)
n &lt;-<span class="st"> </span><span class="dv">100</span>
dat10 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">xval =</span> (<span class="dv">1</span><span class="op">:</span>n <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">sd =</span> <span class="dv">5</span>))<span class="op">/</span><span class="dv">20</span>, 
  <span class="dt">yval =</span> <span class="dv">10</span> <span class="op">*</span><span class="st"> </span><span class="dv">10</span><span class="op">^</span>((<span class="dv">1</span><span class="op">:</span>n <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">sd =</span> <span class="dv">5</span>))<span class="op">/</span><span class="dv">20</span>))

sp10 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat10, <span class="kw">aes</span>(xval, yval)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()

<span class="co"># log10</span>
sp10 <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_log10</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-300-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># log10 转换，并设定指数标签</span>
sp10 <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_log10</span>(<span class="dt">breaks =</span> <span class="kw">trans_breaks</span>(<span class="st">&quot;log10&quot;</span>, <span class="cf">function</span>(x) <span class="dv">10</span><span class="op">^</span>x), 
  <span class="dt">labels =</span> <span class="kw">trans_format</span>(<span class="st">&quot;log10&quot;</span>, <span class="kw">math_format</span>(<span class="dv">10</span><span class="op">^</span>.x)))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-300-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="x--y-" class="section level5">
<h5><span class="header-section-number">9.6.2.3.5</span> x 与 y 轴固定的比例</h5>
<p>设置 x 与 y 轴比例宽度也是可以的。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># x 范围 0-10, y 范围 0-30</span>
<span class="kw">set.seed</span>(<span class="dv">202</span>)
dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">xval =</span> <span class="kw">runif</span>(<span class="dv">40</span>, <span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">yval =</span> <span class="kw">runif</span>(<span class="dv">40</span>, 
  <span class="dv">0</span>, <span class="dv">30</span>))
sp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(xval, yval)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()

<span class="co"># 强制比例相等</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">coord_fixed</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-301-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 相等的标度变化，让 x 的 1 个单位等同 y 的 3 个单位</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">coord_fixed</span>(<span class="dt">ratio =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-301-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="section-9.6.2.4" class="section level4">
<h4><span class="header-section-number">9.6.2.4</span> 轴标签和文字格式化</h4>
<p>设置和隐藏轴标签：</p>
<pre class="sourceCode r"><code class="sourceCode r">bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>()) <span class="op">+</span><span class="st">   </span><span class="co"># 移除 x 轴标签</span>
<span class="st">     </span><span class="kw">ylab</span>(<span class="st">&quot;Weight (Kg)&quot;</span>)                       <span class="co"># 设置 y 轴标签</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-302-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 也可以通过标度设置</span>
<span class="co"># 注意这里 x 轴标签的空间仍然保留</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">name=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span>
<span class="st">     </span><span class="kw">scale_y_continuous</span>(<span class="dt">name=</span><span class="st">&quot;Weight (Kg)&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-302-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>改变字体、颜色、旋转刻度标签：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 改变字体选项： X-axis label: bold, red, and 20 points</span>
<span class="co"># X-axis tick marks: rotate 90 degrees CCW, move to the</span>
<span class="co"># left a bit (using vjust, since the labels are</span>
<span class="co"># rotated), and 16 points</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.x =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;#990000&quot;</span>, 
  <span class="dt">size =</span> <span class="dv">20</span>), <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>, 
  <span class="dt">size =</span> <span class="dv">16</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-303-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.6.2.5" class="section level4">
<h4><span class="header-section-number">9.6.2.5</span> 刻度标签</h4>
<p>你可能想将值显示为百分比、或美元、或科学计数法。这里可以使用<strong>格式器</strong>，它是一个可以改变文本的函数。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 标签格式器</span>
<span class="kw">library</span>(scales)  <span class="co"># 需要 scales 包</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">labels =</span> abbreviate)  <span class="co"># 在这个例子中它没作用</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-304-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>连续标度格式器有 <code>comma</code>、<code>percent</code>、<code>dollar</code> 以及 <code>scientific</code>。离散标度格式器有 <code>abbreviate</code>、<code>date_format</code> 等。</p>
<p>有时你需要自己创建格式化函数。下面的函数可以显示时间格式为 HH:MM:SS。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 自定义时间格式化函数</span>
timeHMS_formatter &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  h &lt;-<span class="st"> </span><span class="kw">floor</span>(x<span class="op">/</span><span class="dv">60</span>)
  m &lt;-<span class="st"> </span><span class="kw">floor</span>(x<span class="op">%%</span><span class="dv">60</span>)
  s &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="dv">60</span> <span class="op">*</span><span class="st"> </span>(x<span class="op">%%</span><span class="dv">1</span>))  <span class="co"># Round to nearest second</span>
  lab &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%02d:%02d:%02d&quot;</span>, h, m, s)  <span class="co"># Format the strings as HH:MM:SS</span>
  lab &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;^00:&quot;</span>, <span class="st">&quot;&quot;</span>, lab)  <span class="co"># Remove leading 00: if present</span>
  lab &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;^0&quot;</span>, <span class="st">&quot;&quot;</span>, lab)  <span class="co"># Remove leading 0 if present</span>
}

bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">label =</span> timeHMS_formatter)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-305-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.6.2.6" class="section level4">
<h4><span class="header-section-number">9.6.2.6</span> 隐藏网格线</h4>
<p>隐藏网格线：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 隐藏所有网格线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>())</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-306-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 仅隐藏次级网格线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>())</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-306-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>也可以仅隐藏水平或垂直网格线：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 隐藏所有垂直网格线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor.x =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.grid.major.x =</span> <span class="kw">element_blank</span>())</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-307-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 隐藏所有水平网格线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor.y =</span> <span class="kw">element_blank</span>(), <span class="dt">panel.grid.major.y =</span> <span class="kw">element_blank</span>())</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-307-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="ggplot2-legends" class="section level2">
<h2><span class="header-section-number">9.7</span> 图例</h2>
<div id="-59" class="section level3">
<h3><span class="header-section-number">9.7.1</span> 问题</h3>
<p>你想用 <strong>ggplot2</strong> 修改图表中的图例。</p>
</div>
<div id="-58" class="section level3">
<h3><span class="header-section-number">9.7.2</span> 方案</h3>
<p>从带有默认选项的示例图开始：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
bp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> PlantGrowth, <span class="kw">aes</span>(<span class="dt">x =</span> group, <span class="dt">y =</span> weight, 
  <span class="dt">fill =</span> group)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()
bp</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-308-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="section-9.7.2.1" class="section level4">
<h4><span class="header-section-number">9.7.2.1</span> 去除图例</h4>
<p>使用 <code>guides(fill=FALSE)</code>, 用想要的颜色替代填充色.</p>
<p>你也可以用 <code>theme()</code> 移除图表中所有的图例。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 删除特定美学的图例（填充）</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-309-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 在指定比例时也可以这样做</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_discrete</span>(<span class="dt">guide =</span> <span class="ot">FALSE</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-309-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 这将移除所有的图例</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-309-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.7.2.2" class="section level4">
<h4><span class="header-section-number">9.7.2.2</span> 在图例中改变变量的顺序</h4>
<p>这会将变量的顺序更改为 trt1，ctrl，trt2:</p>
<pre class="sourceCode r"><code class="sourceCode r">bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_discrete</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;trt1&quot;</span>, <span class="st">&quot;ctrl&quot;</span>, <span class="st">&quot;trt2&quot;</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-310-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>根据指定颜色的方式，你可能必须使用不同的比例，如 <code>scale_fill_manual()</code>, <code>scale_colour_hue()</code>, <code>scale_colour_manual()</code>, <code>scale_shape_discrete()</code>, <code>scale_linetype_discrete()</code> 等。</p>
</div>
<div id="section-9.7.2.3" class="section level4">
<h4><span class="header-section-number">9.7.2.3</span> 反转图例中的条目顺序</h4>
<p>反转图例顺序:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 这两种方式等同:</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse =</span> <span class="ot">TRUE</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-311-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_discrete</span>(<span class="dt">guide =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse =</span> <span class="ot">TRUE</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-311-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 你也可以直接修改比例尺：</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_discrete</span>(<span class="dt">breaks =</span> <span class="kw">rev</span>(<span class="kw">levels</span>(PlantGrowth<span class="op">$</span>group)))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-311-3.png" width="672" style="display: block; margin: auto;" /></p>
<p>你可以使用不同的比例尺，如 <code>scale_fill_manual()</code>, <code>scale_colour_hue()</code>, <code>scale_colour_manual()</code>, <code>scale_shape_discrete()</code>, <code>scale_linetype_discrete()</code> 等，而不是 <code>scale_fill_discrete()</code>。</p>
</div>
<div id="section-9.7.2.4" class="section level4">
<h4><span class="header-section-number">9.7.2.4</span> 隐藏图例标题</h4>
<p>这将隐藏图例标题:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 为了填充的图例移除标题</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">title =</span> <span class="ot">NULL</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-312-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 为了所有的图例移除标题</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.title =</span> <span class="kw">element_blank</span>())</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-312-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.7.2.5" class="section level4">
<h4><span class="header-section-number">9.7.2.5</span> 修改图例标题和标签的文字</h4>
<p>有两种方法可以更改图例标题和标签。 第一种方法是告诉 <em>scale</em> 使用具有不同的标题和标签。 第二种方法是更改数据框，使因子具有所需的形式。</p>
<div id="section-9.7.2.5.1" class="section level5">
<h5><span class="header-section-number">9.7.2.5.1</span> 使用比例尺</h5>
<p>图例可能由 <code>fill</code>, <code>colour</code>, <code>linetype</code>, <code>shape</code> 或其他因素所介导.</p>
</div>
<div id="section-9.7.2.5.2" class="section level5">
<h5><span class="header-section-number">9.7.2.5.2</span> 使用填充和颜色</h5>
<p>因为图例中的变量 <code>group</code> 被映射到颜色 <code>fill</code>，所以必须使用 <code>scale_fill_xxx</code>，其中 <code>xxx</code> 是将 <code>group</code> 的每个因子级别映射到不同颜色的方法。 默认设置是在每个因子级别的色轮上使用不同的色调，但也可以手动指定每个级别的颜色。</p>
<pre class="sourceCode r"><code class="sourceCode r">bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Experimental</span><span class="ch">\n</span><span class="st">Condition&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-313-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Experimental</span><span class="ch">\n</span><span class="st">Condition&quot;</span>, 
  <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;ctrl&quot;</span>, <span class="st">&quot;trt1&quot;</span>, <span class="st">&quot;trt2&quot;</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Control&quot;</span>, 
    <span class="st">&quot;Treatment 1&quot;</span>, <span class="st">&quot;Treatment 2&quot;</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-313-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 使用手动刻度而不是色调</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, 
  <span class="st">&quot;#56B4E9&quot;</span>), <span class="dt">name =</span> <span class="st">&quot;Experimental</span><span class="ch">\n</span><span class="st">Condition&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;ctrl&quot;</span>, 
  <span class="st">&quot;trt1&quot;</span>, <span class="st">&quot;trt2&quot;</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Treatment 1&quot;</span>, 
  <span class="st">&quot;Treatment 2&quot;</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-313-3.png" width="672" style="display: block; margin: auto;" /></p>
<p>请注意，这并未更改 x 轴标签。 有关如何修改轴标签的信息，请参见<a href="ggplot2.html#ggplot2-axes">坐标轴</a>。</p>
<p>如果使用折线图，则可能需要使用 <code>scale_colour_xxx()</code> 或 <code>scale_shape_xxx()</code> 而不是 <code>scale_fill_xxx()</code>。 <strong>颜色</strong>映射到线条和点的颜色，而<strong>填充</strong>映射到区域填充的颜色。 <strong>形状</strong>映射到点的形状。</p>
<p>我们将在这里为线图使用不同的数据集，因为 PlantGrowth 数据集不适用于折线图。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 一个不同的数据集</span>
df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">sex =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>, 
  <span class="st">&quot;Male&quot;</span>)), <span class="dt">time =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Lunch&quot;</span>, <span class="st">&quot;Dinner&quot;</span>, <span class="st">&quot;Lunch&quot;</span>, 
  <span class="st">&quot;Dinner&quot;</span>), <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Lunch&quot;</span>, <span class="st">&quot;Dinner&quot;</span>)), <span class="dt">total_bill =</span> <span class="kw">c</span>(<span class="fl">13.53</span>, 
  <span class="fl">16.81</span>, <span class="fl">16.24</span>, <span class="fl">17.42</span>))

<span class="co"># 基本的图表</span>
lp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df1, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, <span class="dt">group =</span> sex, 
  <span class="dt">shape =</span> sex)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()
lp</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-314-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 更改图例</span>
lp <span class="op">+</span><span class="st"> </span><span class="kw">scale_shape_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Payer&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>, 
  <span class="st">&quot;Male&quot;</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Woman&quot;</span>, <span class="st">&quot;Man&quot;</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-314-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>如果你同时使用 <code>colour</code> 和 <code>shape</code>，它们都需要给出比例规格。 否则会有两个独立的图例。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 指定颜色和形状</span>
lp1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> df1, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> total_bill, 
  <span class="dt">group =</span> sex, <span class="dt">shape =</span> sex, <span class="dt">colour =</span> sex)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>()
lp1</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-315-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 如果你仅仅指定颜色，将会发生</span>
lp1 <span class="op">+</span><span class="st"> </span><span class="kw">scale_colour_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Payer&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>, 
  <span class="st">&quot;Male&quot;</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Woman&quot;</span>, <span class="st">&quot;Man&quot;</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-315-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 指定的颜色和形状</span>
lp1 <span class="op">+</span><span class="st"> </span><span class="kw">scale_colour_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Payer&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>, 
  <span class="st">&quot;Male&quot;</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Woman&quot;</span>, <span class="st">&quot;Man&quot;</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">scale_shape_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Payer&quot;</span>, 
  <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Woman&quot;</span>, <span class="st">&quot;Man&quot;</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-315-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.7.2.5.3" class="section level5">
<h5><span class="header-section-number">9.7.2.5.3</span> 比例尺的种类</h5>
<p>比例尺有很多种。 它们采用「scale_xxx_yyy」的形式。 以下是一些常用的 <code>xxx</code> 和 <code>yyy</code> 值：</p>
<table>
<thead>
<tr class="header">
<th align="center"><strong>xxx</strong></th>
<th align="center"><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">colour</td>
<td align="center">线和点的颜色</td>
</tr>
<tr class="even">
<td align="center">fill</td>
<td align="center">填充区域的颜色 (比如：柱状图)</td>
</tr>
<tr class="odd">
<td align="center">线条类型</td>
<td align="center">Solid/dashed/dotted lines</td>
</tr>
<tr class="even">
<td align="center">形状</td>
<td align="center">点的形状</td>
</tr>
<tr class="odd">
<td align="center">大小</td>
<td align="center">Size of points</td>
</tr>
<tr class="even">
<td align="center">alpha</td>
<td align="center">不透明度/透明度</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th align="center"><strong>yyy</strong></th>
<th align="center"><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">hue</td>
<td align="center">色轮的颜色相同</td>
</tr>
<tr class="even">
<td align="center">manual</td>
<td align="center">手动指定的值（例如，颜色，点形状，线型）</td>
</tr>
<tr class="odd">
<td align="center">gradient</td>
<td align="center">颜色渐变</td>
</tr>
<tr class="even">
<td align="center">grey</td>
<td align="center">Shades of grey</td>
</tr>
<tr class="odd">
<td align="center">discrete</td>
<td align="center">不连续的值 (比如颜色，点的形状，线条类型，点的大小</td>
</tr>
<tr class="even">
<td align="center">continuous</td>
<td align="center">连续的值（透明度，颜色，点的大小）</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="section-9.7.2.6" class="section level4">
<h4><span class="header-section-number">9.7.2.6</span> 更改数据框中的因子</h4>
<p>更改图例标题和标签的另一种方法是直接修改数据框。</p>
<pre class="sourceCode r"><code class="sourceCode r">pg &lt;-<span class="st"> </span>PlantGrowth  <span class="co"># 把数据复制到新的数据框</span>
<span class="co"># 重命名列中的列和值</span>
<span class="kw">levels</span>(pg<span class="op">$</span>group)[<span class="kw">levels</span>(pg<span class="op">$</span>group) <span class="op">==</span><span class="st"> &quot;ctrl&quot;</span>] &lt;-<span class="st"> &quot;Control&quot;</span>
<span class="kw">levels</span>(pg<span class="op">$</span>group)[<span class="kw">levels</span>(pg<span class="op">$</span>group) <span class="op">==</span><span class="st"> &quot;trt1&quot;</span>] &lt;-<span class="st"> &quot;Treatment 1&quot;</span>
<span class="kw">levels</span>(pg<span class="op">$</span>group)[<span class="kw">levels</span>(pg<span class="op">$</span>group) <span class="op">==</span><span class="st"> &quot;trt2&quot;</span>] &lt;-<span class="st"> &quot;Treatment 2&quot;</span>
<span class="kw">names</span>(pg)[<span class="kw">names</span>(pg) <span class="op">==</span><span class="st"> &quot;group&quot;</span>] &lt;-<span class="st"> &quot;Experimental Condition&quot;</span>

<span class="co"># 查看最终结果的几行</span>
<span class="kw">head</span>(pg)
<span class="co">#&gt;   weight Experimental Condition</span>
<span class="co">#&gt; 1   4.17                Control</span>
<span class="co">#&gt; 2   5.58                Control</span>
<span class="co">#&gt; 3   5.18                Control</span>
<span class="co">#&gt; 4   6.11                Control</span>
<span class="co">#&gt; 5   4.50                Control</span>
<span class="co">#&gt; 6   4.61                Control</span>

<span class="co"># 画图</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> pg, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Experimental Condition</span><span class="st">`</span>, <span class="dt">y =</span> weight, 
  <span class="dt">fill =</span> <span class="st">`</span><span class="dt">Experimental Condition</span><span class="st">`</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-316-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>图例标题“实验条件”很长，如果它被分成两行可能看起来更好，但是这种方法效果不好，因为你必须在列的名称中加上一个换行符。另一种方法，有尺度，通常是更好的方法。</p>
<p>另请注意使用反引号而不是引号。由于变量名中的空格，它们是必需的。</p>
</div>
<div id="section-9.7.2.7" class="section level4">
<h4><span class="header-section-number">9.7.2.7</span> 修改图例标题和标签的外观</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 题目外观</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>, 
  <span class="dt">size =</span> <span class="dv">16</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-317-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 标签外观</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="dv">16</span>, 
  <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-317-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.7.2.8" class="section level4">
<h4><span class="header-section-number">9.7.2.8</span> 修改图例框</h4>
<p>默认情况下，图例周围没有框。 添加框并修改其属性:</p>
<pre class="sourceCode r"><code class="sourceCode r">bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.background =</span> <span class="kw">element_rect</span>())</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-318-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;gray90&quot;</span>, 
  <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">linetype =</span> <span class="st">&quot;dotted&quot;</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-318-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.7.2.9" class="section level4">
<h4><span class="header-section-number">9.7.2.9</span> 改变图例位置</h4>
<p>将图例位置放在绘图区域外（左/右/上/下）:</p>
<pre class="sourceCode r"><code class="sourceCode r">bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-319-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>也可以将图例定位在绘图区域内。 请注意，下面的数字位置是相对于整个区域的，包括标题和标签，而不仅仅是绘图区域。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 将图例放在图表中，其中 x，y 为 0, 0（左下角）到 1,</span>
<span class="co"># 1（右上角）</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-320-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 设置图例的「锚点」（左下角为 0, 0; 右上角为 1, 1）</span>
<span class="co"># 将图例框的左下角放在图的左下角</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="dv">0</span>, 
  <span class="dv">0</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-320-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 将图例框的右下角放在图表的右下角</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="dv">1</span>, 
  <span class="dv">0</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-320-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.7.2.10" class="section level4">
<h4><span class="header-section-number">9.7.2.10</span> 隐藏在图例中的斜线</h4>
<p>如果使用轮廓制作条形图（通过设置 color = “black”），它将通过图例中的颜色绘制斜线。 没有内置的方法来删除斜杠，但可以覆盖它们。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 没有边缘线</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> PlantGrowth, <span class="kw">aes</span>(<span class="dt">x =</span> group, <span class="dt">fill =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-321-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 添加轮廓，但图例中会出现斜线</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> PlantGrowth, <span class="kw">aes</span>(<span class="dt">x =</span> group, <span class="dt">fill =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-321-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 隐藏斜线：首先绘制没有轮廓的条形图并添加图例,</span>
<span class="co"># 然后用轮廓再次绘制条形图，但带有空白图例.</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> PlantGrowth, <span class="kw">aes</span>(<span class="dt">x =</span> group, <span class="dt">fill =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">show.legend =</span> <span class="ot">FALSE</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-321-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="-7" class="section level3">
<h3><span class="header-section-number">9.7.3</span> 注意</h3>
<p>更多信息，请阅读 <a href="https://github.com/hadley/ggplot2/wiki/Legend-Attributes">ggplot2-图例属性</a>。</p>
</div>
</div>
<div id="section-9.8" class="section level2">
<h2><span class="header-section-number">9.8</span> 线条</h2>
<div id="-60" class="section level3">
<h3><span class="header-section-number">9.8.1</span> 问题</h3>
<p>你想要把线条加到图上。</p>
</div>
<div id="-59" class="section level3">
<h3><span class="header-section-number">9.8.2</span> 方案</h3>
<div id="section-9.8.2.1" class="section level4">
<h4><span class="header-section-number">9.8.2.1</span> 使用一个连续轴和一个分类轴</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 一些样本数据</span>
dat &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">text =</span> <span class="st">&quot;</span>
<span class="st">   cond result</span>
<span class="st">  control     10</span>
<span class="st">treatment   11.5</span>
<span class="st">&quot;</span>)

<span class="kw">library</span>(ggplot2)</code></pre>
<div id="section-9.8.2.1.1" class="section level5">
<h5><span class="header-section-number">9.8.2.1.1</span> 一条线段</h5>
<p>这些使用 <code>geom_hline()</code>，因为y轴是连续的，但如果x轴是连续的，也可以使用 <code>geom_vline()</code>（带有 <code>xintercept</code>）。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 基本柱状条</span>
bp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> result)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(), 
  <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)
bp</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-323-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 添加水平线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">12</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-323-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 使线条变红并变为虚线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">12</span>), <span class="dt">colour =</span> <span class="st">&quot;#990000&quot;</span>, 
  <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-323-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.8.2.1.2" class="section level5">
<h5><span class="header-section-number">9.8.2.1.2</span> 每个分类值的单独行</h5>
<p>要为每个条形成单独的行，请使用 <code>geom_errorbar()</code>。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 为每个条形绘制单独的线条。 首先添加另一列到目前为止</span>
dat<span class="op">$</span>hline &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">12</span>)
dat
<span class="co">#&gt;        cond result hline</span>
<span class="co">#&gt; 1   control   10.0     9</span>
<span class="co">#&gt; 2 treatment   11.5    12</span>

<span class="co"># 需要重新指定 bp，因为数据已经改变</span>
bp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> result)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(), 
  <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)

<span class="co"># 为每个柱状图画分开的线条</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymax =</span> hline, <span class="dt">ymin =</span> hline), <span class="dt">colour =</span> <span class="st">&quot;#AA0000&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-324-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 让线条更细一点</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="dt">width =</span> <span class="fl">0.5</span>, <span class="kw">aes</span>(<span class="dt">ymax =</span> hline, <span class="dt">ymin =</span> hline), 
  <span class="dt">colour =</span> <span class="st">&quot;#AA0000&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-324-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">

<span class="co"># 即使我们从第二个数据框获得 hline</span>
<span class="co"># 值，也可以得到相同的结果 使用 hline 定义数据框</span>
dat_hlines &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cond =</span> <span class="kw">c</span>(<span class="st">&quot;control&quot;</span>, <span class="st">&quot;treatment&quot;</span>), 
  <span class="dt">hline =</span> <span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">12</span>))
dat_hlines
<span class="co">#&gt;        cond hline</span>
<span class="co">#&gt; 1   control     9</span>
<span class="co">#&gt; 2 treatment    12</span>

<span class="co"># 柱状图形来自 dat，但是线条来自 dat_hlines</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="dt">data =</span> dat_hlines, <span class="kw">aes</span>(<span class="dt">y =</span> <span class="ot">NULL</span>, <span class="dt">ymax =</span> hline, 
  <span class="dt">ymin =</span> hline), <span class="dt">colour =</span> <span class="st">&quot;#AA0000&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-324-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.8.2.1.3" class="section level5">
<h5><span class="header-section-number">9.8.2.1.3</span> 分组栏上的线条</h5>
<p>可以在分组条上添加线条。 在这个例子中，实际上有四行（<code>hline</code> 的每个条目一行），但它看起来像两个，因为它们是相互重叠的。 我不认为可以避免这种情况，但它不会导致任何问题。</p>
<pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">text =</span> <span class="st">&quot;</span>
<span class="st">   cond group result hline</span>
<span class="st">  control     A     10     9</span>
<span class="st">treatment     A   11.5    12</span>
<span class="st">  control     B     12     9</span>
<span class="st">treatment     B     14    12</span>
<span class="st">&quot;</span>)
dat
<span class="co">#&gt;        cond group result hline</span>
<span class="co">#&gt; 1   control     A   10.0     9</span>
<span class="co">#&gt; 2 treatment     A   11.5    12</span>
<span class="co">#&gt; 3   control     B   12.0     9</span>
<span class="co">#&gt; 4 treatment     B   14.0    12</span>

<span class="co"># 定义基本柱状图</span>
bp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> result, <span class="dt">fill =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)
bp</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-325-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 误差线相互绘制 - 有四个但看起来像两个</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymax =</span> hline, <span class="dt">ymin =</span> hline), <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-325-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="section-9.8.2.2" class="section level4">
<h4><span class="header-section-number">9.8.2.2</span> 各个组合柱状图上的线条</h4>
<p>即使在分组时，也可以在每个单独的条上划线。</p>
<pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">text =</span> <span class="st">&quot;</span>
<span class="st">   cond group result hline</span>
<span class="st">  control     A     10    11</span>
<span class="st">treatment     A   11.5    12</span>
<span class="st">  control     B     12  12.5</span>
<span class="st">treatment     B     14    15</span>
<span class="st">&quot;</span>)

<span class="co"># 定义基本条形图</span>
bp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> result, <span class="dt">fill =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)
bp</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-326-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">bp <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymax =</span> hline, <span class="dt">ymin =</span> hline), <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>, 
  <span class="dt">position =</span> <span class="kw">position_dodge</span>())</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-326-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.8.2.3" class="section level4">
<h4><span class="header-section-number">9.8.2.3</span> 有两个连续轴</h4>
<p>样本数据如下：</p>
<pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">text =</span> <span class="st">&quot;</span>
<span class="st">    cond xval yval</span>
<span class="st">   control 11.5 10.8</span>
<span class="st">   control  9.3 12.9</span>
<span class="st">   control  8.0  9.9</span>
<span class="st">   control 11.5 10.1</span>
<span class="st">   control  8.6  8.3</span>
<span class="st">   control  9.9  9.5</span>
<span class="st">   control  8.8  8.7</span>
<span class="st">   control 11.7 10.1</span>
<span class="st">   control  9.7  9.3</span>
<span class="st">   control  9.8 12.0</span>
<span class="st"> treatment 10.4 10.6</span>
<span class="st"> treatment 12.1  8.6</span>
<span class="st"> treatment 11.2 11.0</span>
<span class="st"> treatment 10.0  8.8</span>
<span class="st"> treatment 12.9  9.5</span>
<span class="st"> treatment  9.1 10.0</span>
<span class="st"> treatment 13.4  9.6</span>
<span class="st"> treatment 11.6  9.8</span>
<span class="st"> treatment 11.5  9.8</span>
<span class="st"> treatment 12.0 10.6</span>
<span class="st">&quot;</span>)

<span class="kw">library</span>(ggplot2)</code></pre>
<div id="section-9.8.2.3.1" class="section level5">
<h5><span class="header-section-number">9.8.2.3.1</span> 基础线条</h5>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 基本的散点图</span>
sp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> xval, <span class="dt">y =</span> yval, <span class="dt">colour =</span> cond)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>()
<span class="co"># 添加一个水平线条</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">10</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-328-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 添加红色虚线垂直线</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">10</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="fl">11.5</span>), 
  <span class="dt">colour =</span> <span class="st">&quot;#BB0000&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-328-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.8.2.3.2" class="section level5">
<h5><span class="header-section-number">9.8.2.3.2</span> 画线为平均值</h5>
<p>还可以按一些变量分组计算每个数据子集的平均值。 组别必须计算并存储在单独的列中，最简单的方法是使用 <strong>dplyr</strong> 包。请注意，该行的 y 范围由数据确定。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: &#39;dplyr&#39;</span>
<span class="co">#&gt; The following objects are masked from &#39;package:plyr&#39;:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     arrange, count, desc, failwith, id, mutate,</span>
<span class="co">#&gt;     rename, summarise, summarize</span>
<span class="co">#&gt; The following object is masked from &#39;package:car&#39;:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     recode</span>
<span class="co">#&gt; The following objects are masked from &#39;package:stats&#39;:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from &#39;package:base&#39;:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
lines &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(cond) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">x =</span> <span class="kw">mean</span>(xval), 
  <span class="dt">ymin =</span> <span class="kw">min</span>(yval), <span class="dt">ymax =</span> <span class="kw">max</span>(yval))

<span class="co"># 为每组的平均 xval 添加彩色线条</span>
sp &lt;-<span class="st"> </span>sp <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">10</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_linerange</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, 
  <span class="dt">y =</span> <span class="ot">NULL</span>, <span class="dt">ymin =</span> ymin, <span class="dt">ymax =</span> ymax), <span class="dt">data =</span> lines)
sp</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-329-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.8.2.3.3" class="section level5">
<h5><span class="header-section-number">9.8.2.3.3</span> 在分面使用线条</h5>
<p>一般来说，如果你加一条线，它将出现在所有的分面上。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 分面，基于cond</span>
spf &lt;-<span class="st"> </span>sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>cond)
spf</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-330-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 用相同的值在所有的分面上画水平线</span>
spf <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">10</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-330-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>如果你希望不同的线条出现在不同的方面，有两个选项。 一种是创建具有所需线条值的新数据框。 另一种选择（控制更有限）是在 <code>geom_line()</code> 中设定 <code>stat</code> 和 <code>xintercept</code>。</p>
<pre class="sourceCode r"><code class="sourceCode r">dat_vlines &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cond =</span> <span class="kw">levels</span>(dat<span class="op">$</span>cond), <span class="dt">xval =</span> <span class="kw">c</span>(<span class="dv">10</span>, 
  <span class="fl">11.5</span>))
dat_vlines
<span class="co">#&gt;        cond xval</span>
<span class="co">#&gt; 1   control 10.0</span>
<span class="co">#&gt; 2 treatment 11.5</span>
spf <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">10</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> xval), 
  <span class="dt">data =</span> dat_vlines, <span class="dt">colour =</span> <span class="st">&quot;#990000&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-331-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">spf <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">10</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_linerange</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, 
  <span class="dt">y =</span> <span class="ot">NULL</span>, <span class="dt">ymin =</span> ymin, <span class="dt">ymax =</span> ymax), <span class="dt">data =</span> lines)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-331-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
</div>
<div id="ggplot-facet" class="section level2">
<h2><span class="header-section-number">9.9</span> 分面</h2>
<div id="-61" class="section level3">
<h3><span class="header-section-number">9.9.1</span> 问题</h3>
<p>你想要根据一个或多个变量对数据进行分割并且绘制出该数据所有的子图。</p>
</div>
<div id="-60" class="section level3">
<h3><span class="header-section-number">9.9.2</span> 方案</h3>
<div id="-1" class="section level4">
<h4><span class="header-section-number">9.9.2.1</span> 样本数据</h4>
<p>以下例子将使用 <strong>reshape2</strong> 包中的 <code>tips</code> 数据集</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(reshape2)
<span class="co"># 查看头几行数据</span>
<span class="kw">head</span>(tips)
<span class="co">#&gt;   total_bill  tip    sex smoker day   time size</span>
<span class="co">#&gt; 1      16.99 1.01 Female     No Sun Dinner    2</span>
<span class="co">#&gt; 2      10.34 1.66   Male     No Sun Dinner    3</span>
<span class="co">#&gt; 3      21.01 3.50   Male     No Sun Dinner    3</span>
<span class="co">#&gt; 4      23.68 3.31   Male     No Sun Dinner    2</span>
<span class="co">#&gt; 5      24.59 3.61 Female     No Sun Dinner    4</span>
<span class="co">#&gt; 6      25.29 4.71   Male     No Sun Dinner    4</span></code></pre>
<p>根据小费 (tip) 占总账单 (total_bill) 的百分比绘制散点图</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
sp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(tips, <span class="kw">aes</span>(<span class="dt">x =</span> total_bill, <span class="dt">y =</span> tip<span class="op">/</span>total_bill)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">1</span>)
sp</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-333-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="facet_grid" class="section level4">
<h4><span class="header-section-number">9.9.2.2</span> facet_grid</h4>
<p>根据一个或多个变量对数据进行分割，生成的子图按照水平或垂直的方向进行排列。这一功能是通过赋予 <code>facet_grid()</code> 函数一个 <code>vertical ~ horizontal</code> 公式来实现的（这里所说的「公式」是 R 中的一种数据结构，而不是数学意义上的公式）。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 根据 &#39;sex&#39; 按垂直方向分割</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>.)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-334-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 根据 &#39;sex&#39; 按水平方向分割。</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>sex)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-335-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 垂直方向以 &#39;sex&#39; 分割，水平方向以 &#39;day&#39; 分割。</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>day)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-336-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="facet_wrap" class="section level4">
<h4><span class="header-section-number">9.9.2.3</span> facet_wrap</h4>
<p>除了能够根据<strong>单个变量</strong>在水平或垂直方向上对图进行分面，<code>facet_wrap()</code> 函数可以通过设置特定的行数或列数，让子图排列到一起。此时每个图像的上方都会有标签。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 以变量 `day` 进行水平分面，分面的行数为2。</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>day, <span class="dt">ncol =</span> <span class="dv">2</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-337-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.9.2.4" class="section level4">
<h4><span class="header-section-number">9.9.2.4</span> 修改分面标签的外观</h4>
<pre class="sourceCode r"><code class="sourceCode r">sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>day) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">strip.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">8</span>, 
  <span class="dt">angle =</span> <span class="dv">75</span>), <span class="dt">strip.text.y =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>, 
  <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>), <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, 
  <span class="dt">fill =</span> <span class="st">&quot;#CCCCFF&quot;</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-338-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.9.2.5" class="section level4">
<h4><span class="header-section-number">9.9.2.5</span> 修改分面标签的文本</h4>
<p>修改分面标签内容有两种方法。最简单的方法是为原来的名字匹配一个新的名字向量。例如，对数据中 <code>sex</code> 的类别进行重新定义 Female==&gt;Women 和 Male==&gt;Men：</p>
<pre class="sourceCode r"><code class="sourceCode r">labels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Female =</span> <span class="st">&quot;Women&quot;</span>, <span class="dt">Male =</span> <span class="st">&quot;Men&quot;</span>)
sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>sex, <span class="dt">labeller =</span> <span class="kw">labeller</span>(<span class="dt">sex =</span> labels))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-339-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>另一个方法就是直接在数据框中修改，将你想要显示的标签赋值给相应的数据:</p>
<pre class="sourceCode r"><code class="sourceCode r">tips2 &lt;-<span class="st"> </span>tips
<span class="kw">levels</span>(tips2<span class="op">$</span>sex)[<span class="kw">levels</span>(tips2<span class="op">$</span>sex) <span class="op">==</span><span class="st"> &quot;Female&quot;</span>] &lt;-<span class="st"> &quot;Women&quot;</span>
<span class="kw">levels</span>(tips2<span class="op">$</span>sex)[<span class="kw">levels</span>(tips2<span class="op">$</span>sex) <span class="op">==</span><span class="st"> &quot;Male&quot;</span>] &lt;-<span class="st"> &quot;Men&quot;</span>
<span class="kw">head</span>(tips2, <span class="dv">3</span>)
<span class="co">#&gt;   total_bill  tip   sex smoker day   time size</span>
<span class="co">#&gt; 1      16.99 1.01 Women     No Sun Dinner    2</span>
<span class="co">#&gt; 2      10.34 1.66   Men     No Sun Dinner    3</span>
<span class="co">#&gt; 3      21.01 3.50   Men     No Sun Dinner    3</span>
sp2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(tips2, <span class="kw">aes</span>(<span class="dt">x =</span> total_bill, <span class="dt">y =</span> tip<span class="op">/</span>total_bill)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">1</span>)
sp2 <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>sex)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-340-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>两种方法都能得到相同的结果。</p>
<p><code>labeller()</code> 可以通过设定不同的 <code>函数</code> 来处理输入的字符向量。比方说 <code>Hmisc</code> 包里的 <code>capitalize</code> 函数可以将字符串的首字母变成大写。我们也可以这样来自定义函数，如下所示，将字符串中的字母倒序：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 对每个字符向量进行倒序：</span>
reverse &lt;-<span class="st"> </span><span class="cf">function</span>(strings) {
  strings &lt;-<span class="st"> </span><span class="kw">strsplit</span>(strings, <span class="st">&quot;&quot;</span>)
  <span class="kw">vapply</span>(strings, <span class="cf">function</span>(x) {
    <span class="kw">paste</span>(<span class="kw">rev</span>(x), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>)
  }, <span class="dt">FUN.VALUE =</span> <span class="kw">character</span>(<span class="dv">1</span>))
}
sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>sex, <span class="dt">labeller =</span> <span class="kw">labeller</span>(<span class="dt">sex =</span> reverse))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-341-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.9.2.6" class="section level4">
<h4><span class="header-section-number">9.9.2.6</span> 设置标度</h4>
<p>一般而言，每幅图的坐标轴范围都是<strong>固定不变</strong>的，也就是说每幅图都拥有相同的尺寸和范围。你可以通过将 <code>scales</code> 设置为 <code>free</code>，<code>free_x</code> 或 <code>free_y</code> 来改变坐标轴范围。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 描绘一个 total_bill 的柱状图</span>
hp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(tips, <span class="kw">aes</span>(<span class="dt">x =</span> total_bill)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">2</span>, 
  <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>)
<span class="co"># 根据性别和是否吸烟进行分面</span>
hp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>smoker)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-342-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 在同样的情况下设定 scales=&#39;free_y&#39; (y 轴自由标度）</span>
hp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>smoker, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-342-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 画布的缩放比例不变，但各分面的范围有所改变，因此每个分面的物理大小都不一致</span>
hp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>smoker, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">space =</span> <span class="st">&quot;free&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-342-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="section-9.10" class="section level2">
<h2><span class="header-section-number">9.10</span> 多图</h2>
<div id="-62" class="section level3">
<h3><span class="header-section-number">9.10.1</span> 问题</h3>
<p>你想把多个图形放到同一个页面中。</p>
</div>
<div id="-61" class="section level3">
<h3><span class="header-section-number">9.10.2</span> 方案</h3>
<p>最简单的方法就是使用 <code>multiplot()</code> 函数。</p>
<p><code>multiplot()</code> 函数可以将任意数量的图像对象作为参数，或者可以构建一个图像对象列表传递到该函数的 <code>plotlist</code> 参数中。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 多图功能 ggplot 对象可以直接放入 `…` 中，也可以传递到</span>
<span class="co"># `plotlist` 里（这里的 ggplot 对象以列表形式存在） -</span>
<span class="co"># cols: 图像的列数 - layout:</span>
<span class="co"># 用来指定布局的一组矩阵。当其存在时，可以忽略 `cols`</span>
<span class="co"># 参数。 假设 layout 参数是 matrix(c(1,2,3,3), nrow=2,</span>
<span class="co"># byrow = TRUE),</span>
<span class="co"># 那么第一幅图像会位于左上方，第二幅图会在右上方，而</span>
<span class="co"># 第三幅图会占据整个下方。</span>
multiplot &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">plotlist =</span> <span class="ot">NULL</span>, file, <span class="dt">cols =</span> <span class="dv">1</span>, 
  <span class="dt">layout =</span> <span class="ot">NULL</span>) {
  <span class="kw">library</span>(grid)
  
  <span class="co"># 从参数 `…`中建立一个列表然后 plotlist</span>
  plots &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">list</span>(...), plotlist)
  
  numPlots =<span class="st"> </span><span class="kw">length</span>(plots)
  <span class="co"># 假如 layout 是 NULL, 那么可以用 `cols` 来定义布局</span>
  <span class="cf">if</span> (<span class="kw">is.null</span>(layout)) {
    <span class="co"># 创建面板 ncol: 图像的列数 nrow:</span>
    <span class="co"># 根据上述给定的列数，计算所需要的行数</span>
    layout &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">seq</span>(<span class="dv">1</span>, cols <span class="op">*</span><span class="st"> </span><span class="kw">ceiling</span>(numPlots<span class="op">/</span>cols)), 
      <span class="dt">ncol =</span> cols, <span class="dt">nrow =</span> <span class="kw">ceiling</span>(numPlots<span class="op">/</span>cols))
  }
  <span class="cf">if</span> (numPlots <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {
    <span class="kw">print</span>(plots[[<span class="dv">1</span>]])
  } <span class="cf">else</span> {
    <span class="co"># 创建页面</span>
    <span class="kw">grid.newpage</span>()
    <span class="kw">pushViewport</span>(<span class="kw">viewport</span>(<span class="dt">layout =</span> <span class="kw">grid.layout</span>(<span class="kw">nrow</span>(layout), 
      <span class="kw">ncol</span>(layout))))
    <span class="co"># 让每一幅图像排列在正确的位置</span>
    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>numPlots) {
      <span class="co"># 获取包含这一子图所在区域的坐标 matrix i,j</span>
      matchidx &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">which</span>(layout <span class="op">==</span><span class="st"> </span>i, 
        <span class="dt">arr.ind =</span> <span class="ot">TRUE</span>))
      <span class="kw">print</span>(plots[[i]], <span class="dt">vp =</span> <span class="kw">viewport</span>(<span class="dt">layout.pos.row =</span> matchidx<span class="op">$</span>row, 
        <span class="dt">layout.pos.col =</span> matchidx<span class="op">$</span>col))
    }
  }
}</code></pre>
<p>如果它不能满足你的需求，你可以将其复制下来然后作出适当的修改。</p>
<p>首先，构建并保存图像但不需要对它们进行渲染，这些图像的细节并不重要。你只需要将这些图像对象储存为变量。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 以下例子使用的是 ggplot2 包中自带的 Chickweight 数据集</span>
<span class="co"># 第一幅图像</span>
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ChickWeight, <span class="kw">aes</span>(<span class="dt">x =</span> Time, <span class="dt">y =</span> weight, <span class="dt">colour =</span> Diet, 
  <span class="dt">group =</span> Chick)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Growth curve for individual chicks&quot;</span>)

<span class="co"># 第二幅图像</span>
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ChickWeight, <span class="kw">aes</span>(<span class="dt">x =</span> Time, <span class="dt">y =</span> weight, <span class="dt">colour =</span> Diet)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Fitted growth curve per diet&quot;</span>)

<span class="co"># 第三幅图像</span>
p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">subset</span>(ChickWeight, Time <span class="op">==</span><span class="st"> </span><span class="dv">21</span>), <span class="kw">aes</span>(<span class="dt">x =</span> weight, 
  <span class="dt">colour =</span> Diet)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Final weight, by diet&quot;</span>)

<span class="co"># 第四幅图像</span>
p4 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">subset</span>(ChickWeight, Time <span class="op">==</span><span class="st"> </span><span class="dv">21</span>), <span class="kw">aes</span>(<span class="dt">x =</span> weight, 
  <span class="dt">fill =</span> Diet)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">binwidth =</span> <span class="dv">50</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_grid</span>(Diet <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Final weight, by diet&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)  <span class="co">#为了避免冗余，这里不添加图例</span></code></pre>
<p>这些图像都构建好了后，我们可以用 <code>multiplot()</code> 对它们进行渲染。下面将这些图形分成两列进行展示：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">multiplot</span>(p1, p2, p3, p4, <span class="dt">cols =</span> <span class="dv">2</span>)
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-345-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="ggplot2-colors" class="section level2">
<h2><span class="header-section-number">9.11</span> 颜色</h2>
<div id="-63" class="section level3">
<h3><span class="header-section-number">9.11.1</span> 问题</h3>
<p>你想在图表中用 <strong>ggplot2</strong> 添加颜色。</p>
</div>
<div id="-62" class="section level3">
<h3><span class="header-section-number">9.11.2</span> 方案</h3>
<p>在 <strong>ggplot2</strong> 中设置颜色，对相互区分不同变量会有些困难，因为这些颜色有一样的亮度，且对色盲者不太友好。一个比较好的通用解决方案是使用对<a href="ggplot2.html#colorblind-friendly">色盲友好</a>的颜色。</p>
<div id="-2" class="section level4">
<h4><span class="header-section-number">9.11.2.1</span> 样本数据</h4>
<p>这两个数据集将用来产生下面的图表：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 两个变量</span>
df &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">text =</span> <span class="st">&quot;</span>
<span class="st"> cond yval</span>
<span class="st">  A 2</span>
<span class="st">  B 2.5</span>
<span class="st">  C 1.6</span>
<span class="st">&quot;</span>)

<span class="co"># 三个变量</span>
df2 &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">text =</span> <span class="st">&quot;</span>
<span class="st"> cond1 cond2 yval</span>
<span class="st">  A      I 2</span>
<span class="st">  A      J 2.5</span>
<span class="st">  A      K 1.6</span>
<span class="st">  B      I 2.2</span>
<span class="st">  B      J 2.4</span>
<span class="st">  B      K 1.2</span>
<span class="st">  C      I 1.7</span>
<span class="st">  C      J 2.3</span>
<span class="st">  C      K 1.9</span>
<span class="st">&quot;</span>)</code></pre>
</div>
<div id="section-9.11.2.2" class="section level4">
<h4><span class="header-section-number">9.11.2.2</span> 简单的颜色设置</h4>
<p>有颜色的线条和点可以直接用 <code>colour = &quot;red&quot;</code>, 用颜色名称代替 <code>&quot;red&quot;</code>。填充的对象的颜色，如柱状条，可以用 <code>fill=&quot;red&quot;</code> 来进行设置。</p>
<p>如果你想用任何其他非常规颜色，用十六进位码来设置颜色更容易，比如 <code>#FF6699</code>。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="co"># 设置：黑色柱状条</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-347-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 柱状条外用红色边线</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">colour=</span><span class="st">&quot;#FF9999&quot;</span>) </code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-347-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 红色填充，黑色边线</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;#FF9999&quot;</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-347-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 标准黑色线条和点</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group=</span><span class="dv">1</span>)) <span class="op">+</span><span class="st">     </span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-347-4.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 蓝黑色线条，红色点</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group=</span><span class="dv">1</span>), <span class="dt">colour=</span><span class="st">&quot;#000099&quot;</span>) <span class="op">+</span><span class="st">  </span><span class="co"># 蓝线</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>, <span class="dt">colour=</span><span class="st">&quot;#CC0000&quot;</span>)         <span class="co"># 红点</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-347-5.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.11.2.3" class="section level4">
<h4><span class="header-section-number">9.11.2.3</span> 将变量值映射到颜色</h4>
<p>不用全局改变颜色，你可以将变量映射到颜色——换言之，通过把颜色放到 <code>aes()</code> 函数中，可以设置条件性变量。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 柱状条: x 和填充都依赖于cond2</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval, <span class="dt">fill=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-348-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 其他数据集的柱状条；填充依赖于cond2</span>
<span class="kw">ggplot</span>(df2, <span class="kw">aes</span>(<span class="dt">x=</span>cond1, <span class="dt">y=</span>yval)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">fill=</span>cond2),   <span class="co"># 填充依赖于cond2</span>
             <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>,
             <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>,    <span class="co"># 所有都是黑色轮廓线</span>
             <span class="dt">position=</span><span class="kw">position_dodge</span>()) <span class="co"># 把线条并排放置而非堆叠</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-348-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># 线和点；颜色依赖于cond2</span>
<span class="kw">ggplot</span>(df2, <span class="kw">aes</span>(<span class="dt">x=</span>cond1, <span class="dt">y=</span>yval)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">colour=</span>cond2, <span class="dt">group=</span>cond2)) <span class="op">+</span><span class="st"> </span><span class="co"># 颜色分组都依赖于cond2</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour=</span>cond2),               <span class="co"># 颜色依赖于cond2</span>
               <span class="dt">size=</span><span class="dv">3</span>)                          <span class="co"># 更大的点，不同的形状</span></code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-348-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 以上操作等价; 但把 &quot;colour=cond2&quot; 移到全局的映射用aes() </span>
<span class="co"># ggplot(df2, aes(x=cond1, y=yval, colour=cond2)) + </span>
<span class="co">#    geom_line(aes(group=cond2)) +</span>
<span class="co">#    geom_point(size=3)</span></code></pre>
</div>
<div id="colorblind-friendly" class="section level4">
<h4><span class="header-section-number">9.11.2.4</span> 对色盲友好的颜色</h4>
<p>下面这些是对色盲友好的颜色色板，一个用灰色，一个用黑色：</p>
<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-5-1.png" /><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-5-2.png" /></p>
<p>为了用 <strong>ggplot2</strong>, 我们在一个变量里储存颜色色板，然后之后调用。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 灰色的颜色色板:</span>
cbPalette &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>, <span class="st">&quot;#009E73&quot;</span>, 
  <span class="st">&quot;#F0E442&quot;</span>, <span class="st">&quot;#0072B2&quot;</span>, <span class="st">&quot;#D55E00&quot;</span>, <span class="st">&quot;#CC79A7&quot;</span>)
<span class="co"># 黑色的颜色色板k:</span>
cbbPalette &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#000000&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>, <span class="st">&quot;#009E73&quot;</span>, 
  <span class="st">&quot;#F0E442&quot;</span>, <span class="st">&quot;#0072B2&quot;</span>, <span class="st">&quot;#D55E00&quot;</span>, <span class="st">&quot;#CC79A7&quot;</span>)
<span class="co"># 为了填充颜色，加</span>
<span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> cbPalette)
<span class="co">#&gt; &lt;ggproto object: Class ScaleDiscrete, Scale, gg&gt;</span>
<span class="co">#&gt;     aesthetics: fill</span>
<span class="co">#&gt;     axis_order: function</span>
<span class="co">#&gt;     break_info: function</span>
<span class="co">#&gt;     break_positions: function</span>
<span class="co">#&gt;     breaks: waiver</span>
<span class="co">#&gt;     call: call</span>
<span class="co">#&gt;     clone: function</span>
<span class="co">#&gt;     dimension: function</span>
<span class="co">#&gt;     drop: TRUE</span>
<span class="co">#&gt;     expand: waiver</span>
<span class="co">#&gt;     get_breaks: function</span>
<span class="co">#&gt;     get_breaks_minor: function</span>
<span class="co">#&gt;     get_labels: function</span>
<span class="co">#&gt;     get_limits: function</span>
<span class="co">#&gt;     guide: legend</span>
<span class="co">#&gt;     is_discrete: function</span>
<span class="co">#&gt;     is_empty: function</span>
<span class="co">#&gt;     labels: waiver</span>
<span class="co">#&gt;     limits: NULL</span>
<span class="co">#&gt;     make_sec_title: function</span>
<span class="co">#&gt;     make_title: function</span>
<span class="co">#&gt;     map: function</span>
<span class="co">#&gt;     map_df: function</span>
<span class="co">#&gt;     n.breaks.cache: NULL</span>
<span class="co">#&gt;     na.translate: TRUE</span>
<span class="co">#&gt;     na.value: NA</span>
<span class="co">#&gt;     name: waiver</span>
<span class="co">#&gt;     palette: function</span>
<span class="co">#&gt;     palette.cache: NULL</span>
<span class="co">#&gt;     position: left</span>
<span class="co">#&gt;     range: &lt;ggproto object: Class RangeDiscrete, Range, gg&gt;</span>
<span class="co">#&gt;         range: NULL</span>
<span class="co">#&gt;         reset: function</span>
<span class="co">#&gt;         train: function</span>
<span class="co">#&gt;         super:  &lt;ggproto object: Class RangeDiscrete, Range, gg&gt;</span>
<span class="co">#&gt;     reset: function</span>
<span class="co">#&gt;     scale_name: manual</span>
<span class="co">#&gt;     train: function</span>
<span class="co">#&gt;     train_df: function</span>
<span class="co">#&gt;     transform: function</span>
<span class="co">#&gt;     transform_df: function</span>
<span class="co">#&gt;     super:  &lt;ggproto object: Class ScaleDiscrete, Scale, gg&gt;</span>
<span class="co"># 为了在点线中使用颜色，加</span>
<span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> cbPalette)
<span class="co">#&gt; &lt;ggproto object: Class ScaleDiscrete, Scale, gg&gt;</span>
<span class="co">#&gt;     aesthetics: colour</span>
<span class="co">#&gt;     axis_order: function</span>
<span class="co">#&gt;     break_info: function</span>
<span class="co">#&gt;     break_positions: function</span>
<span class="co">#&gt;     breaks: waiver</span>
<span class="co">#&gt;     call: call</span>
<span class="co">#&gt;     clone: function</span>
<span class="co">#&gt;     dimension: function</span>
<span class="co">#&gt;     drop: TRUE</span>
<span class="co">#&gt;     expand: waiver</span>
<span class="co">#&gt;     get_breaks: function</span>
<span class="co">#&gt;     get_breaks_minor: function</span>
<span class="co">#&gt;     get_labels: function</span>
<span class="co">#&gt;     get_limits: function</span>
<span class="co">#&gt;     guide: legend</span>
<span class="co">#&gt;     is_discrete: function</span>
<span class="co">#&gt;     is_empty: function</span>
<span class="co">#&gt;     labels: waiver</span>
<span class="co">#&gt;     limits: NULL</span>
<span class="co">#&gt;     make_sec_title: function</span>
<span class="co">#&gt;     make_title: function</span>
<span class="co">#&gt;     map: function</span>
<span class="co">#&gt;     map_df: function</span>
<span class="co">#&gt;     n.breaks.cache: NULL</span>
<span class="co">#&gt;     na.translate: TRUE</span>
<span class="co">#&gt;     na.value: NA</span>
<span class="co">#&gt;     name: waiver</span>
<span class="co">#&gt;     palette: function</span>
<span class="co">#&gt;     palette.cache: NULL</span>
<span class="co">#&gt;     position: left</span>
<span class="co">#&gt;     range: &lt;ggproto object: Class RangeDiscrete, Range, gg&gt;</span>
<span class="co">#&gt;         range: NULL</span>
<span class="co">#&gt;         reset: function</span>
<span class="co">#&gt;         train: function</span>
<span class="co">#&gt;         super:  &lt;ggproto object: Class RangeDiscrete, Range, gg&gt;</span>
<span class="co">#&gt;     reset: function</span>
<span class="co">#&gt;     scale_name: manual</span>
<span class="co">#&gt;     train: function</span>
<span class="co">#&gt;     train_df: function</span>
<span class="co">#&gt;     transform: function</span>
<span class="co">#&gt;     transform_df: function</span>
<span class="co">#&gt;     super:  &lt;ggproto object: Class ScaleDiscrete, Scale, gg&gt;</span></code></pre>
<p>这个颜色集来源于网站： <a href="http://jfly.iam.u-tokyo.ac.jp/color/" class="uri">http://jfly.iam.u-tokyo.ac.jp/color/</a>。</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-350"></span>
<img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/colorblind_palette.jpg" alt="色盲友好调色板"  />
<p class="caption">
图 9.1: 色盲友好调色板
</p>
</div>
</div>
<div id="section-9.11.2.5" class="section level4">
<h4><span class="header-section-number">9.11.2.5</span> 颜色选择</h4>
<p>默认情况下，离散比例的颜色围绕 HSL 色环均匀分布。例如，如果有两种颜色，那么它们将从圆圈上的相对点中选择; 如果有三种颜色，它们在色环上将相隔 120° 等等。用于不同级别的颜色如下所示：</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-351"></span>
<img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-7-1.png" alt="均匀色环"  />
<p class="caption">
图 9.2: 均匀色环
</p>
</div>
<p>默认颜色选择使用 <code>scale_fill_hue()</code> 和 <code>scale_colour_hue()</code>。 例如，在以下情况下添加这些命令是多余的：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 这两个是等价的; 默认使用scale_fill_hue()</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> yval, <span class="dt">fill =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-352-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ggplot(df, aes(x=cond, y=yval, fill=cond)) +</span>
<span class="co"># geom_bar(stat=&#39;identity&#39;) + scale_fill_hue()</span>
<span class="co"># 这两个是等价的; 默认使用scale_colour_hue()</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> yval, <span class="dt">colour =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-352-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ggplot(df, aes(x=cond, y=yval, colour=cond)) +</span>
<span class="co"># geom_point(size=2) + scale_colour_hue()</span></code></pre>
</div>
<div id="section-9.11.2.6" class="section level4">
<h4><span class="header-section-number">9.11.2.6</span> 设置亮度和饱和度（色度）</h4>
<p>虽然 <code>scale_fill_hue()</code> 和 <code>scale_colour_hue()</code> 在上面是多余的，但是当你想要改变默认值时，可以使用它们，比如改变亮度或色度。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 使用 luminance = 45, 而不是默认 65</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> yval, <span class="dt">fill =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_fill_hue</span>(<span class="dt">l =</span> <span class="dv">40</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-353-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 从 100 到 50 减少饱和度（亮度）, 增加亮度</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> yval, <span class="dt">fill =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_fill_hue</span>(<span class="dt">c =</span> <span class="dv">45</span>, <span class="dt">l =</span> <span class="dv">80</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-353-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 注意：使用 scale_colour_hue() 设置线和点</span></code></pre>
<p>亮度为 45 时的颜色图表:</p>
<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-10-1.png" style="display: block; margin: auto;" /></p>
</div>
<div id="color-brewer" class="section level4">
<h4><span class="header-section-number">9.11.2.7</span> 调色板：Color Brewer</h4>
<p>你还可以使用其他颜色标度，例如从 <strong>RColorBrewer</strong> 包中获取。 请参阅下面的 <strong>RColorBrewer</strong>s 调色板图表。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> yval, <span class="dt">fill =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-355-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> yval, <span class="dt">fill =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-355-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> yval, <span class="dt">fill =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Spectral&quot;</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-355-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 注意: 使用 scale_colour_brewer() 设置点和线条</span></code></pre>
</div>
<div id="section-9.11.2.8" class="section level4">
<h4><span class="header-section-number">9.11.2.8</span> 调色板：手动定义</h4>
<p>最后，你可以使用 <code>scale_fill_manual()</code> 定义自己的颜色集。 有关选择特定颜色的帮助，请参阅下面的十六进制代码表。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> yval, <span class="dt">fill =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-356-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> cond, <span class="dt">y =</span> yval, <span class="dt">fill =</span> cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#CC6666&quot;</span>, <span class="st">&quot;#9999CC&quot;</span>, <span class="st">&quot;#66CC99&quot;</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-356-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 注意：使用 scale_colour_manual() 设置线条和点</span></code></pre>
</div>
<div id="section-9.11.2.9" class="section level4">
<h4><span class="header-section-number">9.11.2.9</span> 连续颜色</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 产生一些数据</span>
<span class="kw">set.seed</span>(<span class="dv">133</span>)
df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">xval =</span> <span class="kw">rnorm</span>(<span class="dv">50</span>), <span class="dt">yval =</span> <span class="kw">rnorm</span>(<span class="dv">50</span>))
<span class="co"># 依赖 yval设置颜色</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> xval, <span class="dt">y =</span> yval, <span class="dt">colour =</span> yval)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-357-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 使用不同的渐变</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> xval, <span class="dt">y =</span> yval, <span class="dt">colour =</span> yval)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_colour_gradientn</span>(<span class="dt">colours =</span> <span class="kw">rainbow</span>(<span class="dv">4</span>))</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-357-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="section-9.11.2.10" class="section level4">
<h4><span class="header-section-number">9.11.2.10</span> 比色图表</h4>
</div>
<div id="section-9.11.2.11" class="section level4">
<h4><span class="header-section-number">9.11.2.11</span> 十六进制色码图</h4>
<p>颜色可以指定为十六进制 RGB 三元组合，例如 <code>#0066CC</code>。 前两位数字是红色，接下来的两位是绿色，最后两位是蓝色。 每个值的范围从 00 到 FF，以十六进制（base-16）表示，在 base-10 中等于 0 和 255。 例如，在下表中，<code>#FFFFFF</code> 为白色，<code>#990000</code> 为深红色。</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-358"></span>
<img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/hextable.png" alt="色码图"  />
<p class="caption">
图 9.3: 色码图
</p>
</div>
<blockquote>
<p>色码图来源于 <a href="http://www.visibone.com/">http://www.visibone.com</a></p>
</blockquote>
</div>
<div id="rcolorbrewer-" class="section level4">
<h4><span class="header-section-number">9.11.2.12</span> RColorBrewer 调色板图表</h4>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-359"></span>
<img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-14-1.png" alt="调色板图表"  />
<p class="caption">
图 9.4: 调色板图表
</p>
</div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-8.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-10.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/openbiox/Cookbook-for-R-Chinese/edit/master/book/09-graphs-ggplot2.Rmd",
"text": "编辑"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
