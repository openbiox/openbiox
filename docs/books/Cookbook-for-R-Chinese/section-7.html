<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 7 章 统计分析 | Cookbook for R 中文版</title>
  <meta name="description" content="第 7 章 统计分析 | Cookbook for R 中文版本" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="第 7 章 统计分析 | Cookbook for R 中文版" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="第 7 章 统计分析 | Cookbook for R 中文版本" />
  <meta name="github-repo" content="openbiox/Cookbook-for-R-Chinese" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 7 章 统计分析 | Cookbook for R 中文版" />
  
  <meta name="twitter:description" content="第 7 章 统计分析 | Cookbook for R 中文版本" />
  

<meta name="author" content="Winston Chang（著）" />
<meta name="author" content="王诗翔 等（译）" />


<meta name="date" content="2019-06-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="section-6.html">
<link rel="next" href="section-8.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Cookbook for R 中文版</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#section-0.1"><i class="fa fa-check"></i><b>0.1</b> 问题与反馈</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#section-0.2"><i class="fa fa-check"></i><b>0.2</b> 致谢</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html"><i class="fa fa-check"></i>作者简介</a></li>
<li class="chapter" data-level="1" data-path="chapter1.html"><a href="chapter1.html"><i class="fa fa-check"></i><b>1</b> 基础</a><ul>
<li class="chapter" data-level="1.1" data-path="chapter1.html"><a href="chapter1.html#r-pkg-installation"><i class="fa fa-check"></i><b>1.1</b> 安装和使用 R 包</a></li>
<li class="chapter" data-level="1.2" data-path="chapter1.html"><a href="chapter1.html#section-1.2"><i class="fa fa-check"></i><b>1.2</b> 数据结构的索引</a></li>
<li class="chapter" data-level="1.3" data-path="chapter1.html"><a href="chapter1.html#section-1.3"><i class="fa fa-check"></i><b>1.3</b> 获取数据结构的子集</a></li>
<li class="chapter" data-level="1.4" data-path="chapter1.html"><a href="chapter1.html#section-1.4"><i class="fa fa-check"></i><b>1.4</b> 创建填满值的向量</a></li>
<li class="chapter" data-level="1.5" data-path="chapter1.html"><a href="chapter1.html#section-1.5"><i class="fa fa-check"></i><b>1.5</b> 变量信息</a></li>
<li class="chapter" data-level="1.6" data-path="chapter1.html"><a href="chapter1.html#nullnanan-"><i class="fa fa-check"></i><b>1.6</b> NULL、NA、NaN 的处理</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="section-2.html"><a href="section-2.html"><i class="fa fa-check"></i><b>2</b> 数字</a><ul>
<li class="chapter" data-level="2.1" data-path="section-2.html"><a href="section-2.html#section-2.1"><i class="fa fa-check"></i><b>2.1</b> 生成随机数</a></li>
<li class="chapter" data-level="2.2" data-path="section-2.html"><a href="section-2.html#section-2.2"><i class="fa fa-check"></i><b>2.2</b> 生成可重复的随机序列</a></li>
<li class="chapter" data-level="2.3" data-path="section-2.html"><a href="section-2.html#section-2.3"><i class="fa fa-check"></i><b>2.3</b> 保持随机数生成器的状态</a></li>
<li class="chapter" data-level="2.4" data-path="section-2.html"><a href="section-2.html#section-2.4"><i class="fa fa-check"></i><b>2.4</b> 对数值取整</a></li>
<li class="chapter" data-level="2.5" data-path="section-2.html"><a href="section-2.html#section-2.5"><i class="fa fa-check"></i><b>2.5</b> 比较浮点数</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="section-3.html"><a href="section-3.html"><i class="fa fa-check"></i><b>3</b> 字符串</a><ul>
<li class="chapter" data-level="3.1" data-path="section-3.html"><a href="section-3.html#-grepsubgsub-"><i class="fa fa-check"></i><b>3.1</b> 使用 grep、sub、gsub 进行搜索和替换</a></li>
<li class="chapter" data-level="3.2" data-path="section-3.html"><a href="section-3.html#section-3.2"><i class="fa fa-check"></i><b>3.2</b> 通过变量创建字符串</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-4.html"><a href="section-4.html"><i class="fa fa-check"></i><b>4</b> 公式</a><ul>
<li class="chapter" data-level="4.1" data-path="section-4.html"><a href="section-4.html#section-4.1"><i class="fa fa-check"></i><b>4.1</b> 通过字符串创建公式</a></li>
<li class="chapter" data-level="4.2" data-path="section-4.html"><a href="section-4.html#section-4.2"><i class="fa fa-check"></i><b>4.2</b> 从公式中提取组分</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-5.html"><a href="section-5.html"><i class="fa fa-check"></i><b>5</b> 数据的导入与导出</a><ul>
<li class="chapter" data-level="5.1" data-path="section-5.html"><a href="section-5.html#r-import-data-from-file"><i class="fa fa-check"></i><b>5.1</b> R载入文件中的数据</a></li>
<li class="chapter" data-level="5.2" data-path="section-5.html"><a href="section-5.html#read-data-from-keyboard"><i class="fa fa-check"></i><b>5.2</b> 通过键盘和剪贴板把数据载入并保存到 R</a></li>
<li class="chapter" data-level="5.3" data-path="section-5.html"><a href="section-5.html#run-r-script"><i class="fa fa-check"></i><b>5.3</b> 运行 R 脚本</a></li>
<li class="chapter" data-level="5.4" data-path="section-5.html"><a href="section-5.html#r-write-data-into-file"><i class="fa fa-check"></i><b>5.4</b> 用 R 把数据写入文件</a></li>
<li class="chapter" data-level="5.5" data-path="section-5.html"><a href="section-5.html#r-output-analysis"><i class="fa fa-check"></i><b>5.5</b> 用 R 写入文本，分析输出到文件</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="section-6.html"><a href="section-6.html"><i class="fa fa-check"></i><b>6</b> 数据操作</a><ul>
<li class="chapter" data-level="6.1" data-path="section-6.html"><a href="section-6.html#section-6.1"><i class="fa fa-check"></i><b>6.1</b> 排序</a></li>
<li class="chapter" data-level="6.2" data-path="section-6.html"><a href="section-6.html#section-6.2"><i class="fa fa-check"></i><b>6.2</b> 随机排序</a></li>
<li class="chapter" data-level="6.3" data-path="section-6.html"><a href="section-6.html#section-6.3"><i class="fa fa-check"></i><b>6.3</b> 转换向量类型</a></li>
<li class="chapter" data-level="6.4" data-path="section-6.html"><a href="section-6.html#section-6.4"><i class="fa fa-check"></i><b>6.4</b> 查找并移除重复记录</a></li>
<li class="chapter" data-level="6.5" data-path="section-6.html"><a href="section-6.html#compare-with-nas"><i class="fa fa-check"></i><b>6.5</b> NA 存在时进行向量或因子比较</a></li>
<li class="chapter" data-level="6.6" data-path="section-6.html"><a href="section-6.html#section-6.6"><i class="fa fa-check"></i><b>6.6</b> 数据重新编码</a></li>
<li class="chapter" data-level="6.7" data-path="section-6.html"><a href="section-6.html#section-6.7"><i class="fa fa-check"></i><b>6.7</b> 映射向量值</a></li>
<li class="chapter" data-level="6.8" data-path="section-6.html"><a href="section-6.html#section-6.8"><i class="fa fa-check"></i><b>6.8</b> 重命名因子水平</a></li>
<li class="chapter" data-level="6.9" data-path="section-6.html"><a href="section-6.html#section-6.9"><i class="fa fa-check"></i><b>6.9</b> 重计算因子水平</a></li>
<li class="chapter" data-level="6.10" data-path="section-6.html"><a href="section-6.html#section-6.10"><i class="fa fa-check"></i><b>6.10</b> 改变因子水平次序</a></li>
<li class="chapter" data-level="6.11" data-path="section-6.html"><a href="section-6.html#section-6.11"><i class="fa fa-check"></i><b>6.11</b> 重命名数据框的列</a></li>
<li class="chapter" data-level="6.12" data-path="section-6.html"><a href="section-6.html#section-6.12"><i class="fa fa-check"></i><b>6.12</b> 添加和移除数据框的列</a></li>
<li class="chapter" data-level="6.13" data-path="section-6.html"><a href="section-6.html#section-6.13"><i class="fa fa-check"></i><b>6.13</b> 对数据框的列重新排序</a></li>
<li class="chapter" data-level="6.14" data-path="section-6.html"><a href="section-6.html#section-6.14"><i class="fa fa-check"></i><b>6.14</b> 合并数据框</a></li>
<li class="chapter" data-level="6.15" data-path="section-6.html"><a href="section-6.html#section-6.15"><i class="fa fa-check"></i><b>6.15</b> 比较数据框</a></li>
<li class="chapter" data-level="6.16" data-path="section-6.html"><a href="section-6.html#section-6.16"><i class="fa fa-check"></i><b>6.16</b> 重计算数据框所有因子列的水平</a></li>
<li class="chapter" data-level="6.17" data-path="section-6.html"><a href="section-6.html#section-6.17"><i class="fa fa-check"></i><b>6.17</b> 长宽格式数据互换</a></li>
<li class="chapter" data-level="6.18" data-path="section-6.html"><a href="section-6.html#section-6.18"><i class="fa fa-check"></i><b>6.18</b> 汇总数据</a></li>
<li class="chapter" data-level="6.19" data-path="section-6.html"><a href="section-6.html#section-6.19"><i class="fa fa-check"></i><b>6.19</b> 数据框与列联表互换</a></li>
<li class="chapter" data-level="6.20" data-path="section-6.html"><a href="section-6.html#section-6.20"><i class="fa fa-check"></i><b>6.20</b> 计算移动平均数</a></li>
<li class="chapter" data-level="6.21" data-path="section-6.html"><a href="section-6.html#section-6.21"><i class="fa fa-check"></i><b>6.21</b> 窗口平滑</a></li>
<li class="chapter" data-level="6.22" data-path="section-6.html"><a href="section-6.html#section-6.22"><i class="fa fa-check"></i><b>6.22</b> 寻找唯一值序列</a></li>
<li class="chapter" data-level="6.23" data-path="section-6.html"><a href="section-6.html#fill-na-with-last-value"><i class="fa fa-check"></i><b>6.23</b> 用最后一个非 NA 值填充 NA</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-7.html"><a href="section-7.html"><i class="fa fa-check"></i><b>7</b> 统计分析</a><ul>
<li class="chapter" data-level="7.1" data-path="section-7.html"><a href="section-7.html#section-7.1"><i class="fa fa-check"></i><b>7.1</b> 回归和相关分析</a></li>
<li class="chapter" data-level="7.2" data-path="section-7.html"><a href="section-7.html#t-"><i class="fa fa-check"></i><b>7.2</b> t 检验</a></li>
<li class="chapter" data-level="7.3" data-path="section-7.html"><a href="section-7.html#section-7.3"><i class="fa fa-check"></i><b>7.3</b> 频率检验</a></li>
<li class="chapter" data-level="7.4" data-path="section-7.html"><a href="section-7.html#anova"><i class="fa fa-check"></i><b>7.4</b> ANOVA</a></li>
<li class="chapter" data-level="7.5" data-path="section-7.html"><a href="section-7.html#section-7.5"><i class="fa fa-check"></i><b>7.5</b> 逻辑回归</a></li>
<li class="chapter" data-level="7.6" data-path="section-7.html"><a href="section-7.html#section-7.6"><i class="fa fa-check"></i><b>7.6</b> 变量同质性</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="section-8.html"><a href="section-8.html"><i class="fa fa-check"></i><b>8</b> 标准绘图</a><ul>
<li class="chapter" data-level="8.1" data-path="section-8.html"><a href="section-8.html#section-8.1"><i class="fa fa-check"></i><b>8.1</b> 直方图和密度图</a></li>
<li class="chapter" data-level="8.2" data-path="section-8.html"><a href="section-8.html#section-8.2"><i class="fa fa-check"></i><b>8.2</b> 散点图</a></li>
<li class="chapter" data-level="8.3" data-path="section-8.html"><a href="section-8.html#section-8.3"><i class="fa fa-check"></i><b>8.3</b> 箱线图</a></li>
<li class="chapter" data-level="8.4" data-path="section-8.html"><a href="section-8.html#qq-plot"><i class="fa fa-check"></i><b>8.4</b> QQ 图</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>9</b> ggplot2</a><ul>
<li class="chapter" data-level="9.1" data-path="ggplot2.html"><a href="ggplot2.html#section-9.1"><i class="fa fa-check"></i><b>9.1</b> 条形图与线图</a></li>
<li class="chapter" data-level="9.2" data-path="ggplot2.html"><a href="ggplot2.html#section-9.2"><i class="fa fa-check"></i><b>9.2</b> 绘制均值和误差线</a></li>
<li class="chapter" data-level="9.3" data-path="ggplot2.html"><a href="ggplot2.html#section-9.3"><i class="fa fa-check"></i><b>9.3</b> 分布图</a></li>
<li class="chapter" data-level="9.4" data-path="chapter1.html"><a href="chapter1.html#-1"><i class="fa fa-check"></i><b>9.4</b> 散点图</a></li>
<li class="chapter" data-level="9.5" data-path="ggplot2.html"><a href="ggplot2.html#section-9.5"><i class="fa fa-check"></i><b>9.5</b> 标题</a></li>
<li class="chapter" data-level="9.6" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-axes"><i class="fa fa-check"></i><b>9.6</b> 坐标轴</a></li>
<li class="chapter" data-level="9.7" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-legends"><i class="fa fa-check"></i><b>9.7</b> 图例</a></li>
<li class="chapter" data-level="9.8" data-path="ggplot2.html"><a href="ggplot2.html#section-9.8"><i class="fa fa-check"></i><b>9.8</b> 线条</a></li>
<li class="chapter" data-level="9.9" data-path="ggplot2.html"><a href="ggplot2.html#ggplot-facet"><i class="fa fa-check"></i><b>9.9</b> 分面</a></li>
<li class="chapter" data-level="9.10" data-path="ggplot2.html"><a href="ggplot2.html#section-9.10"><i class="fa fa-check"></i><b>9.10</b> 多图</a></li>
<li class="chapter" data-level="9.11" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-colors"><i class="fa fa-check"></i><b>9.11</b> 颜色</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="section-10.html"><a href="section-10.html"><i class="fa fa-check"></i><b>10</b> 图形混杂</a><ul>
<li class="chapter" data-level="10.1" data-path="section-10.html"><a href="section-10.html#-pdf-png-tiff-svg"><i class="fa fa-check"></i><b>10.1</b> 输出到文件 PDF-PNG-TIFF-SVG</a></li>
<li class="chapter" data-level="10.2" data-path="section-10.html"><a href="section-10.html#shape-and-linetype"><i class="fa fa-check"></i><b>10.2</b> 形状和线形</a></li>
<li class="chapter" data-level="10.3" data-path="section-10.html"><a href="section-10.html#section-10.3"><i class="fa fa-check"></i><b>10.3</b> 字体</a></li>
<li class="chapter" data-level="10.4" data-path="section-10.html"><a href="section-10.html#section-10.4"><i class="fa fa-check"></i><b>10.4</b> 抗混淆位图输出</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="section-11.html"><a href="section-11.html"><i class="fa fa-check"></i><b>11</b> 其他有趣图形</a><ul>
<li class="chapter" data-level="11.1" data-path="section-11.html"><a href="section-11.html#corr-mat"><i class="fa fa-check"></i><b>11.1</b> 相关矩阵</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="section-12.html"><a href="section-12.html"><i class="fa fa-check"></i><b>12</b> 脚本与函数</a><ul>
<li class="chapter" data-level="12.1" data-path="section-12.html"><a href="section-12.html#section-12.1"><i class="fa fa-check"></i><b>12.1</b> 创建和运行一个脚本</a></li>
<li class="chapter" data-level="12.2" data-path="section-12.html"><a href="section-12.html#section-12.2"><i class="fa fa-check"></i><b>12.2</b> 调试脚本或函数</a></li>
<li class="chapter" data-level="12.3" data-path="section-12.html"><a href="section-12.html#section-12.3"><i class="fa fa-check"></i><b>12.3</b> 测量运行的时间</a></li>
<li class="chapter" data-level="12.4" data-path="section-12.html"><a href="section-12.html#section-12.4"><i class="fa fa-check"></i><b>12.4</b> 获取包中的函数和对象列表</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="section-13.html"><a href="section-13.html"><i class="fa fa-check"></i><b>13</b> 工具</a><ul>
<li class="chapter" data-level="13.1" data-path="section-13.html"><a href="section-13.html#section-13.1"><i class="fa fa-check"></i><b>13.1</b> 生成拉丁方</a></li>
</ul></li>
<li class="appendix"><span><b>附录</b></span></li>
<li class="chapter" data-level="A" data-path="materials.html"><a href="materials.html"><i class="fa fa-check"></i><b>A</b> 资料推荐</a><ul>
<li class="chapter" data-level="A.1" data-path="07-stats.html"><a href="#section-A.1"><i class="fa fa-check"></i><b>A.1</b> 书籍</a></li>
<li class="chapter" data-level="A.2" data-path="materials.html"><a href="materials.html#r-"><i class="fa fa-check"></i><b>A.2</b> R 包</a></li>
<li class="chapter" data-level="A.3" data-path="07-stats.html"><a href="#section-A.3"><i class="fa fa-check"></i><b>A.3</b> 网站</a></li>
<li class="chapter" data-level="A.4" data-path="chapter1.html"><a href="chapter1.html#-2"><i class="fa fa-check"></i><b>A.4</b> 列表</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>参考文献</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">本书由 bookdown 强力驱动</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cookbook for R 中文版</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-7" class="section level1">
<h1><span class="header-section-number">第 7 章</span> 统计分析</h1>
<div id="section-7.1" class="section level2">
<h2><span class="header-section-number">7.1</span> 回归和相关分析</h2>
<div id="-43" class="section level3">
<h3><span class="header-section-number">7.1.1</span> 问题</h3>
<p>你想要做线性回归或相关分析。</p>
</div>
<div id="-42" class="section level3">
<h3><span class="header-section-number">7.1.2</span> 方案</h3>
<p>要处理的一些样例数据：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 制造一些数据 X 增加（大的干扰噪声） Z 缓慢增加 构建</span>
<span class="co"># Y，它与 X 变量负相关，与 X*Z 变量正相关</span>
<span class="kw">set.seed</span>(<span class="dv">955</span>)
xvar &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">20</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>, <span class="dt">sd =</span> <span class="dv">3</span>)
zvar &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">20</span><span class="op">/</span><span class="dv">4</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>, <span class="dt">sd =</span> <span class="dv">2</span>)
yvar &lt;-<span class="st"> </span><span class="dv">-2</span> <span class="op">*</span><span class="st"> </span>xvar <span class="op">+</span><span class="st"> </span>xvar <span class="op">*</span><span class="st"> </span>zvar<span class="op">/</span><span class="dv">5</span> <span class="op">+</span><span class="st"> </span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>, <span class="dt">sd =</span> <span class="dv">4</span>)

<span class="co"># 通过组合已创建的向量来构建数据框</span>
dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> xvar, <span class="dt">y =</span> yvar, <span class="dt">z =</span> zvar)
<span class="co"># 展示前 6 行</span>
<span class="kw">head</span>(dat)
<span class="co">#&gt;        x       y        z</span>
<span class="co">#&gt; 1 -4.252   4.586  1.89877</span>
<span class="co">#&gt; 2  1.702  -4.903 -0.82937</span>
<span class="co">#&gt; 3  4.323  -4.308 -1.31283</span>
<span class="co">#&gt; 4  1.781   0.205 -0.28479</span>
<span class="co">#&gt; 5 11.537 -29.767 -1.27304</span>
<span class="co">#&gt; 6  6.672 -10.146 -0.09459</span></code></pre>
<div id="section-7.1.2.1" class="section level4">
<h4><span class="header-section-number">7.1.2.1</span> 相关系数</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 相关系数 - 默认使用 pearson 方法</span>
<span class="kw">cor</span>(dat<span class="op">$</span>x, dat<span class="op">$</span>y)
<span class="co">#&gt; [1] -0.7695</span></code></pre>
</div>
<div id="section-7.1.2.2" class="section level4">
<h4><span class="header-section-number">7.1.2.2</span> 相关矩阵（多个变量）</h4>
<p>同时可以对多个变量进行两两相关性分析，结果是一个 nxn 的平方矩阵或是数据框。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 变量之间的相关矩阵</span>
<span class="kw">cor</span>(dat)
<span class="co">#&gt;         x         y        z</span>
<span class="co">#&gt; x  1.0000 -0.769538 0.491699</span>
<span class="co">#&gt; y -0.7695  1.000000 0.004172</span>
<span class="co">#&gt; z  0.4917  0.004172 1.000000</span>

<span class="co"># 保留两位小数点</span>
<span class="kw">round</span>(<span class="kw">cor</span>(dat), <span class="dv">2</span>)
<span class="co">#&gt;       x     y    z</span>
<span class="co">#&gt; x  1.00 -0.77 0.49</span>
<span class="co">#&gt; y -0.77  1.00 0.00</span>
<span class="co">#&gt; z  0.49  0.00 1.00</span></code></pre>
</div>
<div id="section-7.1.2.3" class="section level4">
<h4><span class="header-section-number">7.1.2.3</span> 线性回归</h4>
<p>线性回归，当 <code>dat$x</code> 是预测变量时，<code>dat$y</code> 为响应变量。这可以使用一个数据框的两列，或者是直接使用数值向量。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 下面两个命令会显示一样的结果</span>
fit &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> dat)  <span class="co"># 使用数据框的 x 列和 y 列</span>
fit &lt;-<span class="st"> </span><span class="kw">lm</span>(dat<span class="op">$</span>y <span class="op">~</span><span class="st"> </span>dat<span class="op">$</span>x)  <span class="co"># 使用 dat$x 和 dat$y 进行拟合</span>
fit
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = dat$y ~ dat$x)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)        dat$x  </span>
<span class="co">#&gt;      -0.228       -1.183</span>

<span class="co"># 这说明预测 y = -0.2278 - 1.1829*x 获取更详细的信息</span>
<span class="kw">summary</span>(fit)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = dat$y ~ dat$x)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;     Min      1Q  Median      3Q     Max </span>
<span class="co">#&gt; -15.892  -2.511   0.287   4.465   9.329 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)   -0.228      2.632   -0.09     0.93    </span>
<span class="co">#&gt; dat$x         -1.183      0.231   -5.11  7.3e-05 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  </span>
<span class="co">#&gt; 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 6.51 on 18 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.592,  Adjusted R-squared:  0.57 </span>
<span class="co">#&gt; F-statistic: 26.1 on 1 and 18 DF,  p-value: 7.28e-05</span></code></pre>
</div>
<div id="section-7.1.2.4" class="section level4">
<h4><span class="header-section-number">7.1.2.4</span> 多个预测变量的线性回归（多元线性回归）</h4>
<p>使用 <code>y</code> 作为线性回归的响应变量，<code>x</code> 和 <code>z</code> 作为预测变量。</p>
<p>注意下面的公式没有检测 <code>x</code> 与 <code>z</code> 之间的交互效应。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 这些都有相同的结果</span>
fit2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>z, <span class="dt">data =</span> dat)  <span class="co"># 使用数据框的 x,y,z 列</span>
fit2 &lt;-<span class="st"> </span><span class="kw">lm</span>(dat<span class="op">$</span>y <span class="op">~</span><span class="st"> </span>dat<span class="op">$</span>x <span class="op">+</span><span class="st"> </span>dat<span class="op">$</span>z)  <span class="co"># 使用向量</span>
fit2
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = dat$y ~ dat$x + dat$z)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)        dat$x        dat$z  </span>
<span class="co">#&gt;       -1.38        -1.56         1.86</span>

<span class="kw">summary</span>(fit2)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = dat$y ~ dat$x + dat$z)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;    Min     1Q Median     3Q    Max </span>
<span class="co">#&gt;  -7.97  -3.19  -1.21   3.85   7.52 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)   -1.382      1.988   -0.70   0.4964    </span>
<span class="co">#&gt; dat$x         -1.564      0.198   -7.88  4.5e-07 ***</span>
<span class="co">#&gt; dat$z          1.858      0.475    3.91   0.0011 ** </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  </span>
<span class="co">#&gt; 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 4.86 on 17 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.785,  Adjusted R-squared:  0.76 </span>
<span class="co">#&gt; F-statistic: 31.1 on 2 and 17 DF,  p-value: 2.1e-06</span></code></pre>
<div id="section-7.1.2.4.1" class="section level5">
<h5><span class="header-section-number">7.1.2.4.1</span> 交互效应</h5>
<p>如何合适地构建多元线性回归并且检验交互效应非常复杂，这里不作讲述。这里我们仅仅用 <code>x</code> 和 <code>z</code> 变量以及它们之间的交互效应拟合模型。</p>
<p>想要构建 <code>x</code> 与 <code>z</code> 之间的交互效应模型，需要添加 <code>x:z</code> 项。我们也可以使用公式 <code>x*z</code> 来代表 <code>x+z+x:z</code> 。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 下面两个公式等效</span>
fit3 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>z, <span class="dt">data =</span> dat)
fit3 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>z <span class="op">+</span><span class="st"> </span>x<span class="op">:</span>z, <span class="dt">data =</span> dat)
fit3
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = y ~ x + z + x:z, data = dat)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)            x            z          x:z  </span>
<span class="co">#&gt;       2.282       -2.131       -0.107        0.208</span>

<span class="kw">summary</span>(fit3)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = y ~ x + z + x:z, data = dat)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;    Min     1Q Median     3Q    Max </span>
<span class="co">#&gt; -5.305 -3.600  0.393  2.138  8.396 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)   2.2820     2.2006    1.04    0.315    </span>
<span class="co">#&gt; x            -2.1311     0.2741   -7.78    8e-07 ***</span>
<span class="co">#&gt; z            -0.1068     0.8482   -0.13    0.901    </span>
<span class="co">#&gt; x:z           0.2081     0.0787    2.64    0.018 *  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  </span>
<span class="co">#&gt; 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 4.18 on 16 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.85,   Adjusted R-squared:  0.822 </span>
<span class="co">#&gt; F-statistic: 30.3 on 3 and 16 DF,  p-value: 7.76e-07</span></code></pre>
</div>
</div>
</div>
</div>
<div id="t-" class="section level2">
<h2><span class="header-section-number">7.2</span> t 检验</h2>
<div id="-44" class="section level3">
<h3><span class="header-section-number">7.2.1</span> 问题</h3>
<p>你想要检验来自两个总体的样本是否有不同的均值（显著性差异），或者检验从一个总体抽取的样本均值和理论均值有显著性差异。</p>
</div>
<div id="-43" class="section level3">
<h3><span class="header-section-number">7.2.2</span> 方案</h3>
<div id="section-7.2.2.1" class="section level4">
<h4><span class="header-section-number">7.2.2.1</span> 样本数据</h4>
<p>我们将使用内置的 <code>sleep</code> 数据集。</p>
<pre class="sourceCode r"><code class="sourceCode r">sleep
<span class="co">#&gt;    extra group ID</span>
<span class="co">#&gt; 1    0.7     1  1</span>
<span class="co">#&gt; 2   -1.6     1  2</span>
<span class="co">#&gt; 3   -0.2     1  3</span>
<span class="co">#&gt; 4   -1.2     1  4</span>
<span class="co">#&gt; 5   -0.1     1  5</span>
<span class="co">#&gt; 6    3.4     1  6</span>
<span class="co">#&gt; 7    3.7     1  7</span>
<span class="co">#&gt; 8    0.8     1  8</span>
<span class="co">#&gt; 9    0.0     1  9</span>
<span class="co">#&gt; 10   2.0     1 10</span>
<span class="co">#&gt; 11   1.9     2  1</span>
<span class="co">#&gt; 12   0.8     2  2</span>
<span class="co">#&gt; 13   1.1     2  3</span>
<span class="co">#&gt; 14   0.1     2  4</span>
<span class="co">#&gt; 15  -0.1     2  5</span>
<span class="co">#&gt; 16   4.4     2  6</span>
<span class="co">#&gt; 17   5.5     2  7</span>
<span class="co">#&gt; 18   1.6     2  8</span>
<span class="co">#&gt; 19   4.6     2  9</span>
<span class="co">#&gt; 20   3.4     2 10</span></code></pre>
<p>我们将制造 <code>sleep</code> 数据的宽格式版本；下面我们将看看如何处理长格式和宽格式的数据。</p>
<pre class="sourceCode r"><code class="sourceCode r">sleep_wide &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">ID =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">group1 =</span> sleep<span class="op">$</span>extra[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>], 
  <span class="dt">group2 =</span> sleep<span class="op">$</span>extra[<span class="dv">11</span><span class="op">:</span><span class="dv">20</span>])
sleep_wide
<span class="co">#&gt;    ID group1 group2</span>
<span class="co">#&gt; 1   1    0.7    1.9</span>
<span class="co">#&gt; 2   2   -1.6    0.8</span>
<span class="co">#&gt; 3   3   -0.2    1.1</span>
<span class="co">#&gt; 4   4   -1.2    0.1</span>
<span class="co">#&gt; 5   5   -0.1   -0.1</span>
<span class="co">#&gt; 6   6    3.4    4.4</span>
<span class="co">#&gt; 7   7    3.7    5.5</span>
<span class="co">#&gt; 8   8    0.8    1.6</span>
<span class="co">#&gt; 9   9    0.0    4.6</span>
<span class="co">#&gt; 10 10    2.0    3.4</span></code></pre>
</div>
<div id="-t-" class="section level4">
<h4><span class="header-section-number">7.2.2.2</span> 比较两组：独立双样本 t 检验</h4>
<p>假设有两组独立样本（我们这里忽略ID变量）。</p>
<p><code>t.test()</code> 函数能够操作像 <code>sleep</code> 这样的长格式数据——一列记录测量值，一列指定组别；或者操作两个单独的向量。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Welch t 检验</span>
<span class="kw">t.test</span>(extra <span class="op">~</span><span class="st"> </span>group, sleep)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Welch Two Sample t-test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  extra by group</span>
<span class="co">#&gt; t = -1.9, df = 18, p-value = 0.08</span>
<span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  -3.3655  0.2055</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; mean in group 1 mean in group 2 </span>
<span class="co">#&gt;            0.75            2.33</span>

<span class="co"># 2 个独立的向量</span>
<span class="kw">t.test</span>(sleep_wide<span class="op">$</span>group1, sleep_wide<span class="op">$</span>group2)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Welch Two Sample t-test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  sleep_wide$group1 and sleep_wide$group2</span>
<span class="co">#&gt; t = -1.9, df = 18, p-value = 0.08</span>
<span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  -3.3655  0.2055</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; mean of x mean of y </span>
<span class="co">#&gt;      0.75      2.33</span></code></pre>
<p>默认，t 检验不假设有方差齐性（或称作方差同质）。默认的不是 Student t 检验而是使用了 Welch t 检验。注意 Welch t 检验结果中 <code>df=17.776</code>，这是因为对不同质方差进行了校正。要使用 Student t 检验的话，设置 <code>var.equal=TRUE</code> 。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Student t 检验</span>
<span class="kw">t.test</span>(extra <span class="op">~</span><span class="st"> </span>group, sleep, <span class="dt">var.equal =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Two Sample t-test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  extra by group</span>
<span class="co">#&gt; t = -1.9, df = 18, p-value = 0.08</span>
<span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  -3.3639  0.2039</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; mean in group 1 mean in group 2 </span>
<span class="co">#&gt;            0.75            2.33</span>

<span class="co"># 针对宽数据相同的操作 (2个分离的向量)</span>
<span class="kw">t.test</span>(sleep_wide<span class="op">$</span>group1, sleep_wide<span class="op">$</span>group2, <span class="dt">var.equal =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Two Sample t-test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  sleep_wide$group1 and sleep_wide$group2</span>
<span class="co">#&gt; t = -1.9, df = 18, p-value = 0.08</span>
<span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  -3.3639  0.2039</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; mean of x mean of y </span>
<span class="co">#&gt;      0.75      2.33</span></code></pre>
</div>
<div id="t" class="section level4">
<h4><span class="header-section-number">7.2.2.3</span> 配对样本t检验</h4>
<p>你也可以使用配对样本 t 检验比较配对的数据。数据配对是指你可能有对某种药物治疗前后有观测值或者不同治疗有配对的研究对象。</p>
<p>再次说明，<code>t-test()</code> 函数可以用于有分组变量的数据框或者两个向量。它依赖相对位置来决定配对。如果你使用有分组变量的长格式数据，group 1 的第一行与 group 2 的第一行配对。确保数据排序好并且不存在缺失值是非常重要的；否则配对可以丢弃。这种情况中，我们能通过 <code>group</code> 和 <code>ID</code> 变量进行排序来确保顺序是一样的。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 按 group 和 ID排序</span>
sleep &lt;-<span class="st"> </span>sleep[<span class="kw">order</span>(sleep<span class="op">$</span>group, sleep<span class="op">$</span>ID), ]

<span class="co"># 配对 t-test</span>
<span class="kw">t.test</span>(extra <span class="op">~</span><span class="st"> </span>group, sleep, <span class="dt">paired =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Paired t-test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  extra by group</span>
<span class="co">#&gt; t = -4.1, df = 9, p-value = 0.003</span>
<span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  -2.4599 -0.7001</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; mean of the differences </span>
<span class="co">#&gt;                   -1.58</span>

<span class="co"># 针对宽数据相同的操作 (2个分离的向量)</span>
<span class="kw">t.test</span>(sleep_wide<span class="op">$</span>group1, sleep_wide<span class="op">$</span>group2, <span class="dt">paired =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Paired t-test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  sleep_wide$group1 and sleep_wide$group2</span>
<span class="co">#&gt; t = -4.1, df = 9, p-value = 0.003</span>
<span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  -2.4599 -0.7001</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; mean of the differences </span>
<span class="co">#&gt;                   -1.58</span></code></pre>
<p>配对 t 检验等价于检测是否配对的观察值的总体均值是否为 0 。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">t.test</span>(sleep_wide<span class="op">$</span>group1 <span class="op">-</span><span class="st"> </span>sleep_wide<span class="op">$</span>group2, <span class="dt">mu =</span> <span class="dv">0</span>, <span class="dt">var.equal =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  One Sample t-test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  sleep_wide$group1 - sleep_wide$group2</span>
<span class="co">#&gt; t = -4.1, df = 9, p-value = 0.003</span>
<span class="co">#&gt; alternative hypothesis: true mean is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  -2.4599 -0.7001</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; mean of x </span>
<span class="co">#&gt;     -1.58</span></code></pre>
</div>
<div id="-t-" class="section level4">
<h4><span class="header-section-number">7.2.2.4</span> 与期望的总体均值进行比较：单样本 t 检验</h4>
<p>假设你想要检测是否 <code>extra</code> 列的数据抽取自总体均值为0的总体（这里忽略 <code>group</code> 与 <code>ID</code> 列）。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">t.test</span>(sleep<span class="op">$</span>extra, <span class="dt">mu =</span> <span class="dv">0</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  One Sample t-test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  sleep$extra</span>
<span class="co">#&gt; t = 3.4, df = 19, p-value = 0.003</span>
<span class="co">#&gt; alternative hypothesis: true mean is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  0.5956 2.4844</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; mean of x </span>
<span class="co">#&gt;      1.54</span></code></pre>
</div>
</div>
</div>
<div id="section-7.3" class="section level2">
<h2><span class="header-section-number">7.3</span> 频率检验</h2>
<div id="-45" class="section level3">
<h3><span class="header-section-number">7.3.1</span> 问题</h3>
<p>你有分类数据然后想要检验是否这些数据值的频数分布是否与预期不符，或者是否组间的频数分布有（显著）差异。</p>
</div>
<div id="-44" class="section level3">
<h3><span class="header-section-number">7.3.2</span> 方案</h3>
<p>频数检验通常解决两类问题：</p>
<ol style="list-style-type: decimal">
<li>频数分布与预期或者理论的分布（比如 50% 的 yes，50% 的 no ）符合吗？（拟合优度检验）</li>
<li>两组或多组之间的频率分布有差异吗？（独立检验）</li>
</ol>
<p>通常用于解决这样问题的统计检验方法，分为<strong>精确检验</strong>与<strong>近似检验</strong>两种。</p>
<table>
<thead>
<tr class="header">
<th></th>
<th align="center"><strong>期望分布</strong></th>
<th align="center"><strong>比较组别</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>精确</strong></td>
<td align="center">精确二项检验</td>
<td align="center">Fisher精确检验</td>
</tr>
<tr class="even">
<td><strong>近似</strong></td>
<td align="center">卡方拟合优度</td>
<td align="center">独立卡方检验</td>
</tr>
</tbody>
</table>
<p><strong>注意</strong>：精确二项检验仅能用于有两个水平的单变量。Fisher 精确检验仅能用于二维列联表（比如，当存在一个独立变量和一个非独立变量时它可以使用；但不能用于两个独立变量和一个非独立变量的情况）。</p>
<p>想要检验配对或被试内效应，我们可以使用 McNemar 检验。使用该检验必须满足存在两个水平的独立变量和两个水平的非独立变量。</p>
<p>想要检验有重复测量的两个变量独立性，我们可以使用 Cochran-Mantel-Haenszel 检验。</p>
<p>假设你有下面的数据，其中每一行代表一个记录：</p>
<pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">text =</span> <span class="st">&quot;</span>
<span class="st"> condition result</span>
<span class="st">   control      0</span>
<span class="st">   control      0</span>
<span class="st">   control      0</span>
<span class="st">   control      0</span>
<span class="st"> treatment      1</span>
<span class="st">   control      0</span>
<span class="st">   control      0</span>
<span class="st"> treatment      0</span>
<span class="st"> treatment      1</span>
<span class="st">   control      1</span>
<span class="st"> treatment      1</span>
<span class="st"> treatment      1</span>
<span class="st"> treatment      1</span>
<span class="st"> treatment      1</span>
<span class="st"> treatment      0</span>
<span class="st">   control      0</span>
<span class="st">   control      1</span>
<span class="st">   control      0</span>
<span class="st">   control      1</span>
<span class="st"> treatment      0</span>
<span class="st"> treatment      1</span>
<span class="st"> treatment      0</span>
<span class="st"> treatment      0</span>
<span class="st">   control      0</span>
<span class="st"> treatment      1</span>
<span class="st">   control      0</span>
<span class="st">   control      0</span>
<span class="st"> treatment      1</span>
<span class="st"> treatment      0</span>
<span class="st"> treatment      1</span>
<span class="st">&quot;</span>)</code></pre>
<p>相比于以<strong>记录</strong>的数据框存储，你的数据可能是<strong>计数</strong>的数据框，或者是一个列联表。</p>
<div id="-" class="section level4">
<h4><span class="header-section-number">7.3.2.1</span> 拟合优度检验 （期望频率）</h4>
<div id="section-7.3.2.1.1" class="section level5">
<h5><span class="header-section-number">7.3.2.1.1</span> 卡方检验</h5>
<p>想要检验假设：结果列 result（忽略条件 condition ）中的两个值在总体中几乎相等（50% - 50%）。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 　为result列创建列联表，包含 0 和 1 两个值 　注意，&#39;0&#39;</span>
<span class="co"># 和 &#39;1&#39; 是列名而不是实际的值</span>
ct &lt;-<span class="st"> </span><span class="kw">table</span>(data<span class="op">$</span>result)
ct
<span class="co">#&gt; </span>
<span class="co">#&gt;  0  1 </span>
<span class="co">#&gt; 17 13</span>

<span class="co"># 也可以手动创建表格</span>
ct &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">13</span>), <span class="dt">ncol =</span> <span class="dv">2</span>)
<span class="kw">colnames</span>(ct) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>)

<span class="co"># 执行卡方检验</span>
<span class="kw">chisq.test</span>(ct)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Chi-squared test for given probabilities</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  ct</span>
<span class="co">#&gt; X-squared = 0.53, df = 1, p-value = 0.5</span></code></pre>
<p>想要检验有不同期望频率的样本（比如下面一个 0.75，一个 0.25 ）：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 概率表 —— 和必须为 1</span>
pt &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.75</span>, <span class="fl">0.25</span>)
<span class="kw">chisq.test</span>(ct, <span class="dt">p =</span> pt)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Chi-squared test for given probabilities</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  ct</span>
<span class="co">#&gt; X-squared = 5.4, df = 1, p-value = 0.02</span></code></pre>
<p>如果你想要从检验结果中提取信息，可以将结果保存进一个变量，然后用 <code>str()</code> 函数查看变量信息，接着把你想要的部分取出来。例如：</p>
<pre class="sourceCode r"><code class="sourceCode r">chi_res &lt;-<span class="st"> </span><span class="kw">chisq.test</span>(ct, <span class="dt">p =</span> pt)
<span class="co"># 查看所有组分</span>
<span class="kw">str</span>(chi_res)
<span class="co">#&gt; List of 9</span>
<span class="co">#&gt;  $ statistic: Named num 5.38</span>
<span class="co">#&gt;   ..- attr(*, &quot;names&quot;)= chr &quot;X-squared&quot;</span>
<span class="co">#&gt;  $ parameter: Named num 1</span>
<span class="co">#&gt;   ..- attr(*, &quot;names&quot;)= chr &quot;df&quot;</span>
<span class="co">#&gt;  $ p.value  : num 0.0204</span>
<span class="co">#&gt;  $ method   : chr &quot;Chi-squared test for given probabilities&quot;</span>
<span class="co">#&gt;  $ data.name: chr &quot;ct&quot;</span>
<span class="co">#&gt;  $ observed : num [1:2] 17 13</span>
<span class="co">#&gt;  $ expected : num [1:2] 22.5 7.5</span>
<span class="co">#&gt;  $ residuals: num [1:2] -1.16 2.01</span>
<span class="co">#&gt;  $ stdres   : num [1:2] -2.32 2.32</span>
<span class="co">#&gt;  - attr(*, &quot;class&quot;)= chr &quot;htest&quot;</span>

<span class="co"># 获取卡方值</span>
chi_res<span class="op">$</span>statistic
<span class="co">#&gt; X-squared </span>
<span class="co">#&gt;     5.378</span>

<span class="co"># 获取p值</span>
chi_res<span class="op">$</span>p.value
<span class="co">#&gt; [1] 0.02039</span></code></pre>
</div>
<div id="section-7.3.2.1.2" class="section level5">
<h5><span class="header-section-number">7.3.2.1.2</span> 精确二项检验</h5>
<p>精确二项检验仅能用于存在两个值的单变量数据。</p>
<pre class="sourceCode r"><code class="sourceCode r">ct &lt;-<span class="st"> </span><span class="kw">table</span>(data<span class="op">$</span>result)
ct
<span class="co">#&gt; </span>
<span class="co">#&gt;  0  1 </span>
<span class="co">#&gt; 17 13</span>

<span class="kw">binom.test</span>(ct, <span class="dt">p =</span> <span class="fl">0.5</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Exact binomial test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  ct</span>
<span class="co">#&gt; number of successes = 17, number of trials = 30,</span>
<span class="co">#&gt; p-value = 0.6</span>
<span class="co">#&gt; alternative hypothesis: true probability of success is not equal to 0.5</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  0.3743 0.7454</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; probability of success </span>
<span class="co">#&gt;                 0.5667</span>

<span class="co"># 使用 75% 的期望概率——注意 1 在第二列，所以只需要令 p</span>
<span class="co"># = 0.25</span>
<span class="kw">binom.test</span>(ct, <span class="dt">p =</span> <span class="fl">0.25</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Exact binomial test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  ct</span>
<span class="co">#&gt; number of successes = 17, number of trials = 30,</span>
<span class="co">#&gt; p-value = 2e-04</span>
<span class="co">#&gt; alternative hypothesis: true probability of success is not equal to 0.25</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  0.3743 0.7454</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; probability of success </span>
<span class="co">#&gt;                 0.5667</span></code></pre>
<p>如果你想要从检验结果中提取信息，可以将结果保存进一个变量，然后用 <code>str()</code> 函数查看变量信息，接着把你想要的部分取出来。例如：</p>
<pre class="sourceCode r"><code class="sourceCode r">bin_res &lt;-<span class="st"> </span><span class="kw">binom.test</span>(ct, <span class="dt">p =</span> <span class="fl">0.25</span>)
<span class="co"># 字符串格式化后查看信息</span>
<span class="kw">str</span>(bin_res)
<span class="co">#&gt; List of 9</span>
<span class="co">#&gt;  $ statistic  : Named num 17</span>
<span class="co">#&gt;   ..- attr(*, &quot;names&quot;)= chr &quot;number of successes&quot;</span>
<span class="co">#&gt;  $ parameter  : Named num 30</span>
<span class="co">#&gt;   ..- attr(*, &quot;names&quot;)= chr &quot;number of trials&quot;</span>
<span class="co">#&gt;  $ p.value    : Named num 0.000216</span>
<span class="co">#&gt;   ..- attr(*, &quot;names&quot;)= chr &quot;0&quot;</span>
<span class="co">#&gt;  $ conf.int   : num [1:2] 0.374 0.745</span>
<span class="co">#&gt;   ..- attr(*, &quot;conf.level&quot;)= num 0.95</span>
<span class="co">#&gt;  $ estimate   : Named num 0.567</span>
<span class="co">#&gt;   ..- attr(*, &quot;names&quot;)= chr &quot;probability of success&quot;</span>
<span class="co">#&gt;  $ null.value : Named num 0.25</span>
<span class="co">#&gt;   ..- attr(*, &quot;names&quot;)= chr &quot;probability of success&quot;</span>
<span class="co">#&gt;  $ alternative: chr &quot;two.sided&quot;</span>
<span class="co">#&gt;  $ method     : chr &quot;Exact binomial test&quot;</span>
<span class="co">#&gt;  $ data.name  : chr &quot;ct&quot;</span>
<span class="co">#&gt;  - attr(*, &quot;class&quot;)= chr &quot;htest&quot;</span>

<span class="co"># 获取 p 值</span>
bin_res<span class="op">$</span>p.value
<span class="co">#&gt;         0 </span>
<span class="co">#&gt; 0.0002157</span>

<span class="co"># 获取 95% 置信区间</span>
bin_res<span class="op">$</span>conf.int
<span class="co">#&gt; [1] 0.3743 0.7454</span>
<span class="co">#&gt; attr(,&quot;conf.level&quot;)</span>
<span class="co">#&gt; [1] 0.95</span></code></pre>
</div>
</div>
<div id="section-7.3.2.2" class="section level4">
<h4><span class="header-section-number">7.3.2.2</span> 独立检验（比较组间）</h4>
<div id="-1" class="section level5">
<h5><span class="header-section-number">7.3.2.2.1</span> 卡方检验</h5>
<p>想要检验控制和处理组结果的频数差异，使用二维列联表。</p>
<pre class="sourceCode r"><code class="sourceCode r">ct &lt;-<span class="st"> </span><span class="kw">table</span>(data<span class="op">$</span>condition, data<span class="op">$</span>result)
ct
<span class="co">#&gt;            </span>
<span class="co">#&gt;              0  1</span>
<span class="co">#&gt;   control   11  3</span>
<span class="co">#&gt;   treatment  6 10</span>

<span class="kw">chisq.test</span>(ct)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Pearson&#39;s Chi-squared test with Yates&#39;</span>
<span class="co">#&gt;  continuity correction</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  ct</span>
<span class="co">#&gt; X-squared = 3.6, df = 1, p-value = 0.06</span>

<span class="kw">chisq.test</span>(ct, <span class="dt">correct =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Pearson&#39;s Chi-squared test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  ct</span>
<span class="co">#&gt; X-squared = 5.1, df = 1, p-value = 0.02</span></code></pre>
</div>
<div id="fisher-" class="section level5">
<h5><span class="header-section-number">7.3.2.2.2</span> Fisher 精确检验</h5>
<p>对于小样本而言 Fisher 精确检验更为适合。小样本的 2x2 列表非常典型，样本更多、更复杂的列表计算强度非常大。当然，用R进行比较复杂的计算也是没有太大问题的。</p>
<pre class="sourceCode r"><code class="sourceCode r">ct &lt;-<span class="st"> </span><span class="kw">table</span>(data<span class="op">$</span>condition, data<span class="op">$</span>result)
ct
<span class="co">#&gt;            </span>
<span class="co">#&gt;              0  1</span>
<span class="co">#&gt;   control   11  3</span>
<span class="co">#&gt;   treatment  6 10</span>

<span class="kw">fisher.test</span>(ct)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Fisher&#39;s Exact Test for Count Data</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  ct</span>
<span class="co">#&gt; p-value = 0.03</span>
<span class="co">#&gt; alternative hypothesis: true odds ratio is not equal to 1</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;   0.9669 45.5550</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; odds ratio </span>
<span class="co">#&gt;      5.714</span></code></pre>
</div>
<div id="cochran-mantel-haenszel-" class="section level5">
<h5><span class="header-section-number">7.3.2.2.3</span> Cochran-Mantel-Haenszel 检验</h5>
<p>Cochran-Mantel-Haenszel 检验 （或称为 Mantel-Haenszel 检验)）用于检验重复测量两离散变量的独立性。通常使用 2x2xK 列表表示，K是测量条件的次数。比如你想要指导是否一个处理（C vs. D）是否影响了恢复的概率（yes or no）。假设该处理一天监控测量三次——早上、中午和晚上，而你想要你的检验能够控制它。那么你可以使用 CMH 检验对 2x2x3 列联表进行操作，第三个变量是你想要控制的变量。</p>
<p>R 中的 CMH 检验可以处理比 2x2xK 维度更高的数据，例如你处理 3x3xK 列联表。</p>
<p>在接下来的例子里有三个变量：Location、Allele 和 Habitat。问题是——当控制 location 变量时，Allel（94 或非 94）和 Habitat（marine 或 estuarine）两个变量是否独立。</p>
<pre class="sourceCode r"><code class="sourceCode r">fish &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">text =</span> <span class="st">&quot;</span>
<span class="st">  Location Allele   Habitat Count</span>
<span class="st"> tillamook     94    marine    56</span>
<span class="st"> tillamook     94 estuarine    69</span>
<span class="st"> tillamook non-94    marine    40</span>
<span class="st"> tillamook non-94 estuarine    77</span>
<span class="st">   yaquina     94    marine    61</span>
<span class="st">   yaquina     94 estuarine   257</span>
<span class="st">   yaquina non-94    marine    57</span>
<span class="st">   yaquina non-94 estuarine   301</span>
<span class="st">   alsea     94    marine    73</span>
<span class="st">   alsea     94 estuarine    65</span>
<span class="st">   alsea non-94    marine    71</span>
<span class="st">   alsea non-94 estuarine    79</span>
<span class="st">  umpqua     94    marine    71</span>
<span class="st">  umpqua     94 estuarine    48</span>
<span class="st">  umpqua non-94    marine    55</span>
<span class="st">  umpqua non-94 estuarine    48</span>
<span class="st">&quot;</span>)</code></pre>
<p>注意上面的数据是<strong>计数</strong>的数据框，而不是像之前的例子是<strong>记录</strong>的数据框。这里我们使用 <code>xtabs()</code> 函数将它转换为列联表。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 制造一个三维的列联表，最后一个变量时要控制的 Location</span>
<span class="co"># 变量</span>
ct &lt;-<span class="st"> </span><span class="kw">xtabs</span>(Count <span class="op">~</span><span class="st"> </span>Allele <span class="op">+</span><span class="st"> </span>Habitat <span class="op">+</span><span class="st"> </span>Location, <span class="dt">data =</span> fish)
ct
<span class="co">#&gt; , , Location = alsea</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;         Habitat</span>
<span class="co">#&gt; Allele   estuarine marine</span>
<span class="co">#&gt;   94            65     73</span>
<span class="co">#&gt;   non-94        79     71</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , Location = tillamook</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;         Habitat</span>
<span class="co">#&gt; Allele   estuarine marine</span>
<span class="co">#&gt;   94            69     56</span>
<span class="co">#&gt;   non-94        77     40</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , Location = umpqua</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;         Habitat</span>
<span class="co">#&gt; Allele   estuarine marine</span>
<span class="co">#&gt;   94            48     71</span>
<span class="co">#&gt;   non-94        48     55</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , Location = yaquina</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;         Habitat</span>
<span class="co">#&gt; Allele   estuarine marine</span>
<span class="co">#&gt;   94           257     61</span>
<span class="co">#&gt;   non-94       301     57</span>

<span class="co"># 以扁平化显示</span>
<span class="kw">ftable</span>(ct)
<span class="co">#&gt;                  Location alsea tillamook umpqua yaquina</span>
<span class="co">#&gt; Allele Habitat                                          </span>
<span class="co">#&gt; 94     estuarine             65        69     48     257</span>
<span class="co">#&gt;        marine                73        56     71      61</span>
<span class="co">#&gt; non-94 estuarine             79        77     48     301</span>
<span class="co">#&gt;        marine                71        40     55      57</span>

<span class="co"># 按指定方式进行变量输出</span>
<span class="kw">ftable</span>(ct, <span class="dt">row.vars =</span> <span class="kw">c</span>(<span class="st">&quot;Location&quot;</span>, <span class="st">&quot;Allele&quot;</span>), <span class="dt">col.vars =</span> <span class="st">&quot;Habitat&quot;</span>)
<span class="co">#&gt;                  Habitat estuarine marine</span>
<span class="co">#&gt; Location  Allele                         </span>
<span class="co">#&gt; alsea     94                    65     73</span>
<span class="co">#&gt;           non-94                79     71</span>
<span class="co">#&gt; tillamook 94                    69     56</span>
<span class="co">#&gt;           non-94                77     40</span>
<span class="co">#&gt; umpqua    94                    48     71</span>
<span class="co">#&gt;           non-94                48     55</span>
<span class="co">#&gt; yaquina   94                   257     61</span>
<span class="co">#&gt;           non-94               301     57</span>

<span class="kw">mantelhaen.test</span>(ct)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Mantel-Haenszel chi-squared test with</span>
<span class="co">#&gt;  continuity correction</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  ct</span>
<span class="co">#&gt; Mantel-Haenszel X-squared = 5, df = 1, p-value =</span>
<span class="co">#&gt; 0.02</span>
<span class="co">#&gt; alternative hypothesis: true common odds ratio is not equal to 1</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  0.6006 0.9593</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; common odds ratio </span>
<span class="co">#&gt;             0.759</span></code></pre>
<p>根据检验结果，当控制 Location 变量时 Allele 与 Habitat 变量存在相关（p = 0.025）。</p>
<p>注意列联表的前两个维度处理是一致的，所以前后顺序变化都不会影响结果。而最后一个变量变化会导致结果的不同，下面是一个实例。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 下面两个看似不同的列联表，实际检验结果相同</span>
ct<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">xtabs</span>(Count <span class="op">~</span><span class="st"> </span>Habitat <span class="op">+</span><span class="st"> </span>Allele <span class="op">+</span><span class="st"> </span>Location, <span class="dt">data =</span> fish)
ct<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">xtabs</span>(Count <span class="op">~</span><span class="st"> </span>Allele <span class="op">+</span><span class="st"> </span>Habitat <span class="op">+</span><span class="st"> </span>Location, <span class="dt">data =</span> fish)
<span class="kw">mantelhaen.test</span>(ct<span class="fl">.1</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Mantel-Haenszel chi-squared test with</span>
<span class="co">#&gt;  continuity correction</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  ct.1</span>
<span class="co">#&gt; Mantel-Haenszel X-squared = 5, df = 1, p-value =</span>
<span class="co">#&gt; 0.02</span>
<span class="co">#&gt; alternative hypothesis: true common odds ratio is not equal to 1</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  0.6006 0.9593</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; common odds ratio </span>
<span class="co">#&gt;             0.759</span>

<span class="kw">mantelhaen.test</span>(ct<span class="fl">.2</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Mantel-Haenszel chi-squared test with</span>
<span class="co">#&gt;  continuity correction</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  ct.2</span>
<span class="co">#&gt; Mantel-Haenszel X-squared = 5, df = 1, p-value =</span>
<span class="co">#&gt; 0.02</span>
<span class="co">#&gt; alternative hypothesis: true common odds ratio is not equal to 1</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  0.6006 0.9593</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; common odds ratio </span>
<span class="co">#&gt;             0.759</span>

<span class="co"># 把 Allele 放到最后，结果不同了</span>
ct<span class="fl">.3</span> &lt;-<span class="st"> </span><span class="kw">xtabs</span>(Count <span class="op">~</span><span class="st"> </span>Location <span class="op">+</span><span class="st"> </span>Habitat <span class="op">+</span><span class="st"> </span>Allele, <span class="dt">data =</span> fish)
ct<span class="fl">.4</span> &lt;-<span class="st"> </span><span class="kw">xtabs</span>(Count <span class="op">~</span><span class="st"> </span>Habitat <span class="op">+</span><span class="st"> </span>Location <span class="op">+</span><span class="st"> </span>Allele, <span class="dt">data =</span> fish)
<span class="kw">mantelhaen.test</span>(ct<span class="fl">.3</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Cochran-Mantel-Haenszel test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  ct.3</span>
<span class="co">#&gt; Cochran-Mantel-Haenszel M^2 = 168, df = 3,</span>
<span class="co">#&gt; p-value &lt;2e-16</span>

<span class="kw">mantelhaen.test</span>(ct<span class="fl">.4</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Cochran-Mantel-Haenszel test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  ct.4</span>
<span class="co">#&gt; Cochran-Mantel-Haenszel M^2 = 168, df = 3,</span>
<span class="co">#&gt; p-value &lt;2e-16</span>

<span class="co"># 把 Habitat 放最后，结果也不同</span>
ct<span class="fl">.5</span> &lt;-<span class="st"> </span><span class="kw">xtabs</span>(Count <span class="op">~</span><span class="st"> </span>Allele <span class="op">+</span><span class="st"> </span>Location <span class="op">+</span><span class="st"> </span>Habitat, <span class="dt">data =</span> fish)
ct<span class="fl">.6</span> &lt;-<span class="st"> </span><span class="kw">xtabs</span>(Count <span class="op">~</span><span class="st"> </span>Location <span class="op">+</span><span class="st"> </span>Allele <span class="op">+</span><span class="st"> </span>Habitat, <span class="dt">data =</span> fish)
<span class="kw">mantelhaen.test</span>(ct<span class="fl">.5</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Cochran-Mantel-Haenszel test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  ct.5</span>
<span class="co">#&gt; Cochran-Mantel-Haenszel M^2 = 2, df = 3, p-value</span>
<span class="co">#&gt; = 0.6</span>

<span class="kw">mantelhaen.test</span>(ct<span class="fl">.6</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Cochran-Mantel-Haenszel test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  ct.6</span>
<span class="co">#&gt; Cochran-Mantel-Haenszel M^2 = 2, df = 3, p-value</span>
<span class="co">#&gt; = 0.6</span></code></pre>
</div>
</div>
<div id="mcnemar-" class="section level4">
<h4><span class="header-section-number">7.3.2.3</span> McNemar 检验</h4>
<p>McNemar 检验概念上是频数数据的一个被试内检验。例如，假设你想要检验是否一个处理增加了一个人对某个问题反应「yes」的概率，而且你只有每个人处理前和处理后的数据。标准的卡方检验将不合适，因为它假设了组别是独立的。取而代之，我们可以使用 McNemar 检验。该检验仅适用于当存在一个独立变量的两次测量时。用于 McNemar 的列联表与用于卡方检验的非常相似，但结构上是不同的。</p>
<p>假设你有下面的数据。每个对象有处理前和后的反应。</p>
<pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">text =</span> <span class="st">&quot;</span>
<span class="st"> subject time result</span>
<span class="st">     1  pre      0</span>
<span class="st">     1 post      1</span>
<span class="st">     2  pre      1</span>
<span class="st">     2 post      1</span>
<span class="st">     3  pre      0</span>
<span class="st">     3 post      1</span>
<span class="st">     4  pre      1</span>
<span class="st">     4 post      0</span>
<span class="st">     5  pre      1</span>
<span class="st">     5 post      1</span>
<span class="st">     6  pre      0</span>
<span class="st">     6 post      1</span>
<span class="st">     7  pre      0</span>
<span class="st">     7 post      1</span>
<span class="st">     8  pre      0</span>
<span class="st">     8 post      1</span>
<span class="st">     9  pre      0</span>
<span class="st">     9 post      1</span>
<span class="st">    10  pre      1</span>
<span class="st">    10 post      1</span>
<span class="st">    11  pre      0</span>
<span class="st">    11 post      0</span>
<span class="st">    12  pre      1</span>
<span class="st">    12 post      1</span>
<span class="st">    13  pre      0</span>
<span class="st">    13 post      1</span>
<span class="st">    14  pre      0</span>
<span class="st">    14 post      0</span>
<span class="st">    15  pre      0</span>
<span class="st">    15 post      1</span>
<span class="st">&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyr)
data_wide &lt;-<span class="st"> </span><span class="kw">spread</span>(data, time, result)
data_wide
<span class="co">#&gt;    subject post pre</span>
<span class="co">#&gt; 1        1    1   0</span>
<span class="co">#&gt; 2        2    1   1</span>
<span class="co">#&gt; 3        3    1   0</span>
<span class="co">#&gt; 4        4    0   1</span>
<span class="co">#&gt; 5        5    1   1</span>
<span class="co">#&gt; 6        6    1   0</span>
<span class="co">#&gt; 7        7    1   0</span>
<span class="co">#&gt; 8        8    1   0</span>
<span class="co">#&gt; 9        9    1   0</span>
<span class="co">#&gt; 10      10    1   1</span>
<span class="co">#&gt; 11      11    0   0</span>
<span class="co">#&gt; 12      12    1   1</span>
<span class="co">#&gt; 13      13    1   0</span>
<span class="co">#&gt; 14      14    0   0</span>
<span class="co">#&gt; 15      15    1   0</span></code></pre>
<p>接下来从数据框的 <code>pre</code> 和 <code>post</code> 列生成列联表：</p>
<pre class="sourceCode r"><code class="sourceCode r">ct &lt;-<span class="st"> </span><span class="kw">table</span>(data_wide[, <span class="kw">c</span>(<span class="st">&quot;pre&quot;</span>, <span class="st">&quot;post&quot;</span>)])
ct
<span class="co">#&gt;    post</span>
<span class="co">#&gt; pre 0 1</span>
<span class="co">#&gt;   0 2 8</span>
<span class="co">#&gt;   1 1 4</span>

<span class="co"># 下面是用于标准卡方检验的列联表，注意差别</span>
<span class="kw">table</span>(data[, <span class="kw">c</span>(<span class="st">&quot;time&quot;</span>, <span class="st">&quot;result&quot;</span>)])
<span class="co">#&gt;       result</span>
<span class="co">#&gt; time    0  1</span>
<span class="co">#&gt;   post  3 12</span>
<span class="co">#&gt;   pre  10  5</span></code></pre>
<p>执行检验：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mcnemar.test</span>(ct)
<span class="co">#&gt; </span>
<span class="co">#&gt;  McNemar&#39;s Chi-squared test with continuity</span>
<span class="co">#&gt;  correction</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  ct</span>
<span class="co">#&gt; McNemar&#39;s chi-squared = 4, df = 1, p-value =</span>
<span class="co">#&gt; 0.05</span></code></pre>
<p>对于小样本，它会使用连续校正。我们可以使用<strong>精确</strong>校正的 McNemar 检验替换这种校正方式，前者更加的精确，可通过 <code>exact2x2</code> 包获取。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(exact2x2)
<span class="co">#&gt; Loading required package: exactci</span>
<span class="co">#&gt; Loading required package: ssanv</span>

<span class="kw">mcnemar.exact</span>(ct)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Exact McNemar test (with central confidence</span>
<span class="co">#&gt;  intervals)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  ct</span>
<span class="co">#&gt; b = 8, c = 1, p-value = 0.04</span>
<span class="co">#&gt; alternative hypothesis: true odds ratio is not equal to 1</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;    1.073 354.981</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; odds ratio </span>
<span class="co">#&gt;          8</span></code></pre>
</div>
</div>
</div>
<div id="anova" class="section level2">
<h2><span class="header-section-number">7.4</span> ANOVA</h2>
<div id="-46" class="section level3">
<h3><span class="header-section-number">7.4.1</span> 问题</h3>
<p>你想要使用 ANOVA 比较多组之间的差异。</p>
</div>
<div id="-45" class="section level3">
<h3><span class="header-section-number">7.4.2</span> 方案</h3>
<p>假设这是你的数据：</p>
<pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">text =</span> <span class="st">&quot;</span>
<span class="st"> subject sex   age before after</span>
<span class="st">     1   F   old    9.5   7.1</span>
<span class="st">     2   M   old   10.3  11.0</span>
<span class="st">     3   M   old    7.5   5.8</span>
<span class="st">     4   F   old   12.4   8.8</span>
<span class="st">     5   M   old   10.2   8.6</span>
<span class="st">     6   M   old   11.0   8.0</span>
<span class="st">     7   M young    9.1   3.0</span>
<span class="st">     8   F young    7.9   5.2</span>
<span class="st">     9   F   old    6.6   3.4</span>
<span class="st">    10   M young    7.7   4.0</span>
<span class="st">    11   M young    9.4   5.3</span>
<span class="st">    12   M   old   11.6  11.3</span>
<span class="st">    13   M young    9.9   4.6</span>
<span class="st">    14   F young    8.6   6.4</span>
<span class="st">    15   F young   14.3  13.5</span>
<span class="st">    16   F   old    9.2   4.7</span>
<span class="st">    17   M young    9.8   5.1</span>
<span class="st">    18   F   old    9.9   7.3</span>
<span class="st">    19   F young   13.0   9.5</span>
<span class="st">    20   M young   10.2   5.4</span>
<span class="st">    21   M young    9.0   3.7</span>
<span class="st">    22   F young    7.9   6.2</span>
<span class="st">    23   M   old   10.1  10.0</span>
<span class="st">    24   M young    9.0   1.7</span>
<span class="st">    25   M young    8.6   2.9</span>
<span class="st">    26   M young    9.4   3.2</span>
<span class="st">    27   M young    9.7   4.7</span>
<span class="st">    28   M young    9.3   4.9</span>
<span class="st">    29   F young   10.7   9.8</span>
<span class="st">    30   M   old    9.3   9.4</span>
<span class="st">&quot;</span>)

<span class="co"># 确保 subject</span>
<span class="co"># 列是一个因子变量，这样不会当作连续变量对待</span>
data<span class="op">$</span>subject &lt;-<span class="st"> </span><span class="kw">factor</span>(data<span class="op">$</span>subject)</code></pre>
<div id="-anova-" class="section level4">
<h4><span class="header-section-number">7.4.2.1</span> 单因素 ANOVA 分析</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 单因素： 独立变量: sex 依赖变量: before</span>
aov1 &lt;-<span class="st"> </span><span class="kw">aov</span>(before <span class="op">~</span><span class="st"> </span>sex, <span class="dt">data =</span> data)
<span class="kw">summary</span>(aov1)
<span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)</span>
<span class="co">#&gt; sex          1    1.5    1.53    0.57   0.46</span>
<span class="co">#&gt; Residuals   28   74.7    2.67</span>

<span class="co"># 显示均值</span>
<span class="kw">model.tables</span>(aov1, <span class="st">&quot;means&quot;</span>)
<span class="co">#&gt; Tables of means</span>
<span class="co">#&gt; Grand mean</span>
<span class="co">#&gt;       </span>
<span class="co">#&gt; 9.703 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  sex </span>
<span class="co">#&gt;      F      M</span>
<span class="co">#&gt;     10  9.532</span>
<span class="co">#&gt; rep 11 19.000</span></code></pre>
</div>
<div id="-anova-" class="section level4">
<h4><span class="header-section-number">7.4.2.2</span> 双因素 ANOVA 分析</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 2x2: 独立变量: sex 独立变量: age 依赖变量: after</span>
<span class="co"># 下面两种调用方式等价：</span>
aov2 &lt;-<span class="st"> </span><span class="kw">aov</span>(after <span class="op">~</span><span class="st"> </span>sex <span class="op">*</span><span class="st"> </span>age, <span class="dt">data =</span> data)
aov2 &lt;-<span class="st"> </span><span class="kw">aov</span>(after <span class="op">~</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>sex<span class="op">:</span>age, <span class="dt">data =</span> data)
<span class="kw">summary</span>(aov2)
<span class="co">#&gt;             Df Sum Sq Mean Sq F value  Pr(&gt;F)    </span>
<span class="co">#&gt; sex          1   16.1    16.1    4.04  0.0550 .  </span>
<span class="co">#&gt; age          1   39.0    39.0    9.79  0.0043 ** </span>
<span class="co">#&gt; sex:age      1   89.6    89.6   22.51 6.6e-05 ***</span>
<span class="co">#&gt; Residuals   26  103.5     4.0                    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  </span>
<span class="co">#&gt; 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>

<span class="co"># 显示均值</span>
<span class="kw">model.tables</span>(aov2, <span class="st">&quot;means&quot;</span>)
<span class="co">#&gt; Tables of means</span>
<span class="co">#&gt; Grand mean</span>
<span class="co">#&gt;       </span>
<span class="co">#&gt; 6.483 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  sex </span>
<span class="co">#&gt;          F      M</span>
<span class="co">#&gt;      7.445  5.926</span>
<span class="co">#&gt; rep 11.000 19.000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  age </span>
<span class="co">#&gt;        old  young</span>
<span class="co">#&gt;      7.874  5.556</span>
<span class="co">#&gt; rep 12.000 18.000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  sex:age </span>
<span class="co">#&gt;      age</span>
<span class="co">#&gt; sex   old    young </span>
<span class="co">#&gt;   F    6.260  8.433</span>
<span class="co">#&gt;   rep  5.000  6.000</span>
<span class="co">#&gt;   M    9.157  4.042</span>
<span class="co">#&gt;   rep  7.000 12.000</span></code></pre>
</div>
<div id="tukey-hsd-post-hoc-" class="section level4">
<h4><span class="header-section-number">7.4.2.3</span> Tukey HSD post-hoc 检验</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">TukeyHSD</span>(aov2)
<span class="co">#&gt;   Tukey multiple comparisons of means</span>
<span class="co">#&gt;     95% family-wise confidence level</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fit: aov(formula = after ~ sex + age + sex:age, data = data)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $sex</span>
<span class="co">#&gt;       diff    lwr     upr p adj</span>
<span class="co">#&gt; M-F -1.519 -3.073 0.03475 0.055</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $age</span>
<span class="co">#&gt;             diff    lwr     upr  p adj</span>
<span class="co">#&gt; young-old -2.318 -3.846 -0.7893 0.0044</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $`sex:age`</span>
<span class="co">#&gt;                    diff    lwr     upr  p adj</span>
<span class="co">#&gt; M:old-F:old      2.8971 -0.308  6.1022 0.0870</span>
<span class="co">#&gt; F:young-F:old    2.1733 -1.141  5.4878 0.2966</span>
<span class="co">#&gt; M:young-F:old   -2.2183 -5.132  0.6953 0.1833</span>
<span class="co">#&gt; F:young-M:old   -0.7238 -3.769  2.3215 0.9139</span>
<span class="co">#&gt; M:young-M:old   -5.1155 -7.719 -2.5122 0.0001</span>
<span class="co">#&gt; M:young-F:young -4.3917 -7.129 -1.6548 0.0009</span></code></pre>
</div>
</div>
<div id="-anovas" class="section level3">
<h3><span class="header-section-number">7.4.3</span> 有受试内变量的 ANOVAs</h3>
<p>对于有受试内变量的 ANOVA 分析，数据必须满足为长格式。上面提到的数据都是宽格式，所以我们需要先转换数据格式（参见<a href="section-6.html#section-6.17">长宽格式互相转换</a>）。</p>
<p>同样地，有受试内变量的 ANOVA 分析需要一个识别列。当前数据里是 <code>subject</code> 列。<strong>识别变量必须是一个因子</strong>，如果是数值类型，函数会解析错误导致不能正常工作。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyr)

<span class="co"># 原始数据 subject sex age before after 1 F old 9.5 7.1</span>
<span class="co"># 2 M old 10.3 11.0 3 M old 7.5 5.8</span>

<span class="co"># 转换为长格式</span>
data_long &lt;-<span class="st"> </span><span class="kw">gather</span>(data, time, value, before<span class="op">:</span>after)
<span class="co"># Look at first few rows</span>
<span class="kw">head</span>(data_long)
<span class="co">#&gt;   subject sex age   time value</span>
<span class="co">#&gt; 1       1   F old before   9.5</span>
<span class="co">#&gt; 2       2   M old before  10.3</span>
<span class="co">#&gt; 3       3   M old before   7.5</span>
<span class="co">#&gt; 4       4   F old before  12.4</span>
<span class="co">#&gt; 5       5   M old before  10.2</span>
<span class="co">#&gt; 6       6   M old before  11.0</span>

<span class="co"># 确保subject列是一个因子</span>
data_long<span class="op">$</span>subject &lt;-<span class="st"> </span><span class="kw">factor</span>(data_long<span class="op">$</span>subject)</code></pre>
<div id="-anova" class="section level4">
<h4><span class="header-section-number">7.4.3.1</span> 单因素被试内 ANOVA</h4>
<p>首先，像上面展示的一样将数据从宽格式转换到长格式并确保 <code>subject</code> 列是因子变量。如果 <code>subject</code> 是数值向量，而不是因子，结果将会出错。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 独立变量 (被试内): time 依赖变量: value</span>
aov_time &lt;-<span class="st"> </span><span class="kw">aov</span>(value <span class="op">~</span><span class="st"> </span>time <span class="op">+</span><span class="st"> </span><span class="kw">Error</span>(subject<span class="op">/</span>time), <span class="dt">data =</span> data_long)
<span class="kw">summary</span>(aov_time)
<span class="co">#&gt; </span>
<span class="co">#&gt; Error: subject</span>
<span class="co">#&gt;           Df Sum Sq Mean Sq F value Pr(&gt;F)</span>
<span class="co">#&gt; Residuals 29    261    9.01               </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Error: subject:time</span>
<span class="co">#&gt;           Df Sum Sq Mean Sq F value  Pr(&gt;F)    </span>
<span class="co">#&gt; time       1  155.5   155.5    71.4 2.6e-09 ***</span>
<span class="co">#&gt; Residuals 29   63.1     2.2                    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  </span>
<span class="co">#&gt; 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>

<span class="co"># 因为一些原因，下面的代码不工作</span>
<span class="kw">model.tables</span>(aov_time, <span class="st">&quot;means&quot;</span>)
<span class="co">#&gt; Tables of means</span>
<span class="co">#&gt; Grand mean</span>
<span class="co">#&gt;       </span>
<span class="co">#&gt; 8.093 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  time </span>
<span class="co">#&gt; time</span>
<span class="co">#&gt;  after before </span>
<span class="co">#&gt;  6.483  9.703</span></code></pre>
</div>
<div id="-anova" class="section level4">
<h4><span class="header-section-number">7.4.3.2</span> 混合设计 ANOVA</h4>
<p>首先，像上面展示的一样将数据从宽格式转换到长格式并确保 <code>subject</code> 列是因子变量。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 2x2 mixed: 独立变量（被试间） : age 独立变量（被试内）</span>
<span class="co"># : time 依赖变量: value</span>
aov_age_time &lt;-<span class="st"> </span><span class="kw">aov</span>(value <span class="op">~</span><span class="st"> </span>age <span class="op">*</span><span class="st"> </span>time <span class="op">+</span><span class="st"> </span><span class="kw">Error</span>(subject<span class="op">/</span>time), 
  <span class="dt">data =</span> data_long)
<span class="kw">summary</span>(aov_age_time)
<span class="co">#&gt; </span>
<span class="co">#&gt; Error: subject</span>
<span class="co">#&gt;           Df Sum Sq Mean Sq F value Pr(&gt;F)</span>
<span class="co">#&gt; age        1   24.4   24.44    2.89    0.1</span>
<span class="co">#&gt; Residuals 28  236.8    8.46               </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Error: subject:time</span>
<span class="co">#&gt;           Df Sum Sq Mean Sq F value  Pr(&gt;F)    </span>
<span class="co">#&gt; time       1  155.5   155.5    98.1 1.2e-10 ***</span>
<span class="co">#&gt; age:time   1   18.8    18.8    11.8  0.0018 ** </span>
<span class="co">#&gt; Residuals 28   44.4     1.6                    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  </span>
<span class="co">#&gt; 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>

<span class="co"># 因为数据不平衡，下面代码不会工作</span>
<span class="kw">model.tables</span>(aov_age_time, <span class="st">&quot;means&quot;</span>)
<span class="co">#&gt; Tables of means</span>
<span class="co">#&gt; Grand mean</span>
<span class="co">#&gt;       </span>
<span class="co">#&gt; 8.093 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  age </span>
<span class="co">#&gt;        old  young</span>
<span class="co">#&gt;      8.875  7.572</span>
<span class="co">#&gt; rep 24.000 36.000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  time </span>
<span class="co">#&gt;      after before</span>
<span class="co">#&gt;      6.483  9.703</span>
<span class="co">#&gt; rep 30.000 30.000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  age:time </span>
<span class="co">#&gt;        time</span>
<span class="co">#&gt; age     after  before</span>
<span class="co">#&gt;   old    7.950  9.800</span>
<span class="co">#&gt;   rep   12.000 12.000</span>
<span class="co">#&gt;   young  5.506  9.639</span>
<span class="co">#&gt;   rep   18.000 18.000</span></code></pre>
</div>
<div id="-anova" class="section level4">
<h4><span class="header-section-number">7.4.3.3</span> 更多被试内变量的 ANOVA</h4>
<p>下面这些例子使用的不是上面的数据，但可以解释怎么进行相应的处理。首先，像上面展示的一样将数据从宽格式转换到长格式并确保 <code>subject</code> 列是因子变量。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># # 两个被试内变量 aov.ww &lt;- aov(y ~ w1*w2 +</span>
<span class="co"># Error(subject/(w1*w2)), data=data_long) #</span>
<span class="co"># 1个被试间变量，两个被试内变量 aov.bww &lt;- aov(y ~</span>
<span class="co"># b1*w1*w2 + Error(subject/(w1*w2)) + b1,</span>
<span class="co"># data=data_long) # 两个被试间变量，一个被试内变量</span>
<span class="co"># aov.bww &lt;- aov(y ~ b1*b2*w1 + Error(subject/(w1)) +</span>
<span class="co"># b1*b2, data=data_long)</span></code></pre>
</div>
</div>
</div>
<div id="section-7.5" class="section level2">
<h2><span class="header-section-number">7.5</span> 逻辑回归</h2>
<div id="-47" class="section level3">
<h3><span class="header-section-number">7.5.1</span> 问题</h3>
<p>你想要运用逻辑回归分析。</p>
</div>
<div id="-46" class="section level3">
<h3><span class="header-section-number">7.5.2</span> 方案</h3>
<p>逻辑回归典型使用于当存在一个离散的响应变量（比如赢和输）和一个与响应变量（也称为结果变量、因变量）的概率或几率相关联的连续预测变量的情况。它也适用于有多个预测变量的分类预测。</p>
<p>假设我们从内置的 <code>mtcars</code> 数据集的一部分开始，像下面这样，我们将 <code>vs</code> 作为响应变量，<code>mpg</code> 作为一个连续的预测变量，<code>am</code> 作为一个分类（离散）的预测变量。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(mtcars)
dat &lt;-<span class="st"> </span><span class="kw">subset</span>(mtcars, <span class="dt">select =</span> <span class="kw">c</span>(mpg, am, vs))
dat
<span class="co">#&gt;                      mpg am vs</span>
<span class="co">#&gt; Mazda RX4           21.0  1  0</span>
<span class="co">#&gt; Mazda RX4 Wag       21.0  1  0</span>
<span class="co">#&gt; Datsun 710          22.8  1  1</span>
<span class="co">#&gt; Hornet 4 Drive      21.4  0  1</span>
<span class="co">#&gt; Hornet Sportabout   18.7  0  0</span>
<span class="co">#&gt; Valiant             18.1  0  1</span>
<span class="co">#&gt; Duster 360          14.3  0  0</span>
<span class="co">#&gt; Merc 240D           24.4  0  1</span>
<span class="co">#&gt; Merc 230            22.8  0  1</span>
<span class="co">#&gt; Merc 280            19.2  0  1</span>
<span class="co">#&gt; Merc 280C           17.8  0  1</span>
<span class="co">#&gt; Merc 450SE          16.4  0  0</span>
<span class="co">#&gt; Merc 450SL          17.3  0  0</span>
<span class="co">#&gt; Merc 450SLC         15.2  0  0</span>
<span class="co">#&gt; Cadillac Fleetwood  10.4  0  0</span>
<span class="co">#&gt; Lincoln Continental 10.4  0  0</span>
<span class="co">#&gt; Chrysler Imperial   14.7  0  0</span>
<span class="co">#&gt; Fiat 128            32.4  1  1</span>
<span class="co">#&gt; Honda Civic         30.4  1  1</span>
<span class="co">#&gt; Toyota Corolla      33.9  1  1</span>
<span class="co">#&gt; Toyota Corona       21.5  0  1</span>
<span class="co">#&gt; Dodge Challenger    15.5  0  0</span>
<span class="co">#&gt; AMC Javelin         15.2  0  0</span>
<span class="co">#&gt; Camaro Z28          13.3  0  0</span>
<span class="co">#&gt; Pontiac Firebird    19.2  0  0</span>
<span class="co">#&gt; Fiat X1-9           27.3  1  1</span>
<span class="co">#&gt; Porsche 914-2       26.0  1  0</span>
<span class="co">#&gt; Lotus Europa        30.4  1  1</span>
<span class="co">#&gt; Ford Pantera L      15.8  1  0</span>
<span class="co">#&gt; Ferrari Dino        19.7  1  0</span>
<span class="co">#&gt; Maserati Bora       15.0  1  0</span>
<span class="co">#&gt; Volvo 142E          21.4  1  1</span></code></pre>
<div id="section-7.5.2.1" class="section level4">
<h4><span class="header-section-number">7.5.2.1</span> 连续预测变量，离散响应变量</h4>
<p>如果数据集有一个离散变量和一个连续变量，并且连续变量离散变量概率的预测器（就像直线回归中 x 可以预测 y 一样，只不过是两个连续变量，而逻辑回归中被预测的是离散变量），逻辑回归可能适用。</p>
<p>下面例子中，<code>mpg</code> 是连续预测变量，<code>vs</code> 是离散响应变量。.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 执行逻辑回归 —— 下面两种方式等效</span>
<span class="co"># logit是二项分布家族的默认模型</span>
logr_vm &lt;-<span class="st"> </span><span class="kw">glm</span>(vs <span class="op">~</span><span class="st"> </span>mpg, <span class="dt">data =</span> dat, <span class="dt">family =</span> binomial)
logr_vm &lt;-<span class="st"> </span><span class="kw">glm</span>(vs <span class="op">~</span><span class="st"> </span>mpg, <span class="dt">data =</span> dat, <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>))</code></pre>
<p>查看模型信息：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 输出模型信息</span>
logr_vm
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:  glm(formula = vs ~ mpg, family = binomial(link = &quot;logit&quot;), data = dat)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)          mpg  </span>
<span class="co">#&gt;       -8.83         0.43  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Degrees of Freedom: 31 Total (i.e. Null);  30 Residual</span>
<span class="co">#&gt; Null Deviance:       43.9 </span>
<span class="co">#&gt; Residual Deviance: 25.5  AIC: 29.5</span>

<span class="co"># 汇总该模型的更多信息</span>
<span class="kw">summary</span>(logr_vm)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm(formula = vs ~ mpg, family = binomial(link = &quot;logit&quot;), data = dat)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;    Min      1Q  Median      3Q     Max  </span>
<span class="co">#&gt; -2.213  -0.512  -0.228   0.640   1.698  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)   </span>
<span class="co">#&gt; (Intercept)   -8.833      3.162   -2.79   0.0052 **</span>
<span class="co">#&gt; mpg            0.430      0.158    2.72   0.0066 **</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  </span>
<span class="co">#&gt; 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 43.860  on 31  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 25.533  on 30  degrees of freedom</span>
<span class="co">#&gt; AIC: 29.53</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 6</span></code></pre>
<div id="section-7.5.2.1.1" class="section level5">
<h5><span class="header-section-number">7.5.2.1.1</span> 画图</h5>
<p>我们可以使用 <strong>ggplot2</strong> 或者基本图形绘制数据和逻辑回归结果。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> mpg, <span class="dt">y =</span> vs)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>, 
  <span class="dt">method.args =</span> <span class="kw">list</span>(<span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>), <span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-212-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span>))  <span class="co"># 减少一些边缘使得图形显示更好些</span>
<span class="kw">plot</span>(dat<span class="op">$</span>mpg, dat<span class="op">$</span>vs)
<span class="kw">curve</span>(<span class="kw">predict</span>(logr_vm, <span class="kw">data.frame</span>(<span class="dt">mpg =</span> x), <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>), 
  <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-212-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="section-7.5.2.2" class="section level4">
<h4><span class="header-section-number">7.5.2.2</span> 离散预测变量，离散响应变量</h4>
<p>这个跟上面的操作大致相同，<code>am</code> 是一个离散的预测变量，<code>vs</code> 是一个离散的响应变量。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 执行逻辑回归</span>
logr_va &lt;-<span class="st"> </span><span class="kw">glm</span>(vs <span class="op">~</span><span class="st"> </span>am, <span class="dt">data =</span> dat, <span class="dt">family =</span> binomial)

<span class="co"># 打印模型信息</span>
logr_va
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:  glm(formula = vs ~ am, family = binomial, data = dat)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)           am  </span>
<span class="co">#&gt;      -0.539        0.693  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Degrees of Freedom: 31 Total (i.e. Null);  30 Residual</span>
<span class="co">#&gt; Null Deviance:       43.9 </span>
<span class="co">#&gt; Residual Deviance: 43    AIC: 47</span>

<span class="co"># 汇总模型的信息</span>
<span class="kw">summary</span>(logr_va)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm(formula = vs ~ am, family = binomial, data = dat)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;    Min      1Q  Median      3Q     Max  </span>
<span class="co">#&gt; -1.244  -0.959  -0.959   1.113   1.413  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)</span>
<span class="co">#&gt; (Intercept)   -0.539      0.476   -1.13     0.26</span>
<span class="co">#&gt; am             0.693      0.732    0.95     0.34</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 43.860  on 31  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 42.953  on 30  degrees of freedom</span>
<span class="co">#&gt; AIC: 46.95</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 4</span></code></pre>
<div id="-1" class="section level5">
<h5><span class="header-section-number">7.5.2.2.1</span> 画图</h5>
<p>尽管图形可能会比连续预测变量的信息少，我们还是可以使用 <strong>ggplot2</strong> 或者基本图形绘制逻辑数据和回归结果。因为数据点大致在 4 个位置，我们可以使用抖动点避免叠加。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> am, <span class="dt">y =</span> vs)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">1</span>, 
  <span class="dt">position =</span> <span class="kw">position_jitter</span>(<span class="dt">width =</span> <span class="fl">0.05</span>, <span class="dt">height =</span> <span class="fl">0.05</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="dt">method.args =</span> <span class="kw">list</span>(<span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>), 
    <span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-214-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span>))  <span class="co"># 减少一些边缘使得图形显示更好些</span>
<span class="kw">plot</span>(<span class="kw">jitter</span>(dat<span class="op">$</span>am, <span class="fl">0.2</span>), <span class="kw">jitter</span>(dat<span class="op">$</span>vs, <span class="fl">0.2</span>))
<span class="kw">curve</span>(<span class="kw">predict</span>(logr_va, <span class="kw">data.frame</span>(<span class="dt">am =</span> x), <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>), 
  <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-214-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="section-7.5.2.3" class="section level4">
<h4><span class="header-section-number">7.5.2.3</span> 连续和离散预测变量，离散响应变量</h4>
<p>这跟先前的例子相似，这里 <code>mpg</code> 是连续预测变量，<code>am</code> 是离散预测变量，<code>vs</code> 是离散响应变量。</p>
<pre class="sourceCode r"><code class="sourceCode r">logr_vma &lt;-<span class="st"> </span><span class="kw">glm</span>(vs <span class="op">~</span><span class="st"> </span>mpg <span class="op">+</span><span class="st"> </span>am, <span class="dt">data =</span> dat, <span class="dt">family =</span> binomial)
logr_vma
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:  glm(formula = vs ~ mpg + am, family = binomial, data = dat)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)          mpg           am  </span>
<span class="co">#&gt;     -12.705        0.681       -3.007  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Degrees of Freedom: 31 Total (i.e. Null);  29 Residual</span>
<span class="co">#&gt; Null Deviance:       43.9 </span>
<span class="co">#&gt; Residual Deviance: 20.6  AIC: 26.6</span>

<span class="kw">summary</span>(logr_vma)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm(formula = vs ~ mpg + am, family = binomial, data = dat)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -2.0589  -0.4454  -0.0876   0.3333   1.6841  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)   </span>
<span class="co">#&gt; (Intercept)  -12.705      4.625   -2.75    0.006 **</span>
<span class="co">#&gt; mpg            0.681      0.252    2.70    0.007 **</span>
<span class="co">#&gt; am            -3.007      1.599   -1.88    0.060 . </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  </span>
<span class="co">#&gt; 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 43.860  on 31  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 20.646  on 29  degrees of freedom</span>
<span class="co">#&gt; AIC: 26.65</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 6</span></code></pre>
</div>
<div id="section-7.5.2.4" class="section level4">
<h4><span class="header-section-number">7.5.2.4</span> 有交互项的多个预测变量</h4>
<p>当有多个预测变量时我们可能需要检验交互项。交互项可以单独指定，像 <code>a + b + c + a:b + b:c + a:b:c</code>，或者它们可以使用 <code>a * b *c</code> 自动展开（这两种等效）。如果只是想指定部分可能的交互项，比如 <code>a</code> 与 <code>c</code> 有交互项，使用 <code>a + b + c + a:c</code>。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 执行逻辑回归，下面两种方式等效</span>
logr_vmai &lt;-<span class="st"> </span><span class="kw">glm</span>(vs <span class="op">~</span><span class="st"> </span>mpg <span class="op">*</span><span class="st"> </span>am, <span class="dt">data =</span> dat, <span class="dt">family =</span> binomial)
logr_vmai &lt;-<span class="st"> </span><span class="kw">glm</span>(vs <span class="op">~</span><span class="st"> </span>mpg <span class="op">+</span><span class="st"> </span>am <span class="op">+</span><span class="st"> </span>mpg<span class="op">:</span>am, <span class="dt">data =</span> dat, <span class="dt">family =</span> binomial)

logr_vmai
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:  glm(formula = vs ~ mpg + am + mpg:am, family = binomial, data = dat)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)          mpg           am       mpg:am  </span>
<span class="co">#&gt;     -20.478        1.108       10.106       -0.664  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Degrees of Freedom: 31 Total (i.e. Null);  28 Residual</span>
<span class="co">#&gt; Null Deviance:       43.9 </span>
<span class="co">#&gt; Residual Deviance: 19.1  AIC: 27.1</span>

<span class="kw">summary</span>(logr_vmai)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm(formula = vs ~ mpg + am + mpg:am, family = binomial, data = dat)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -1.7057  -0.3112  -0.0482   0.2804   1.5560  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)  </span>
<span class="co">#&gt; (Intercept)  -20.478     10.553   -1.94    0.052 .</span>
<span class="co">#&gt; mpg            1.108      0.577    1.92    0.055 .</span>
<span class="co">#&gt; am            10.106     11.910    0.85    0.396  </span>
<span class="co">#&gt; mpg:am        -0.664      0.624   -1.06    0.288  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  </span>
<span class="co">#&gt; 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 43.860  on 31  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 19.125  on 28  degrees of freedom</span>
<span class="co">#&gt; AIC: 27.12</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 7</span></code></pre>
</div>
</div>
</div>
<div id="section-7.6" class="section level2">
<h2><span class="header-section-number">7.6</span> 变量同质性</h2>
<div id="-48" class="section level3">
<h3><span class="header-section-number">7.6.1</span> 问题</h3>
<p>你想要（精确）检验样本的方差同质性（同方差，方差齐性）。<strong>许多统计检验假设总体同方差</strong>。</p>
</div>
<div id="-47" class="section level3">
<h3><span class="header-section-number">7.6.2</span> 方案</h3>
<p>有许多检验方差同质性的方式，下面列出三种：</p>
<ul>
<li><strong>Bartlett’s test</strong> - 如果数据服从正态分布，这是最好地检验方法。该方法对非正态数据非常敏感，如果数据不是正态的很可能返回假阳性的结果。</li>
<li><strong>Levene’s test</strong> - 数据偏离正态性时比 Bartlett 检验更稳定（鲁棒性更好），内置于 <strong>car</strong> 包</li>
<li><strong>Fligner-Killeen test</strong> - 这是一个非参数检验，数据偏离正态是非常稳定适用。</li>
</ul>
<p>对于所有的检验，零假设为总体方差相同（同质；<strong>不是相等的意思</strong>）；备择假设是至少两组样本（总体方差）不同。</p>
<div id="-1" class="section level4">
<h4><span class="header-section-number">7.6.2.1</span> 样例数据</h4>
<p>这里的例子使用了 <code>InsectSprays</code> 和 <code>ToothGrowth</code> 数据集。<code>InsectSprays</code> 数据集有一个独立变量，而 <code>ToothGrowth</code> 数据集有两个独立变量。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(InsectSprays)
<span class="co">#&gt;   count spray</span>
<span class="co">#&gt; 1    10     A</span>
<span class="co">#&gt; 2     7     A</span>
<span class="co">#&gt; 3    20     A</span>
<span class="co">#&gt; 4    14     A</span>
<span class="co">#&gt; 5    14     A</span>
<span class="co">#&gt; 6    12     A</span>

tg &lt;-<span class="st"> </span>ToothGrowth
tg<span class="op">$</span>dose &lt;-<span class="st"> </span><span class="kw">factor</span>(tg<span class="op">$</span>dose)  <span class="co"># Treat this column as a factor, not numeric</span>
<span class="kw">head</span>(tg)
<span class="co">#&gt;    len supp dose</span>
<span class="co">#&gt; 1  4.2   VC  0.5</span>
<span class="co">#&gt; 2 11.5   VC  0.5</span>
<span class="co">#&gt; 3  7.3   VC  0.5</span>
<span class="co">#&gt; 4  5.8   VC  0.5</span>
<span class="co">#&gt; 5  6.4   VC  0.5</span>
<span class="co">#&gt; 6 10.0   VC  0.5</span></code></pre>
<p>快速绘制数据集的箱线图：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(count <span class="op">~</span><span class="st"> </span>spray, <span class="dt">data =</span> InsectSprays)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-218-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(len <span class="op">~</span><span class="st"> </span><span class="kw">interaction</span>(dose, supp), <span class="dt">data =</span> ToothGrowth)</code></pre>
<p><img src="bookdown_files/figure-html/unnamed-chunk-219-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>初一看好像数据集的方差都不同质，但这需要像下面一样进行合适的检验。</p>
</div>
<div id="bartlett-" class="section level4">
<h4><span class="header-section-number">7.6.2.2</span> Bartlett 检验</h4>
<p>有一个独立变量：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bartlett.test</span>(count <span class="op">~</span><span class="st"> </span>spray, <span class="dt">data =</span> InsectSprays)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Bartlett test of homogeneity of variances</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  count by spray</span>
<span class="co">#&gt; Bartlett&#39;s K-squared = 26, df = 5, p-value =</span>
<span class="co">#&gt; 9e-05</span></code></pre>
<p>有多个独立变量，必须使用 <code>interaction()</code> 函数将这些独立变量包裹为含所有因子组合的单个变量。如果不适应，那么会得到错误的自由度，因而 p 值也将是错误的。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bartlett.test</span>(len <span class="op">~</span><span class="st"> </span><span class="kw">interaction</span>(supp, dose), <span class="dt">data =</span> ToothGrowth)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Bartlett test of homogeneity of variances</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  len by interaction(supp, dose)</span>
<span class="co">#&gt; Bartlett&#39;s K-squared = 6.9, df = 5, p-value =</span>
<span class="co">#&gt; 0.2</span>

<span class="kw">bartlett.test</span>(len <span class="op">~</span><span class="st"> </span>dose, <span class="dt">data =</span> ToothGrowth)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Bartlett test of homogeneity of variances</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  len by dose</span>
<span class="co">#&gt; Bartlett&#39;s K-squared = 0.67, df = 2, p-value =</span>
<span class="co">#&gt; 0.7</span></code></pre>
</div>
<div id="levene-" class="section level4">
<h4><span class="header-section-number">7.6.2.3</span> Levene 检验</h4>
<p><code>leveneTest()</code> 函数是 <strong>car</strong> 包的一部分。</p>
<p>有一个独立变量：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(car)
<span class="co">#&gt; Loading required package: carData</span>

<span class="kw">leveneTest</span>(count <span class="op">~</span><span class="st"> </span>spray, <span class="dt">data =</span> InsectSprays)
<span class="co">#&gt; Levene&#39;s Test for Homogeneity of Variance (center = median)</span>
<span class="co">#&gt;       Df F value Pr(&gt;F)   </span>
<span class="co">#&gt; group  5    3.82 0.0042 **</span>
<span class="co">#&gt;       66                  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  </span>
<span class="co">#&gt; 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></code></pre>
<p>有两个独立变量。注意这里 <code>interaction()</code> 函数不需要，因为该函数用于其他两个检验。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">leveneTest</span>(len <span class="op">~</span><span class="st"> </span>supp <span class="op">*</span><span class="st"> </span>dose, <span class="dt">data =</span> tg)
<span class="co">#&gt; Levene&#39;s Test for Homogeneity of Variance (center = median)</span>
<span class="co">#&gt;       Df F value Pr(&gt;F)</span>
<span class="co">#&gt; group  5    1.71   0.15</span>
<span class="co">#&gt;       54</span></code></pre>
</div>
<div id="fligner-killeen-" class="section level4">
<h4><span class="header-section-number">7.6.2.4</span> Fligner-Killeen 检验</h4>
<p>有一个独立变量：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fligner.test</span>(count <span class="op">~</span><span class="st"> </span>spray, <span class="dt">data =</span> InsectSprays)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Fligner-Killeen test of homogeneity of</span>
<span class="co">#&gt;  variances</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  count by spray</span>
<span class="co">#&gt; Fligner-Killeen:med chi-squared = 14, df = 5,</span>
<span class="co">#&gt; p-value = 0.01</span></code></pre>
<p>当处理多个独立变量时，这个 <code>fligner.test()</code> 函数有跟 <code>bartlett.test()</code> 相同的行为。必须使用 <code>interaction()</code> 函数。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fligner.test</span>(len <span class="op">~</span><span class="st"> </span><span class="kw">interaction</span>(supp, dose), <span class="dt">data =</span> ToothGrowth)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Fligner-Killeen test of homogeneity of</span>
<span class="co">#&gt;  variances</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  len by interaction(supp, dose)</span>
<span class="co">#&gt; Fligner-Killeen:med chi-squared = 7.7, df = 5,</span>
<span class="co">#&gt; p-value = 0.2</span>

<span class="kw">fligner.test</span>(len <span class="op">~</span><span class="st"> </span>dose, <span class="dt">data =</span> ToothGrowth)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Fligner-Killeen test of homogeneity of</span>
<span class="co">#&gt;  variances</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  len by dose</span>
<span class="co">#&gt; Fligner-Killeen:med chi-squared = 1.4, df = 2,</span>
<span class="co">#&gt; p-value = 0.5</span></code></pre>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-6.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-8.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/openbiox/Cookbook-for-R-Chinese/edit/master/book/07-stats.Rmd",
"text": "编辑"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
